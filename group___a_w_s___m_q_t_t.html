<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>RA Flexible Software Package Documentation: AWS MQTT</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <script type="text/javascript" src="search/lunr.js"></script>
    <link href="search/lunrsearch.css" rel="stylesheet" type="text/css">
    <script src="search/lunr_index.js"></script>
    <script src="search/lunrclient.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="fsp_customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
    $(document).ready(function() {
        $("tr.tree_lvl_1").nextUntil("tr.tree_lvl_1,tr.tree_none").hide();
		$("tr.tree_lvl_1").data("expanded","0");
		$("tr.tree_lvl_2").data("expanded","0");
		$("tr.tree_lvl_3").data("expanded","0");
		$("tr.tree_lvl_4").data("expanded","0");
		$("tr.tree_lvl_5").data("expanded","0");
        $("tr.tree_lvl_1").click(function() {
		    var lvl_1_is_open = $(this).data("expanded");
		    if (lvl_1_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2, tr.tree_lvl_1_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2,tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2,tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_2").click(function() {
		    var lvl_2_is_open = $(this).data("expanded");
		    if (lvl_2_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3, tr.tree_lvl_2_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
				$(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_3").click(function() {
		    var lvl_3_is_open = $(this).data("expanded");
		    if (lvl_3_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_3_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_4").click(function() {
		    var lvl_4_is_open = $(this).data("expanded");
		    if (lvl_4_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5, tr.tree_lvl_4_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_5").click(function() {
		    var lvl_5_is_open = $(this).data("expanded");
		    if (lvl_5_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_5,tr.tree_lvl_4,tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_5,tr.tree_lvl_4_item,tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
     });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_scaled.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">RA Flexible Software Package Documentation
   &#160;<span id="projectnumber">Release v6.2.0</span>
   </div>
  </td>
   <td>        <br /><div id="MSearchBox" class="MSearchBoxInactive">

    <form id="lunrSearchForm" name="lunrSearchForm">
      <span class="left" >
          <img id="MSearchSelect" src="search/mag_sel.png"
               alt=""/>
         <input class="search-input" id="MSearchField" name="q" placeholder="Search" type="text">
      </span>
      <span class="right">
          &nbsp;
      </span>
        <!--<input type="submit" value="Search">-->
    </form>
</div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___a_w_s___m_q_t_t.html','');});
</script>

<script src="search/mark.min.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    var options = {         // allows highlighting across element boundaries.
      "acrossElements": true
    };
    var bodyText = $("div.contents").text(); // try contents instead of body.
    // If using body: Problem may be that text inside <script> tags is included in .text() - but not in cheerio?
    // If using div.contents - works
    var fullURL = $(location).attr('href');
    var splitURL = fullURL.split("?");  // Get param string: content after "?" in URL
    if (splitURL.length > 1) {          // If any content after "?"
      var paramStr = splitURL[1];
      var params = paramStr.split("&"); // Split params on "&"
      for (i = 0; i < params.length; i++) {
        var paramPair = params[i].split("=");
        if (paramPair[0] == "pos") {     // If any param starts "pos", get the content after "="
          posStr = paramPair[1];
          var splitPos = posStr.split(",");
          var termArray = [];
        // termArray will have the search terms
            for (i=0; i < splitPos.length; i += 2) {
            start = splitPos[i];
            len = splitPos[i+1]; // Needs error detection! Vulnerable if non-even # of pos entries
            term = bodyText.substr(start,len);
            if (termArray.includes(term) == false) {     // List all unique terms
                termArray.push(bodyText.substr(start,len));
            }
          }
    //      console.log(termArray);
          var context = document.querySelector("div.contents");
          var instance = new Mark(context);
          for(i=0;i<termArray.length; i+=1) {
            instance.mark(termArray[i],options);  // Use Mark.js to mark all terms in termArray
            }
          var firstMark = document.querySelector("mark");
          firstMark.scrollIntoView(true);
          //      console.log($("mark").first().text()); // Trying to scroll to first Mark element.
        }
            }
    }
  });
</script>

<link href="fsp_customdoxygen.css" rel="stylesheet" type="text/css" />

<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


<!-- Lunr search results -->
<div id="lunrResultBox" style="
        position: fixed;
        border: 1px solid black;
        background-color: WhiteSmoke;
        padding: 10px;
        width: 500px;
        height: 500px;
        top: 30;
        right: 0;
        overflow: auto;
        display: none">
    <button onclick="closeLunrResults()" style="float: right;">X</button>
    <div class="resultCount" id="resultCount"></div>
    <div id="searchResults"></div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">AWS MQTT<div class="ingroups"><a class="el" href="group___r_e_n_e_s_a_s___m_o_d_u_l_e_s.html">Modules</a> &raquo; <a class="el" href="group___r_e_n_e_s_a_s___n_e_t_w_o_r_k_i_n_g___m_o_d_u_l_e_s.html">Networking</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>This module provides the AWS MQTT integration documentation. </p>
<h1><a class="anchor" id="r-AWS_MQTT-overview"></a>
Overview</h1>
<p>The AWS MQTT library can connect to either AWS or a third party MQTT broker such as <a href="https://mosquitto.org/">Mosquitto</a>. The documentation for the library can be found at the following link: <a href="https://freertos.github.io/coreMQTT/main/">coreMQTT</a>.</p>
<h2><a class="anchor" id="r-AWS_MQTT-features"></a>
Features</h2>
<ul>
<li>MQTT connections over TLS to an AWS IoT Endpoint or Mosquitto server</li>
</ul>
<h1><a class="anchor" id="r-AWS_MQTT-configuration"></a>
Configuration</h1>
<h2>Memory Usage</h2>
<p>The AWS CoreMQTT library relies heavily on dynamic memory allocation for thread/task creation as well as other uses. Depending on the configuration it may be required to provide as much as 110k heap. To decrease this it is recommended to tweak the thread stack configuration values based on usage. Notable values are:</p>
<h3>FreeRTOS Thread</h3>
<ul>
<li>General|Minimal Stack Size</li>
</ul>
<h3>FreeRTOS Plus TCP</h3>
<ul>
<li>Stack size in words (not bytes)</li>
</ul>
<h1><a class="anchor" id="r-AWS_MQTT-usage-notes"></a>
Usage Notes</h1>
<ul>
<li>A transport interface is required to use the CoreMQTT library (<a href="https://www.freertos.org/network-interface.html">https://www.freertos.org/network-interface.html</a>).</li>
<li>For FSP, a transport interface over MbedTLS is provided. This transport interface can connect to RA ethernet, WiFi, and cellular modules via sockets wrappers for each module.</li>
<li>TLS_FreeRTOS_Connect should be used before calling any CoreMQTT APIs. See the example for more information.</li>
<li>Not all MQTT servers support maintaining a TLS session after a MQTT disconnect. <code>TLS_FreeRTOS_Disconnect</code> and <code>TLS_FreeRTOS_Connect</code> should be called to establish a new TLS session before attempting to reconnect with CoreMQTT APIs if the server does not support TLS session resumption.</li>
</ul>
<h2><a class="anchor" id="r-AWS_MQTT-limiitations"></a>
Limitations</h2>
<ul>
<li>aws_clientcredential.h and aws_clientcredential_keys.h need to be added manually.</li>
<li>MbedTLS must be initialized and key provisioning must be done before starting a secure connection.</li>
</ul>
<h2><a class="anchor" id="r-AWS_MQTT-examples"></a>
Examples</h2>
<h3>Connection example using MbedTLS/PKCS11 Transport Interface</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#define EXAMPLE_PDN_CONTEXT_NUMBER         (1)</span></div><div class="line"><span class="preprocessor">#define EXAMPLE_TIMEOUT_MS                 (5000)</span></div><div class="line"><span class="preprocessor">#define EXAMPLE_DISABLE_SNI                (false)</span></div><div class="line"><span class="preprocessor">#define EXAMPLE_MQTT_HOST                  (&quot;mqtt_host_server&quot;)</span></div><div class="line"><span class="preprocessor">#define EXAMPLE_MQTT_HOST_PORT             (8883)</span></div><div class="line"><span class="preprocessor">#define EXAMPLE_MQTT_SEND_TIMEOUT          (5000)</span></div><div class="line"><span class="preprocessor">#define EXAMPLE_MQTT_RECEIVE_TIMEOUT       (5000)</span></div><div class="line"><span class="preprocessor">#define EXAMPLE_MQTT_TOPIC                 (&quot;example_topic&quot;)</span></div><div class="line"><span class="preprocessor">#define EXAMPLE_MQTT_CLIENT_IDENTIFIER     (&quot;client_id&quot;)</span></div><div class="line"><span class="preprocessor">#define EXAMPLE_MQTT_KEEP_ALIVE_SECONDS    (60)</span></div><div class="line"><span class="preprocessor">#define EXAMPLE_MQTT_PAYLOAD               (&quot;helloworld&quot;)</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>NetworkContext</div><div class="line">{</div><div class="line">    TlsTransportParams_t * pParams;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> SERVER_CERTIFICATE_PEM[] =</div><div class="line">    <span class="stringliteral">&quot;-----BEGIN CERTIFICATE-----\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;MIIDazCCAlOgAwIBAgIURabL79ayIywQv0y8SPnbZ1FYDRIwDQYJKoZIhvcNAQEL\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;BQAwRTELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNVBAoM\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;GEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDAeFw0xOTA5MTEyMTIyMjZaFw0yMDA5\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;MTAyMTIyMjZaMEUxCzAJBgNVBAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEw\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;HwYDVQQKDBhJbnRlcm5ldCBXaWRnaXRzIFB0eSBMdGQwggEiMA0GCSqGSIb3DQEB\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;AQUAA4IBDwAwggEKAoIBAQDSA3h+5sT58FHgnovnQzsVHQ0H/3TsnEKwVzyBwTQl\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;s4PbG6VXCWyyJWjdJ4XMH1oU8gAlxauFbwOO98Aquei4K3Pi/ynKNBeX4VJcLyE5\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;Azq7nRIIwt4+OoZ5kV7v8JIoLY5i+Ktn3zq1t0y1ZmK6Uk/rRPonb+Kx7wQPx7jq\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;ZIZGda+CgF6ZedidPcABuggqD1y3U2gLiRPoBhe9nN2hG60rRp7vhbWMF0pzTDXu\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;BKF7XSTbhYz3pl6NeOCLh5E3t8x908Ui5W1zDN3iOysrcwQFtCiGTvzNtxSfli1+\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;PugIt9Q2vlYmuz5qI+juxHftJSXO86M5SV7exqUOXP9RAgMBAAGjUzBRMB0GA1Ud\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;DgQWBBQG8VNJEJUjpTKMjmrOY3XApNp5lDAfBgNVHSMEGDAWgBQG8VNJEJUjpTKM\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;jmrOY3XApNp5lDAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQAt\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;CabfjsYUnG8tt3/GDdhjsuG+SfeQe11S73pZi3+L616bPH5MNUv+LkgR/1AFEqt5\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;WadKVTgzW5Ork1t7CfkYwrOHbyhyaaDPzERjMCfCcl8lQluBy6vE/lEb0hWq6XlO\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;f6+8i+VKxWkSIXs2ZQqqYSOTTzAjHSsiiuE5WsC00ErvCvnC7uD6+3Y7W1uQRkFZ\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;uSd9AN1ixPvAFi69FF/ymlJv6vII5GXOVDrIwdr50bMNuezMEx6qMNDADRH8iEaL\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;JaSgfklczGiI1i7MPD4JTtsXOgKwxcBDAa0zQDVA5uBGEIOhva3m5X70N4iO7W0V\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;eEhZekKeg3Fl3t/CXi8l\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;-----END CERTIFICATE-----&quot;</span>;</div><div class="line"></div><div class="line"><span class="preprocessor">#define keyCLIENT_CERTIFICATE_PEM                                        \</span></div><div class="line"><span class="preprocessor">    &quot;-----BEGIN CERTIFICATE-----\n&quot;                                      \</span></div><div class="line"><span class="preprocessor">    &quot;MIIDETCCAfkCFHwd2yn8zn5qB2ChYUT9Mvbi9Xp1MA0GCSqGSIb3DQEBCwUAMEUx\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;CzAJBgNVBAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRl\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;cm5ldCBXaWRnaXRzIFB0eSBMdGQwHhcNMTkwOTExMjEyMjU0WhcNMjAwOTEwMjEy\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;MjU0WjBFMQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UE\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;CgwYSW50ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMIIBIjANBgkqhkiG9w0BAQEFAAOC\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;AQ8AMIIBCgKCAQEAo8oThJXSMDo41oL7HTpC4TX8NalBvnkFw30Av67dl/oZDjVA\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;iXPnZkhVppLnj++0/Oed0M7UwNUO2nurQt6yTYrvW7E8ZPjAlC7ueJcGYZhOaVv2\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;bhSmigjFQru2lw5odSuYy5+22CCgxft58nrRCo5Bk+GwWgZmcrxe/BzutRHQ7X4x\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;dYJhyhBOi2R1Kt8XsbuWilfgfkVhhkVklFeKqiypdQM6cnPWo/G4DyW34jOXzzEM\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;FLWvQOQLCKUZOgjJBnFdbx8oOOwMkYCChbV7gqPE6cw0Zy26CvlLQiINyonLPbNT\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;c64sS/ZBGPZFOPJmb4tG2nipYgZ1hO/r++jCbwIDAQABMA0GCSqGSIb3DQEBCwUA\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;A4IBAQCdqq59ubdRY9EiV3bleKXeqG7+8HgBHdm0X9dgq10nD37p00YLyuZLE9NM\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;066G/VcflGrx/Nzw+/UuI7/UuBbBS/3ppHRnsZqBIl8nnr/ULrFQy8z3vKtL1q3C\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;DxabjPONlPO2keJeTTA71N/RCEMwJoa8i0XKXGdu/hQo6x4n+Gq73fEiGCl99xsc\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;4tIO4yPS4lv+uXBzEUzoEy0CLIkiDesnT5lLeCyPmUNoU89HU95IusZT7kygCHHd\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;72am1ic3X8PKc268KT3ilr3VMhK67C+iIIkfrM5AiU+oOIRrIHSC/p0RigJg3rXA\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;GBIRHvt+OYF9fDeG7U4QDJNCfGW+\n&quot;                                     \</span></div><div class="line"><span class="preprocessor">    &quot;-----END CERTIFICATE-----&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define keyCLIENT_PRIVATE_KEY_PEM                                        \</span></div><div class="line"><span class="preprocessor">    &quot;-----BEGIN RSA PRIVATE KEY-----\n&quot;                                  \</span></div><div class="line"><span class="preprocessor">    &quot;MIIEowIBAAKCAQEAo8oThJXSMDo41oL7HTpC4TX8NalBvnkFw30Av67dl/oZDjVA\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;iXPnZkhVppLnj++0/Oed0M7UwNUO2nurQt6yTYrvW7E8ZPjAlC7ueJcGYZhOaVv2\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;bhSmigjFQru2lw5odSuYy5+22CCgxft58nrRCo5Bk+GwWgZmcrxe/BzutRHQ7X4x\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;dYJhyhBOi2R1Kt8XsbuWilfgfkVhhkVklFeKqiypdQM6cnPWo/G4DyW34jOXzzEM\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;FLWvQOQLCKUZOgjJBnFdbx8oOOwMkYCChbV7gqPE6cw0Zy26CvlLQiINyonLPbNT\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;c64sS/ZBGPZFOPJmb4tG2nipYgZ1hO/r++jCbwIDAQABAoIBAQCGR2hC/ZVJhqIM\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;c2uuJZKpElpIIBBPOObZwwS3IYR4UUjzVgMn7UbbmxflLXD8lzfZU4YVp0vTH5lC\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;07qvYuXpHqtnj+GEok837VYCtUY9AuHeDM/2paV3awNV15E1PFG1Jd3pqnH7tJw6\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;VBZBDiGNNt1agN/UnoSlMfvpU0r8VGPXCBNxe3JY5QyBJPI1wF4LcxRI+eYmr7Ja\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;/cjn97DZotgz4B7gUNu8XIEkUOTwPabZINY1zcLWiXTMA+8qTniPVk653h14Xqt4\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;4o4D4YCTpwJcmxSV1m21/6+uyuXr9SIKAE+Ys2cYLA46x+rwLaW5fUoQ5hHa0Ytb\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;RYJ4SrtBAoGBANWtwlE69N0hq5xDPckSbNGubIeG8P4mBhGkJxIqYoqugGLMDiGX\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;4bltrjr2TPWaxTo3pPavLJiBMIsENA5KU+c/r0jLkxgEp9MIVJrtNgkCiDQqogBG\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;j4IJL2iQwXoLCqk2tx/dh9Mww+7SETE7EPNrv4UrYaGN5AEvpf5W+NHPAoGBAMQ6\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;wVa0Mx1PlA4enY2rfE3WXP8bzjleSOwR75JXqG2WbPC0/cszwbyPWOEqRpBZfvD/\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;QFkKx06xp1C09XwiQanr2gDucYXHeEKg/9iuJV1UkMQp95ojlhtSXdRZV7/l4pmN\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;fpB2vcAptX/4gY4tDrWMO08JNnRjE7duC+rmmk1hAoGAS4L0QLCNB/h2JOq+Uuhn\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;/FGfmOVfFPFrA6D3DbxcxpWUWVWzSLvb0SOphryzxbfEKyau7V5KbDp7ZSU/IC20\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;KOygjSEkAkDi7fjrrTRW/Cgg6g6G4YIOBO4qCtHdDbwJMHNdk6096qw5EZS67qLp\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;Apz5OZ5zChySjri/+HnTxJECgYBysGSP6IJ3fytplTtAshnU5JU2BWpi3ViBoXoE\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;bndilajWhvJO8dEqBB5OfAcCF0y6TnWtlT8oH21LHnjcNKlsRw0Dvllbd1oylybx\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;3da41dRG0sCEtoflMB7nHdDLt/DZDnoKtVvyFG6gfP47utn+Ahgn+Zp6K+46J3eP\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;s3g8AQKBgE/PJiaF8pbBXaZOuwRRA9GOMSbDIF6+jBYTYp4L9wk4+LZArKtyI+4k\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;Md2DUvHwMC+ddOtKqjYnLm+V5cSbvu7aPvBZtwxghzTUDcf7EvnA3V/bQBh3R0z7\n&quot; \</span></div><div class="line"><span class="preprocessor">    &quot;pVsxTyGRmBSeLdbUWACUbX9LXdpudarPAJ59daWmP3mBEVmWdzUw\n&quot;             \</span></div><div class="line"><span class="preprocessor">    &quot;-----END RSA PRIVATE KEY-----&quot;</span></div><div class="line"></div><div class="line"><span class="comment">/* Callback to handle MQTT events, user should add their own processing */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> prvEventCallback(MQTTContext_t          * pxMQTTContext,</div><div class="line">                             MQTTPacketInfo_t       * pxPacketInfo,</div><div class="line">                             MQTTDeserializedInfo_t * pxDeserializedInfo);</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> prvEventCallback (MQTTContext_t          * pxMQTTContext,</div><div class="line">                              MQTTPacketInfo_t       * pxPacketInfo,</div><div class="line">                              MQTTDeserializedInfo_t * pxDeserializedInfo)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(pxMQTTContext);</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(pxPacketInfo);</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(pxDeserializedInfo);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/* Callback to get current time */</span></div><div class="line"><span class="keyword">static</span> uint32_t prvGetTimeMs(<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line"><span class="keyword">static</span> uint32_t prvGetTimeMs (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    TickType_t xTickCount = 0;</div><div class="line">    uint32_t   ulTimeMs   = 0UL;</div><div class="line"></div><div class="line">    <span class="comment">/* Get the current tick count. */</span></div><div class="line">    xTickCount = xTaskGetTickCount();</div><div class="line"></div><div class="line">    <span class="comment">/* Convert the ticks to milliseconds. */</span></div><div class="line">    ulTimeMs = (uint32_t) xTickCount * (1000U / configTICK_RATE_HZ); <span class="comment">// NOLINT(readability-magic-numbers)</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> ulTimeMs;</div><div class="line">}</div><div class="line"></div><div class="line">NetworkContext_t networkContext;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> rm_aws_transport_interface_port_basic_example (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    ProvisioningParams_t params;</div><div class="line">    NetworkCredentials_t credentials;</div><div class="line">    TransportInterface_t transport;</div><div class="line">    MQTTContext_t        mqtt_context;</div><div class="line">    TlsTransportParams_t transport_params;</div><div class="line">    <span class="keyword">static</span> uint8_t       buffer[1024]; <span class="comment">// NOLINT(readability-magic-numbers)</span></div><div class="line">    MQTTFixedBuffer_t    networkBuffer;</div><div class="line">    MQTTConnectInfo_t    connectInfo;</div><div class="line">    MQTTPublishInfo_t    lwtInfo;</div><div class="line">    <span class="keywordtype">bool</span>                 session_present;</div><div class="line"></div><div class="line">    <span class="comment">/* Open little FS flash and format in order to store keys */</span></div><div class="line">    assert(FSP_SUCCESS == <a class="code" href="group___r_m___l_i_t_t_l_e_f_s___f_l_a_s_h.html#gac90c5652573dc23974aa31115968730c">RM_LITTLEFS_FLASH_Open</a>(g_rm_littlefs0.p_ctrl, g_rm_littlefs0.p_cfg));</div><div class="line">    assert(0 == lfs_format(&amp;g_rm_littlefs0_lfs, &amp;g_rm_littlefs0_lfs_cfg));</div><div class="line">    assert(0 == lfs_mount(&amp;g_rm_littlefs0_lfs, &amp;g_rm_littlefs0_lfs_cfg));</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize the crypto hardware acceleration. */</span></div><div class="line">    <a class="code" href="group___r_m___p_s_a___c_r_y_p_t_o.html#gaf0f37c11be234650bec95ce37e9a4a6b">mbedtls_platform_setup</a>(NULL);</div><div class="line"></div><div class="line">    <span class="comment">/* Write the keys into a secure region in data flash. */</span></div><div class="line">    params.pucClientCertificate      = (uint8_t *) keyCLIENT_CERTIFICATE_PEM;</div><div class="line">    params.ulClientCertificateLength = <span class="keyword">sizeof</span>(keyCLIENT_CERTIFICATE_PEM);</div><div class="line">    params.pucClientPrivateKey       = (uint8_t *) keyCLIENT_PRIVATE_KEY_PEM;</div><div class="line">    params.ulClientPrivateKeyLength  = <span class="keyword">sizeof</span>(keyCLIENT_PRIVATE_KEY_PEM);</div><div class="line">    params.pucJITPCertificate        = NULL;</div><div class="line">    params.ulJITPCertificateLength   = 0;</div><div class="line">    vAlternateKeyProvisioning(&amp;params);</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize network context */</span></div><div class="line">    networkContext.pParams = &amp;transport_params;</div><div class="line"></div><div class="line">    <span class="comment">/* Setup network credentials */</span></div><div class="line">    credentials.pAlpnProtos      = NULL;</div><div class="line">    credentials.disableSni       = EXAMPLE_DISABLE_SNI;</div><div class="line">    credentials.pRootCa          = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) SERVER_CERTIFICATE_PEM;</div><div class="line">    credentials.rootCaSize       = <span class="keyword">sizeof</span>(SERVER_CERTIFICATE_PEM);</div><div class="line">    credentials.pUserName        = NULL;</div><div class="line">    credentials.userNameSize     = 0;</div><div class="line">    credentials.pPassword        = NULL;</div><div class="line">    credentials.passwordSize     = 0;</div><div class="line">    credentials.pClientCertLabel = pkcs11configLABEL_DEVICE_CERTIFICATE_FOR_TLS;</div><div class="line">    credentials.pPrivateKeyLabel = pkcs11configLABEL_DEVICE_PRIVATE_KEY_FOR_TLS;</div><div class="line"></div><div class="line">    <span class="comment">/* Set transport interface */</span></div><div class="line">    transport.pNetworkContext = &amp;networkContext;</div><div class="line">    transport.recv            = TLS_FreeRTOS_recv;</div><div class="line">    transport.send            = TLS_FreeRTOS_send;</div><div class="line"></div><div class="line">    <span class="comment">/* Connect to a MQTT host */</span></div><div class="line">    TLS_FreeRTOS_Connect(&amp;networkContext,</div><div class="line">                         EXAMPLE_MQTT_HOST,</div><div class="line">                         EXAMPLE_MQTT_HOST_PORT,</div><div class="line">                         &amp;credentials,</div><div class="line">                         EXAMPLE_MQTT_RECEIVE_TIMEOUT,</div><div class="line">                         EXAMPLE_MQTT_SEND_TIMEOUT);</div><div class="line"></div><div class="line">    <span class="comment">/* Fill the values for network buffer. */</span></div><div class="line">    networkBuffer.pBuffer = buffer;</div><div class="line">    networkBuffer.size    = 1024;      <span class="comment">// NOLINT</span></div><div class="line"></div><div class="line">    <span class="comment">/* Initialize MQTT */</span></div><div class="line">    assert(MQTTSuccess == MQTT_Init(&amp;mqtt_context, &amp;transport, prvGetTimeMs, prvEventCallback, &amp;networkBuffer));</div><div class="line"></div><div class="line">    <span class="comment">/* Set connection info for MQTT session */</span></div><div class="line">    connectInfo.cleanSession           = <span class="keyword">true</span>;</div><div class="line">    connectInfo.clientIdentifierLength = <span class="keyword">sizeof</span>(EXAMPLE_MQTT_CLIENT_IDENTIFIER) - 1;</div><div class="line">    connectInfo.pClientIdentifier      = EXAMPLE_MQTT_CLIENT_IDENTIFIER;</div><div class="line">    connectInfo.keepAliveSeconds       = EXAMPLE_MQTT_KEEP_ALIVE_SECONDS;</div><div class="line">    connectInfo.pUserName              = NULL;</div><div class="line">    connectInfo.userNameLength         = 0U;</div><div class="line">    connectInfo.pPassword              = NULL;</div><div class="line">    connectInfo.passwordLength         = 0U;</div><div class="line"></div><div class="line">    <span class="comment">/* LWT Info. */</span></div><div class="line">    lwtInfo.pTopicName      = EXAMPLE_MQTT_TOPIC;</div><div class="line">    lwtInfo.topicNameLength = <span class="keyword">sizeof</span>(EXAMPLE_MQTT_TOPIC) - 1;</div><div class="line">    lwtInfo.pPayload        = EXAMPLE_MQTT_PAYLOAD;</div><div class="line">    lwtInfo.payloadLength   = strlen(EXAMPLE_MQTT_PAYLOAD);</div><div class="line">    lwtInfo.qos             = MQTTQoS0;</div><div class="line">    lwtInfo.dup             = <span class="keyword">false</span>;</div><div class="line">    lwtInfo.retain          = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* Send MQTT CONNECT packet to broker. */</span></div><div class="line">    assert(MQTTSuccess == MQTT_Connect(&amp;mqtt_context, &amp;connectInfo, &amp;lwtInfo, 20000, &amp;session_present));</div><div class="line">}</div><div class="line"></div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
        <li class="footer">FSP Release v6.2.0 User's Manual Copyright © (2025) Renesas Electronics Corporation. All Rights Reserved.</li>
  </ul>
</div>
</body>
</html>
