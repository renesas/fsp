<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>RA Flexible Software Package Documentation: USB HCDC (r_usb_hcdc)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <script type="text/javascript" src="search/lunr.js"></script>
    <link href="search/lunrsearch.css" rel="stylesheet" type="text/css">
    <script src="search/lunr_index.js"></script>
    <script src="search/lunrclient.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="fsp_customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
    $(document).ready(function() {
        $("tr.tree_lvl_1").nextUntil("tr.tree_lvl_1,tr.tree_none").hide();
		$("tr.tree_lvl_1").data("expanded","0");
		$("tr.tree_lvl_2").data("expanded","0");
		$("tr.tree_lvl_3").data("expanded","0");
		$("tr.tree_lvl_4").data("expanded","0");
		$("tr.tree_lvl_5").data("expanded","0");
        $("tr.tree_lvl_1").click(function() {
		    var lvl_1_is_open = $(this).data("expanded");
		    if (lvl_1_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2, tr.tree_lvl_1_item").show(); 
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2,tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed"); 
				$(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2,tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        }); 
		$("tr.tree_lvl_2").click(function() {
		    var lvl_2_is_open = $(this).data("expanded");
		    if (lvl_2_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3, tr.tree_lvl_2_item").show(); 
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();                
				$(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_3").click(function() {
		    var lvl_3_is_open = $(this).data("expanded");
		    if (lvl_3_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_3_item").show(); 
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_5").data("expanded","0");				
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_4").click(function() {
		    var lvl_4_is_open = $(this).data("expanded");
		    if (lvl_4_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5, tr.tree_lvl_4_item").show(); 
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");	
				$(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5").data("expanded","0");				
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        }); 
		$("tr.tree_lvl_5").click(function() {
		    var lvl_5_is_open = $(this).data("expanded");
		    if (lvl_5_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_5,tr.tree_lvl_4,tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5_item").show(); 
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_5,tr.tree_lvl_4_item,tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();                
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        }); 
     }); 
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_scaled.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">RA Flexible Software Package Documentation
   &#160;<span id="projectnumber">Release v5.1.0</span>
   </div>
  </td>
   <td>        <br /><div id="MSearchBox" class="MSearchBoxInactive">
 
    <form id="lunrSearchForm" name="lunrSearchForm">
      <span class="left" >
          <img id="MSearchSelect" src="search/mag_sel.png"
               alt=""/>
         <input class="search-input" id="MSearchField" name="q" placeholder="Search" type="text"> 
      </span>
      <span class="right">
          &nbsp; 
      </span>
        <!--<input type="submit" value="Search">-->
    </form>
</div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___u_s_b___h_c_d_c.html','');});
</script>

<script src="search/mark.min.js"></script>
<script type="text/javascript">
  $(document).ready(function() { 
    var options = {         // allows highlighting across element boundaries.
      "acrossElements": true
    };
    var bodyText = $("div.contents").text(); // try contents instead of body. 
    // If using body: Problem may be that text inside <script> tags is included in .text() - but not in cheerio?
    // If using div.contents - works 
    var fullURL = $(location).attr('href');
    var splitURL = fullURL.split("?");  // Get param string: content after "?" in URL
    if (splitURL.length > 1) {          // If any content after "?"
      var paramStr = splitURL[1];
      var params = paramStr.split("&"); // Split params on "&"
      for (i = 0; i < params.length; i++) {
        var paramPair = params[i].split("=");
        if (paramPair[0] == "pos") {     // If any param starts "pos", get the content after "="
          posStr = paramPair[1];
          var splitPos = posStr.split(",");
          var termArray = [];
        // termArray will have the search terms
            for (i=0; i < splitPos.length; i += 2) {
            start = splitPos[i];
            len = splitPos[i+1]; // Needs error detection! Vulnerable if non-even # of pos entries
            term = bodyText.substr(start,len);
            if (termArray.includes(term) == false) {     // List all unique terms
                termArray.push(bodyText.substr(start,len)); 
            }
          } 
    //      console.log(termArray);
          var context = document.querySelector("div.contents");
          var instance = new Mark(context);
          for(i=0;i<termArray.length; i+=1) {
            instance.mark(termArray[i],options);  // Use Mark.js to mark all terms in termArray
            }    
          var firstMark = document.querySelector("mark");
          firstMark.scrollIntoView(true);
          //      console.log($("mark").first().text()); // Trying to scroll to first Mark element. 
        }
            }
    }
  });
</script>

<link href="fsp_customdoxygen.css" rel="stylesheet" type="text/css" />

<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


<!-- Lunr search results -->
<div id="lunrResultBox" style="
        position: fixed;
        border: 1px solid black;
        background-color: WhiteSmoke;  
        padding: 10px;
        width: 500px;
        height: 500px;
        top: 30;
        right: 0;
        overflow: auto;
        display: none">
    <button onclick="closeLunrResults()" style="float: right;">X</button>
    <div class="resultCount" id="resultCount"></div>
    <div id="searchResults"></div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">USB HCDC (r_usb_hcdc)<div class="ingroups"><a class="el" href="group___r_e_n_e_s_a_s___m_o_d_u_l_e_s.html">Modules</a> &raquo; <a class="el" href="group___r_e_n_e_s_a_s___c_o_n_n_e_c_t_i_v_i_t_y___m_o_d_u_l_e_s.html">Connectivity</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga8088d3a63f032a4fdaddec7f81f5da60"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___u_s_b___h_c_d_c.html#ga8088d3a63f032a4fdaddec7f81f5da60">R_USB_HCDC_ControlDataRead</a> (<a class="el" href="group___u_s_b___a_p_i.html#ga00a5a797b57dec247564f11056ac7230">usb_ctrl_t</a> *const p_api_ctrl, uint8_t *p_buf, uint32_t size, uint8_t device_address)</td></tr>
<tr class="memdesc:ga8088d3a63f032a4fdaddec7f81f5da60"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read Control Data.(CDC Interrupt IN data)  <a href="#ga8088d3a63f032a4fdaddec7f81f5da60">More...</a><br /></td></tr>
<tr class="separator:ga8088d3a63f032a4fdaddec7f81f5da60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga111d39b0fc53e4eb07f894ca7a0cd505"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___u_s_b___h_c_d_c.html#ga111d39b0fc53e4eb07f894ca7a0cd505">R_USB_HCDC_SpecificDeviceRegister</a> (<a class="el" href="group___u_s_b___a_p_i.html#ga00a5a797b57dec247564f11056ac7230">usb_ctrl_t</a> *const p_api_ctrl, uint16_t vendor_id, uint16_t product_id)</td></tr>
<tr class="memdesc:ga111d39b0fc53e4eb07f894ca7a0cd505"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register the specified vendor class device in the device table.  <a href="#ga111d39b0fc53e4eb07f894ca7a0cd505">More...</a><br /></td></tr>
<tr class="separator:ga111d39b0fc53e4eb07f894ca7a0cd505"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6b2015ee504e6091a3e380b57e246581"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___u_s_b___h_c_d_c.html#ga6b2015ee504e6091a3e380b57e246581">R_USB_HCDC_DeviceInfoGet</a> (<a class="el" href="group___u_s_b___a_p_i.html#ga00a5a797b57dec247564f11056ac7230">usb_ctrl_t</a> *const p_api_ctrl, <a class="el" href="group___u_s_b___h_c_d_c___a_p_i.html#structusb__hcdc__device__info__t">usb_hcdc_device_info_t</a> *p_info, uint8_t device_address)</td></tr>
<tr class="memdesc:ga6b2015ee504e6091a3e380b57e246581"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the VID, PID and subclass code of the connected device.  <a href="#ga6b2015ee504e6091a3e380b57e246581">More...</a><br /></td></tr>
<tr class="separator:ga6b2015ee504e6091a3e380b57e246581"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This module provides a USB Host Communications Device Class (HCDC) driver. It implements the <a class="el" href="group___u_s_b___h_c_d_c___a_p_i.html">USB HCDC Interface</a>. </p>
<p><a class="anchor" id="functionss"></a></p><h2 class="groupheader">Functions</h2>
<p>Refer to <a class="el" href="group___u_s_b.html">USB (r_usb_basic)</a> for the common API (r_usb_basic) to be called from the application. <a class="anchor" id="details"></a></p><h2 class="groupheader">Detailed Description</h2>
<h1><a class="anchor" id="r-usb-hcdc-overview"></a>
Overview</h1>
<p>The r_usb_hcdc module, when used in combination with the r_usb_basic module, operates as a USB Host Communications Device Class (HCDC) driver. The HCDC conforms to the PSTN device subclass abstract control model of the USB Communications Device Class (CDC) specification and enables communication with a CDC peripheral device.</p>
<h2><a class="anchor" id="r-usb-hcdc-features"></a>
Features</h2>
<p>The r_usb_hcdc module has the following key features:</p><ul>
<li>Checks for connected devices</li>
<li>Implementation of communication line settings</li>
<li>Acquisition of the communication line state</li>
<li>Data transfer to and from a CDC peripheral device</li>
</ul>
<h1><a class="anchor" id="r-usb-hcdc-configuration"></a>
Configuration</h1>
<p><h2>Build Time Configurations for r_usb_hcdc</h2>
The following build time configurations are defined in fsp_cfg/r_usb_hcdc_cfg.h:<br />
</p><table class="doxtable">
<tr>
<th>Configuration</th><th>Options</th><th>Default</th><th>Description </th></tr>
<tr class="tree_none">
<td>Target Peripheral Device Class ID</td><td><ul style="margin-top:0;margin-bottom:0;">
<li>
CDC class supported device</li>
<li>
Vendor class device</li>
</ul>
</td><td>CDC class supported device </td><td>Specify the device class ID of the CDC device to be connected. </td></tr>
<tr class="tree_none">
<td>Bulk Input Transfer Pipe</td><td><ul style="margin-top:0;margin-bottom:0;">
<li>
USB PIPE1</li>
<li>
USB PIPE2</li>
<li>
USB PIPE3</li>
<li>
USB PIPE4</li>
<li>
USB PIPE5</li>
</ul>
</td><td>USB PIPE4 </td><td>Select the USB pipe to use for bulk input transfers. </td></tr>
<tr class="tree_none">
<td>Bulk Output Transfer Pipe</td><td><ul style="margin-top:0;margin-bottom:0;">
<li>
USB PIPE1</li>
<li>
USB PIPE2</li>
<li>
USB PIPE3</li>
<li>
USB PIPE4</li>
<li>
USB PIPE5</li>
</ul>
</td><td>USB PIPE5 </td><td>Select the USB pipe to use for bulk output transfers. </td></tr>
<tr class="tree_none">
<td>Interrupt In Pipe</td><td><ul style="margin-top:0;margin-bottom:0;">
<li>
USB PIPE6</li>
<li>
USB PIPE7</li>
<li>
USB PIPE8</li>
<li>
USB PIPE9</li>
</ul>
</td><td>USB PIPE6 </td><td>Select the USB pipe to use for interrupts. </td></tr>
</table>
 <h2>Configurations for Connectivity &gt; USB HCDC (r_usb_hcdc)</h2>
This module can be added to the Stacks tab via New Stack &gt; Connectivity &gt; USB HCDC (r_usb_hcdc).<br />
</p><table class="doxtable">
<tr>
<th>Configuration</th><th>Options</th><th>Default</th><th>Description </th></tr>
<tr class="tree_none">
<td>Name</td><td>Name must be a valid C symbol</td><td>g_hcdc0 </td><td>Module name. </td></tr>
</table>
</p>
<dl class="section note"><dt>Note</dt><dd>Refer to the <a class="el" href="group___u_s_b.html">USB (r_usb_basic)</a> module for hardware configuration options.</dd></dl>
<h2><a class="anchor" id="r-usb-hcdc-clock-configuration"></a>
Clock Configuration</h2>
<p>Refer to the <a class="el" href="group___u_s_b.html">USB (r_usb_basic)</a> module.</p>
<h2><a class="anchor" id="r-usb-hcdc-pin-configuration"></a>
Pin Configuration</h2>
<p>Refer to the <a class="el" href="group___u_s_b.html">USB (r_usb_basic)</a> module.</p>
<h1><a class="anchor" id="r-usb-hcdc-usage_notes"></a>
Usage Notes</h1>
<h2>Communications Device Class (CDC), PSTN and ACM</h2>
<p>This software conforms to the Abstract Control Model (ACM) subclass of the Communications Device Class specification as defined in the "USB Communications Class Subclass Specification for PSTN Devices", Revision 1.2. The Abstract Control Model subclass is a technology that bridges the gap between USB devices and earlier modems (employing RS-232C connections) enabling use of application programs designed for older modems.</p>
<p><b>Basic Functions</b></p>
<p>The main functions of HCDC are the following:</p><ul>
<li>Verify connected devices</li>
<li>Make communication line settings</li>
<li>Acquire the communication line state</li>
<li>Transfer data to and from the CDC peripheral device</li>
</ul>
<h3>Abstract Control Model Class Requests - Host to Device</h3>
<p>This driver supports the following class requests:</p>
<table class="doxtable">
<tr>
<th align="left">Request </th><th align="left">Code </th><th align="left">Description  </th></tr>
<tr>
<td align="left">SendEncapsulatedCommand </td><td align="left">0x00 </td><td align="left">Transmits an AT command as defined by the protocol used by the device (normally 0 for USB). </td></tr>
<tr>
<td align="left">GetEncapsulatedResponse </td><td align="left">0x01 </td><td align="left">Requests a response to a command transmitted by SendEncapsulatedCommand. </td></tr>
<tr>
<td align="left">SetCommFeature </td><td align="left">0x02 </td><td align="left">Enables or disables features such as device-specific 2-byte code and country setting. </td></tr>
<tr>
<td align="left">GetCommFeature </td><td align="left">0x03 </td><td align="left">Acquires the enabled/disabled state of features such as device-specific 2-byte code and country setting. </td></tr>
<tr>
<td align="left">ClearCommFeature </td><td align="left">0x04 </td><td align="left">Restores the default enabled/disabled settings of features such as device-specific 2-byte code and country setting. </td></tr>
<tr>
<td align="left">SetLineCoding </td><td align="left">0x20 </td><td align="left">Makes communication line settings (communication speed, data length, parity bit, and stop bit length). </td></tr>
<tr>
<td align="left">GetLineCoding </td><td align="left">0x21 </td><td align="left">Acquires the communication line setting state. </td></tr>
<tr>
<td align="left">SetControlLineState </td><td align="left">0x22 </td><td align="left">Makes communication line control signal (RTS, DTR) settings. </td></tr>
<tr>
<td align="left">SendBreak </td><td align="left">0x23 </td><td align="left">Transmits a break signal. </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>For more information about Abstract Control Model requests, refer to Table 11 "Requests - Abstract Control Model" in the "USB Communications Class Subclass Specification for PSTN Devices", Revision 1.2.</dd></dl>
<p>The expected data format for each command is shown below followed by dependent structures.</p>
<table class="doxtable">
<tr>
<th align="center">bmRequestType </th><th align="center">bRequest </th><th align="center">wValue </th><th align="center">wIndex </th><th align="center">wLength </th><th align="left">Data  </th></tr>
<tr>
<td align="center">0x21 </td><td align="center">SEND_ENCAPSULATED_COMMAND (0x00) </td><td align="center">0x0000 </td><td align="center">0x0000 </td><td align="center">Data length </td><td align="left"><a class="el" href="group___u_s_b___h_c_d_c___a_p_i.html#structusb__hcdc__encapsulated__t">usb_hcdc_encapsulated_t</a> </td></tr>
<tr>
<td align="center">0x21 </td><td align="center">GET_ENCAPSULATED_RESPONSE (0x01) </td><td align="center">0x0000 </td><td align="center">0x0000 </td><td align="center">Data length </td><td align="left"><a class="el" href="group___u_s_b___h_c_d_c___a_p_i.html#structusb__hcdc__encapsulated__t">usb_hcdc_encapsulated_t</a> </td></tr>
<tr>
<td align="center">0x21 </td><td align="center">SET_COMM_FEATURE (0x02) </td><td align="center">usb_hcdc_feature_selector_t </td><td align="center">0x0000 </td><td align="center">Data length </td><td align="left"><a class="el" href="group___u_s_b___h_c_d_c___a_p_i.html#unionusb__hcdc__commfeature__t">usb_hcdc_commfeature_t</a> </td></tr>
<tr>
<td align="center">0x21 </td><td align="center">GET_COMM_FEATURE (0x03) </td><td align="center">usb_hcdc_feature_selector_t </td><td align="center">0x0000 </td><td align="center">Data length </td><td align="left"><a class="el" href="group___u_s_b___h_c_d_c___a_p_i.html#unionusb__hcdc__commfeature__t">usb_hcdc_commfeature_t</a> </td></tr>
<tr>
<td align="center">0x21 </td><td align="center">CLEAR_COMM_FEATURE (0x04) </td><td align="center">usb_hcdc_feature_selector_t </td><td align="center">0x0000 </td><td align="center">Data length </td><td align="left">None </td></tr>
<tr>
<td align="center">0x21 </td><td align="center">SET_LINE_CODING (0x20) </td><td align="center">0x0000 </td><td align="center">0x0000 </td><td align="center">0x0000 </td><td align="left"><a class="el" href="group___u_s_b___h_c_d_c___a_p_i.html#structusb__hcdc__linecoding__t">usb_hcdc_linecoding_t</a> </td></tr>
<tr>
<td align="center">0xA1 </td><td align="center">GET_LINE_CODING (0x21) </td><td align="center">0x0000 </td><td align="center">0x0000 </td><td align="center">0x0007 </td><td align="left"><a class="el" href="group___u_s_b___h_c_d_c___a_p_i.html#structusb__hcdc__linecoding__t">usb_hcdc_linecoding_t</a> </td></tr>
<tr>
<td align="center">0x21 </td><td align="center">SET_CONTROL_LINE_STATE (0x22) </td><td align="center"><a class="el" href="group___u_s_b___h_c_d_c___a_p_i.html#structusb__hcdc__controllinestate__t">usb_hcdc_controllinestate_t</a> </td><td align="center">0x0000 </td><td align="center">0x0000 </td><td align="left">None </td></tr>
<tr>
<td align="center">0x21 </td><td align="center">SEND_BREAK (0x23) </td><td align="center"><a class="el" href="group___u_s_b___h_c_d_c___a_p_i.html#structusb__hcdc__breakduration__t">usb_hcdc_breakduration_t</a> </td><td align="center">0x0000 </td><td align="center">0x0000 </td><td align="left">None </td></tr>
</table>
<h3>ACM Notifications from Device to Host</h3>
<p>The following class notifications are supported:</p>
<table class="doxtable">
<tr>
<th align="left">Notification </th><th align="center">Code </th><th align="left">Description  </th></tr>
<tr>
<td align="left">RESPONSE_AVAILABLE </td><td align="center">0x01 </td><td align="left">Response to GET_ENCAPSULATED_RESPONSE </td></tr>
<tr>
<td align="left">SERIAL_STATE </td><td align="center">0x20 </td><td align="left">Notification of serial line state </td></tr>
</table>
<p>The data types returned are as follows:</p>
<table class="doxtable">
<tr>
<th align="center">bmRequestType </th><th align="left">bRequest </th><th align="center">wValue </th><th align="center">wIndex </th><th align="center">wLength </th><th align="left">Data  </th></tr>
<tr>
<td align="center">0xA1 </td><td align="left">RESPONSE_AVAILABLE (0x01) </td><td align="center">0x0000 </td><td align="center">0x0000 </td><td align="center">0x0000 </td><td align="left">None </td></tr>
<tr>
<td align="center">0xA1 </td><td align="left">SERIAL_STATE (0x20) </td><td align="center">0x0000 </td><td align="center">0x0000 </td><td align="center">0x0002 </td><td align="left"><a class="el" href="group___u_s_b___h_c_d_c___a_p_i.html#structusb__hcdc__serialstate__t">usb_hcdc_serialstate_t</a> </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>The host is notified with SERIAL_STATE whenever a change in the UART port state is detected.</dd></dl>
<h2><a class="anchor" id="r-usb-hcdc-limitations"></a>
Limitations</h2>
<p>This driver is subject to the following limitations:</p>
<ul>
<li>Suspend is not supported when a data transfer is in progress. Confirm that data transfer has completed before executing suspend.</li>
<li>Use of compound USB devices with CDC class support is not supported.</li>
<li>This module must be incorporated into a project using r_usb_basic and does not provide any public APIs.</li>
<li>This driver does not support Low-speed.</li>
<li>This driver does not support simultaneous operation with the other device class.</li>
<li>CDC-ECM requires a TCP/IP driver for USB driver on the upper layer.</li>
<li>The user needs to support the porting layer for TCP/IP when using CDC-ECM.</li>
<li>CDC-ECM works on FreeRTOS.</li>
<li>CDC-ECM was evaluated using the following USB to Ethernet adapter.<ul>
<li>UGREEN USB to Ethernet Adapater RJ45 (Manufacture: Ugreen Group Limited, Item modle number: 50922)</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="r-usb-hcdc-examples"></a>
Examples</h1>
<h2>USB HCDC Loopback Example</h2>
<p>The main functions of the HCDC loopback example are as follows:</p>
<ol type="1">
<li>Virtual UART control settings are configured by transmitting the class request SET_LINE_CODING to the CDC device.</li>
<li>Sends receive (Bulk In transfer) requests to a CDC peripheral device and receives data.</li>
<li>Loops received data back to the peripheral by means of Bulk Out transfers.</li>
</ol>
<div class="image">
<object type="image/svg+xml" data="r_usb_hcdc_data_Transfer.svg">r_usb_hcdc_data_Transfer.svg</object>
<div class="caption">
Data Transfer (Loopback)</div></div>
<p> The main loop performs loopback processing in which data received from a CDC peripheral device is transmitted unaltered back to the peripheral.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#define SET_LINE_CODING           (USB_CDC_SET_LINE_CODING | USB_HOST_TO_DEV | USB_CLASS | USB_INTERFACE)</span></div><div class="line"><span class="preprocessor">#define GET_LINE_CODING           (USB_CDC_GET_LINE_CODING | USB_DEV_TO_HOST | USB_CLASS | USB_INTERFACE)</span></div><div class="line"><span class="preprocessor">#define SET_CONTROL_LINE_STATE    (USB_CDC_SET_CONTROL_LINE_STATE | USB_HOST_TO_DEV | USB_CLASS | USB_INTERFACE)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define COM_SPEED                 (9600U)</span></div><div class="line"><span class="preprocessor">#define COM_DATA_BIT              (8U)</span></div><div class="line"><span class="preprocessor">#define COM_STOP_BIT              (0)</span></div><div class="line"><span class="preprocessor">#define COM_PARITY_BIT            (0)</span></div><div class="line"><span class="preprocessor">#define LINE_CODING_LENGTH        (7)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_apl_callback</span></div><div class="line"><span class="comment"> * Description     : Callback function for Application program</span></div><div class="line"><span class="comment"> * Arguments       : usb_event_info_t *p_api_event    : Control structure for USB API.</span></div><div class="line"><span class="comment"> *               : usb_hdl_t        cur_task        : Task Handle</span></div><div class="line"><span class="comment"> *               : uint8_t          usb_state       : USB_ON(USB_STATUS_REQUEST) / USB_OFF</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> usb_apl_callback (usb_event_info_t * p_api_event, usb_hdl_t cur_task, <a class="code" href="group___u_s_b___a_p_i.html#ga647c9ea8cc8c82a26dcec32f7749c73d">usb_onoff_t</a> usb_state)</div><div class="line">{</div><div class="line">    (void) usb_state;</div><div class="line">    (void) cur_task;</div><div class="line"></div><div class="line">    xQueueSend(g_apl_mbx_hdl, (<span class="keyword">const</span> <span class="keywordtype">void</span> *) &amp;p_api_event, (TickType_t) (0));</div><div class="line">}                                      <span class="comment">/* End of function usb_apl_callback() */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_hcdc_example</span></div><div class="line"><span class="comment"> * Description     : Host CDC application main process</span></div><div class="line"><span class="comment"> * Arguments       : none</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> usb_hcdc_example (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___u_s_b___a_p_i.html#ga56bea25fbffdbda134044c49d40d5e40">usb_status_t</a>     event;</div><div class="line">    usb_event_info_t event_info;</div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)</span></div><div class="line">    usb_event_info_t * p_mess;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a71c50854a60a443915487767eac07b01">open</a>(&amp;g_basic0_ctrl, &amp;g_basic0_cfg);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (1)</div><div class="line">    {</div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)                </span><span class="comment">/* FreeRTOS */</span><span class="preprocessor"></span></div><div class="line">        xQueueReceive(g_apl_mbx_hdl, (<span class="keywordtype">void</span> *) &amp;p_mess, portMAX_DELAY);</div><div class="line"></div><div class="line">        event_info = *p_mess;</div><div class="line">        <span class="keyword">event</span>      = event_info.event;</div><div class="line"><span class="preprocessor">#else                                  </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line">        <span class="comment">/* Get USB event data */</span></div><div class="line">        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#ab9275462e1796a4c109af0dbf7424b4c">eventGet</a>(&amp;event_info, &amp;event);</div><div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line">        <span class="comment">/* Handle the received event (if any) */</span></div><div class="line">        <span class="keywordflow">switch</span> (event)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ab5c3bd23fe62533150eef3a4e8c8d13c">USB_STATUS_CONFIGURED</a>:</div><div class="line"></div><div class="line">                <span class="comment">/* Configure virtual UART settings */</span></div><div class="line">                set_line_coding(&amp;g_basic0_ctrl, event_info.device_address); <span class="comment">/* CDC Class request &quot;SetLineCoding&quot; */</span></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a63dd4552584256ef9d1a0d5da2159e9c">USB_STATUS_READ_COMPLETE</a>:</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2aa31d93178a24f042fb19db6da3b5a2d8">USB_CLASS_HCDC</a> == event_info.type)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (event_info.data_size &gt; 0)</div><div class="line">                    {</div><div class="line">                        <span class="comment">/* Send the received data back to the connected peripheral */</span></div><div class="line"></div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a72dd66056efbc6284c61f557016a75cd">write</a>(&amp;g_basic0_ctrl, g_snd_buf, event_info.data_size, USB_DEVICE_ADDRESS_1);</div><div class="line"></div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span></div><div class="line">                    {</div><div class="line"></div><div class="line">                        <span class="comment">/* Send the data reception request when the zero-length packet is received. */</span></div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a0c728ad83559809e18f18793dfd489ef">read</a>(&amp;g_basic0_ctrl, g_rcv_buf, CDC_DATA_LEN, USB_DEVICE_ADDRESS_1);</div><div class="line"></div><div class="line">                    }</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span>                   <span class="comment">/* USB_HCDCC */</span></div><div class="line">                {</div><div class="line">                    <span class="comment">/* Control Class notification &quot;SerialState&quot; receive start */</span></div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a0c728ad83559809e18f18793dfd489ef">read</a>(&amp;g_basic0_ctrl,</div><div class="line">                                      (uint8_t *) &amp;g_serial_state,</div><div class="line">                                      USB_HCDC_SERIAL_STATE_MSG_LEN,</div><div class="line">                                      USB_DEVICE_ADDRESS_1);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ad44448290b4f36868a09b48e4588b29d">USB_STATUS_WRITE_COMPLETE</a>:</div><div class="line"></div><div class="line">                <span class="comment">/* Start receive operation */</span></div><div class="line">                g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a0c728ad83559809e18f18793dfd489ef">read</a>(&amp;g_basic0_ctrl, g_rcv_buf, CDC_DATA_LEN, USB_DEVICE_ADDRESS_1);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a24e9ad4653245663e5e89bda173141fd">USB_STATUS_REQUEST_COMPLETE</a>:</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (USB_CDC_SET_LINE_CODING == (event_info.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <span class="comment">/* Set virtual RTS/DTR signal state */</span></div><div class="line">                    set_control_line_state(&amp;g_basic0_ctrl, event_info.device_address); <span class="comment">/* CDC Class request &quot;SetControlLineState&quot; */</span></div><div class="line">                }</div><div class="line">                <span class="comment">/* Check Complete request &quot;SetControlLineState&quot; */</span></div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_CDC_SET_CONTROL_LINE_STATE == (event_info.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <span class="comment">/* Read back virtual UART settings */</span></div><div class="line">                    get_line_coding(&amp;g_basic0_ctrl, event_info.device_address); <span class="comment">/* CDC Class request &quot;SetLineCoding&quot; */</span></div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_CDC_GET_LINE_CODING == (event_info.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <span class="comment">/* Now that setup is complete, start loopback operation */</span></div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a0c728ad83559809e18f18793dfd489ef">read</a>(&amp;g_basic0_ctrl, g_snd_buf, CDC_DATA_LEN, USB_DEVICE_ADDRESS_1);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    <span class="comment">/* Unsupported request */</span></div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line"></div><div class="line">                <span class="comment">/* Other event */</span></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">    }</div><div class="line">}                                      <span class="comment">/* End of function usb_hcdc_example() */</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : set_control_line_state</span></div><div class="line"><span class="comment"> * Description     : Send the class request (SetControLineState) to CDC device.</span></div><div class="line"><span class="comment"> * Arguments       : device_address : device address of CDC device.</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> set_control_line_state (<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl, uint8_t device_address)</div><div class="line">{</div><div class="line">    usb_setup_t setup;</div><div class="line"></div><div class="line">    setup.request_type   = SET_CONTROL_LINE_STATE; <span class="comment">/* bRequestCode:SET_CONTROL_LINE_STATE, bmRequestType */</span></div><div class="line">    setup.request_value  = 0x0000;                 <span class="comment">/* wValue:Zero */</span></div><div class="line">    setup.request_index  = 0x0000;                 <span class="comment">/* wIndex:Interface */</span></div><div class="line">    setup.request_length = 0x0000;                 <span class="comment">/* wLength:Zero */</span></div><div class="line"></div><div class="line">    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#ae3776b8be09aed75c6e4314420e5b245">hostControlTransfer</a>(p_ctrl, &amp;setup, (uint8_t *) &amp;g_usb_dummy, device_address);</div><div class="line">} <span class="comment">/* End of function set_control_line_state() */</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : set_line_coding</span></div><div class="line"><span class="comment"> * Description     : Send the class request (SetLineCoding) to CDC device.</span></div><div class="line"><span class="comment"> * Arguments       : device_address : device address of CDC device.</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> set_line_coding (<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl, uint8_t device_address)</div><div class="line">{</div><div class="line">    usb_setup_t setup;</div><div class="line"></div><div class="line">    g_com_parm.dwdte_rate   = (<a class="code" href="group___u_s_b___h_c_d_c___a_p_i.html#ga23d0116191faddf3caa83a32cbccbbd8">usb_hcdc_line_speed_t</a>) COM_SPEED;</div><div class="line">    g_com_parm.bchar_format = (<a class="code" href="group___u_s_b___h_c_d_c___a_p_i.html#ga8a99f2bb7e53f371b7f92457e20cfe54">usb_hcdc_stop_bit_t</a>) COM_STOP_BIT;</div><div class="line">    g_com_parm.bparity_type = (<a class="code" href="group___u_s_b___h_c_d_c___a_p_i.html#ga018a04577fdc4d43125c12f84785f548">usb_hcdc_parity_bit_t</a>) COM_PARITY_BIT;</div><div class="line">    g_com_parm.bdata_bits   = (<a class="code" href="group___u_s_b___h_c_d_c___a_p_i.html#gab219f0f6daf3dfd72efea91ecb9136b3">usb_hcdc_data_bit_t</a>) COM_DATA_BIT;</div><div class="line"></div><div class="line">    setup.request_type   = SET_LINE_CODING;    <span class="comment">/* bRequestCode:SET_LINE_CODING, bmRequestType */</span></div><div class="line">    setup.request_value  = 0x0000;             <span class="comment">/* wValue:Zero */</span></div><div class="line">    setup.request_index  = 0x0000;             <span class="comment">/* wIndex:Interface */</span></div><div class="line">    setup.request_length = LINE_CODING_LENGTH; <span class="comment">/* Data:Line Coding Structure */</span></div><div class="line"></div><div class="line">    <span class="comment">/* Request Control transfer */</span></div><div class="line">    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#ae3776b8be09aed75c6e4314420e5b245">hostControlTransfer</a>(p_ctrl, &amp;setup, (uint8_t *) &amp;g_com_parm, device_address);</div><div class="line">} <span class="comment">/* End of function set_line_coding() */</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : get_line_coding</span></div><div class="line"><span class="comment"> * Description     : Send the class request (GetLineCoding) to CDC device.</span></div><div class="line"><span class="comment"> * Arguments       : device_address : device address of CDC device.</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> get_line_coding (<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl, uint8_t device_address)</div><div class="line">{</div><div class="line">    usb_setup_t setup;</div><div class="line"></div><div class="line">    setup.request_type   = GET_LINE_CODING;    <span class="comment">/* bRequestCode:GET_LINE_CODING, bmRequestType */</span></div><div class="line">    setup.request_value  = 0x0000;             <span class="comment">/* wValue:Zero */</span></div><div class="line">    setup.request_index  = 0x0000;             <span class="comment">/* wIndex:Interface */</span></div><div class="line">    setup.request_length = LINE_CODING_LENGTH; <span class="comment">/* Data:Line Coding Structure */</span></div><div class="line"></div><div class="line">    <span class="comment">/* Request Control transfer */</span></div><div class="line">    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#ae3776b8be09aed75c6e4314420e5b245">hostControlTransfer</a>(p_ctrl, &amp;setup, (uint8_t *) &amp;g_com_parm, device_address);</div><div class="line">} <span class="comment">/* End of function get_line_coding() */</span></div><div class="line"></div></div><!-- fragment --><h2>USB HCDC-ECM Example</h2>
<p>The following is the porting layere example code for FreeRTOS Plus TCP</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#if defined  USE_PING_SEND_DEMO</span></div><div class="line"><span class="preprocessor">#elif defined USE_TCP_CLIENT_DEMO</span></div><div class="line"><span class="preprocessor"> #define BUFFER_SIZE    1514 * 2       // 1024</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> cRxedData[BUFFER_SIZE];</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> cTxData[BUFFER_SIZE];</div><div class="line">Socket_t   vCreateTCPClientSocket(<span class="keywordtype">void</span>);</div><div class="line"><span class="keywordtype">void</span>       vCloseTCPClientSocket(Socket_t xSocket);</div><div class="line">BaseType_t xConnectToTCPServer(Socket_t xSocket);</div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="comment">/* Domain for the DNS Host lookup is used in this Example Project.</span></div><div class="line"><span class="comment"> * The project can be built with different *domain_name to validate the DNS client</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">char</span> * domain_name = USR_TEST_DOMAIN_NAME;</div><div class="line"></div><div class="line"><span class="comment">/* IP address of the PC or any Device on the LAN/WAN where the Ping request is sent.</span></div><div class="line"><span class="comment"> * Note: Users needs to change this according to the LAN settings of your Test PC or device</span></div><div class="line"><span class="comment"> * when running this project.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="comment">// char *remote_ip_address = &quot;132.158.142.140&quot;;</span></div><div class="line"><span class="comment">// char *remote_ip_address = &quot;192.168.1.140&quot;;</span></div><div class="line"><span class="preprocessor">#if (USE_DHCP_CLIENT_DEMO != 0)</span></div><div class="line"><span class="keywordtype">char</span> * remote_ip_address = USR_TEST_PING_IP;</div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="keywordtype">char</span> * remote_ip_address = <span class="stringliteral">&quot;192.168.10.1&quot;</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if (USE_DHCP_CLIENT_DEMO != 0)</span></div><div class="line"></div><div class="line"><span class="comment">/* DHCP populates these IP address, Sub net mask and Gateway Address. So start with this is zeroed out values</span></div><div class="line"><span class="comment"> * The MAC address is Test MAC address.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> uint8_t ucMACAddress[6]       = {0x00, 0x11, 0x22, 0x33, 0x44, 0x55};</div><div class="line"><span class="keyword">static</span> uint8_t ucIPAddress[4]        = {RESET_VALUE};</div><div class="line"><span class="keyword">static</span> uint8_t ucNetMask[4]          = {255, 255, 255, 128};</div><div class="line"><span class="keyword">static</span> uint8_t ucGatewayAddress[4]   = {132, 158, 124, 1};</div><div class="line"><span class="keyword">static</span> uint8_t ucDNSServerAddress[4] = {RESET_VALUE};</div><div class="line"><span class="preprocessor">#else</span></div><div class="line"></div><div class="line"><span class="comment">/* Static IP configuration, when DHCP mode is not used for the Example Project.</span></div><div class="line"><span class="comment"> * This needs to be populated by the user according to the Network Settings of your LAN.</span></div><div class="line"><span class="comment"> * This sample address taken from the LAN where it is tested. This is different for different LAN.</span></div><div class="line"><span class="comment"> * get the Address using the PC IPconfig details.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> uint8_t ucMACAddress[6]       = {0x00, 0x11, 0x22, 0x33, 0x44, 0x55};</div><div class="line"><span class="keyword">static</span> uint8_t ucIPAddress[4]        = {192, 168, 10, 2};</div><div class="line"><span class="keyword">static</span> uint8_t ucNetMask[4]          = {255, 255, 255, 0};</div><div class="line"><span class="keyword">static</span> uint8_t ucGatewayAddress[4]   = {192, 168, 10, 0};</div><div class="line"><span class="keyword">static</span> uint8_t ucDNSServerAddress[4] = {10, 60, 1, 2};</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if (USE_DHCP_CLIENT_DEMO != 0)</span></div><div class="line"><span class="keyword">extern</span> NetworkAddressingParameters_t xNetworkAddressing;</div><div class="line">NetworkAddressingParameters_t        xNd = {RESET_VALUE, RESET_VALUE, RESET_VALUE, RESET_VALUE, RESET_VALUE};</div><div class="line">uint32_t        usrPingCount             = RESET_VALUE;</div><div class="line"><span class="keyword">static</span> uint32_t usr_print_ability        = RESET_VALUE;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">uint32_t    dhcp_in_use = RESET_VALUE;</div><div class="line">ping_data_t ping_data   = {RESET_VALUE, RESET_VALUE, RESET_VALUE};</div><div class="line"></div><div class="line">uint32_t ulRand (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* example of a 32-bit random number generator.</span></div><div class="line"><span class="comment">     * Here rand() returns a 15-bit number. so create 32 bit Random number using 15 bit rand()</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    uint32_t ulResult =</div><div class="line">        ((((uint32_t) rand()) &amp; 0x7fffuL)) |</div><div class="line">        ((((uint32_t) rand()) &amp; 0x7fffuL) &lt;&lt; 15) |</div><div class="line">        ((((uint32_t) rand()) &amp; 0x0003uL) &lt;&lt; 30);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> ulResult;</div><div class="line">}</div><div class="line"></div><div class="line">uint32_t ulApplicationGetNextSequenceNumber (uint32_t ulSourceAddress,</div><div class="line">                                             uint16_t usSourcePort,</div><div class="line">                                             uint32_t ulDestinationAddress,</div><div class="line">                                             uint16_t usDestinationPort)</div><div class="line">{</div><div class="line"></div><div class="line">    <span class="comment">/* Here we need to get random number for the sequence number.</span></div><div class="line"><span class="comment">     * This is just for testing purpose, so software rand() is okay.</span></div><div class="line"><span class="comment">     * This can also be tied to the TRNG.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keywordflow">return</span> (ulSourceAddress + ulDestinationAddress + usSourcePort + usDestinationPort) &amp;&amp; ulRand();</div><div class="line">}</div><div class="line"></div><div class="line">BaseType_t vSendPing (<span class="keyword">const</span> <span class="keywordtype">char</span> * pcIPAddress)</div><div class="line">{</div><div class="line">    uint32_t ulIPAddress = RESET_VALUE;</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * The pcIPAddress parameter holds the destination IP address as a string in</span></div><div class="line"><span class="comment">     * decimal dot notation (for example, ?192.168.0.200?). Convert the string into</span></div><div class="line"><span class="comment">     * the required 32-bit format.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    ulIPAddress = FreeRTOS_inet_addr(pcIPAddress);</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * Send a ping request containing 8 data bytes.  Wait (in the Blocked state) a</span></div><div class="line"><span class="comment">     * maximum of 100ms for a network buffer into which the generated ping request</span></div><div class="line"><span class="comment">     * can be written and sent.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keywordflow">return</span> FreeRTOS_SendPingRequest(ulIPAddress, 8, 1000000 / portTICK_PERIOD_MS);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> vApplicationPingReplyHook (ePingReplyStatus_t eStatus, uint16_t usIdentifier)</div><div class="line">{</div><div class="line">    (void) usIdentifier;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (eStatus)</div><div class="line">    {</div><div class="line">        <span class="comment">/* A valid ping reply has been received */</span></div><div class="line">        <span class="keywordflow">case</span> eSuccess:</div><div class="line">            ping_data.received++;</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">        <span class="comment">/* A reply was received but it was not valid. */</span></div><div class="line">        <span class="keywordflow">case</span> eInvalidData:</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            ping_data.lost++;</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">uint32_t isNetworkUp (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>  eth_link_status = <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#ggadfb1288da0fcc7ae1dc88c58601374f8a50831305d5da65885b19304af8688f1a">FSP_ERR_NOT_OPEN</a>;</div><div class="line">    BaseType_t networkUp       = pdFALSE;</div><div class="line">    uint32_t   network_status  = (IP_LINK_UP | ETHERNET_LINK_UP);</div><div class="line"></div><div class="line">    networkUp       = FreeRTOS_IsNetworkUp();</div><div class="line">    eth_link_status = xGetPhyLinkStatus();</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ((pdPASS == eth_link_status) &amp;&amp; (pdTRUE == networkUp))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> network_status;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (pdPASS != eth_link_status)</div><div class="line">        {</div><div class="line">            network_status |= ETHERNET_LINK_DOWN;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pdPASS == eth_link_status)</div><div class="line">        {</div><div class="line">            network_status |= ETHERNET_LINK_UP;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (pdTRUE != networkUp)</div><div class="line">        {</div><div class="line">            network_status |= IP_LINK_DOWN;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pdTRUE == networkUp)</div><div class="line">        {</div><div class="line">            network_status |= IP_LINK_UP;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> network_status;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#if defined USE_LINK_STATUS_CHECK</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> prvLinkStatusCheckTask (<span class="keywordtype">void</span> * pvParameters)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> eth_link_status     = pdFAIL;</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> eth_link_pre_status = pdFAIL;</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (1)</div><div class="line">    {</div><div class="line">        eth_link_status = xGetPhyLinkStatus();</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> ((pdPASS == eth_link_status) &amp;&amp; (pdFAIL == eth_link_pre_status))</div><div class="line">        {</div><div class="line">            APP_PRINT(<span class="stringliteral">&quot;\r\n-- Link Up --&quot;</span>);</div><div class="line">            eth_link_pre_status = pdPASS;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pdFAIL == eth_link_status) &amp;&amp; (pdPASS == eth_link_pre_status))</div><div class="line">        {</div><div class="line">            APP_PRINT(<span class="stringliteral">&quot;\r\n-- Link Down --&quot;</span>);</div><div class="line">            eth_link_pre_status = pdFAIL;</div><div class="line">        }</div><div class="line"></div><div class="line">        vTaskDelay(100);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> new_thread0_entry (<span class="keywordtype">void</span> * pvParameters)</div><div class="line">{</div><div class="line">    BaseType_t         status  = pdFALSE;</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___c_o_m_m_o_n.html#unionfsp__pack__version__t">fsp_pack_version_t</a> version = {RESET_VALUE};</div><div class="line"><span class="preprocessor">#if defined  USE_PING_SEND_DEMO</span></div><div class="line"><span class="preprocessor">#elif defined USE_TCP_CLIENT_DEMO</span></div><div class="line">    Socket_t   xClientSocket;</div><div class="line">    BaseType_t lBytesReceived;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(pvParameters);</div><div class="line"></div><div class="line">    <span class="comment">/* version get API for FLEX pack information */</span></div><div class="line">    <a class="code" href="group___b_s_p___m_c_u.html#gaf3ee66233fc75acfcc21a97d7a767aa1">R_FSP_VersionGet</a>(&amp;version);</div><div class="line"></div><div class="line">    <span class="comment">/* Example Project information printed on the RTT */</span></div><div class="line">    APP_PRINT(BANNER_INFO,</div><div class="line">              EP_VERSION,</div><div class="line">              version.version_id_b.<a class="code" href="group___r_e_n_e_s_a_s___c_o_m_m_o_n.html#a85964fe9ef31d11bde39475763db564c">major</a>,</div><div class="line">              version.version_id_b.<a class="code" href="group___r_e_n_e_s_a_s___c_o_m_m_o_n.html#a00ab09fb1ebf2eb2ca08e364a3289e44">minor</a>,</div><div class="line">              version.version_id_b.<a class="code" href="group___r_e_n_e_s_a_s___c_o_m_m_o_n.html#ab2723e465037db8a30e2cb2e2392a98f">patch</a>);</div><div class="line"></div><div class="line">    <span class="comment">/* Prints the Ethernet Configuration prior to the IP Init*/</span></div><div class="line">    APP_PRINT(ETH_PREINIT);</div><div class="line">    print_ipconfig();</div><div class="line"></div><div class="line"><span class="preprocessor">#if defined USE_LINK_STATUS_CHECK</span></div><div class="line">    <span class="keyword">static</span> TaskHandle_t xLinkStatusCheckTaskHandle = NULL;</div><div class="line">    BaseType_t          xReturn = pdFAIL;</div><div class="line">    xReturn = xTaskCreate(prvLinkStatusCheckTask,</div><div class="line">                          <span class="stringliteral">&quot;LinkStatusCheckTask&quot;</span>,</div><div class="line">                          configMINIMAL_STACK_SIZE,</div><div class="line">                          NULL,</div><div class="line">                          2,           <span class="comment">// configMAX_PRIORITIES - 3,</span></div><div class="line">                          &amp;xLinkStatusCheckTaskHandle);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="comment">/* FreeRTOS IP Initialization: This init initializes the IP stack  */</span></div><div class="line">    status = FreeRTOS_IPInit(ucIPAddress, ucNetMask, ucGatewayAddress, ucDNSServerAddress, ucMACAddress);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (pdFALSE == status)</div><div class="line">    {</div><div class="line">        APP_ERR_PRINT(<span class="stringliteral">&quot;FreeRTOS_IPInit Failed&quot;</span>);</div><div class="line">        APP_ERR_TRAP(status);</div><div class="line">    }</div><div class="line"></div><div class="line">    APP_PRINT(ETH_POSTINIT);</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line">    {</div><div class="line"><span class="preprocessor">#if (USE_DHCP_CLIENT_DEMO != 0)</span></div><div class="line"></div><div class="line">        <span class="comment">/* Check if Both the Ethernet Link and IP link are UP */</span></div><div class="line">        <span class="keywordflow">if</span> (SUCCESS == isNetworkUp())</div><div class="line">        {</div><div class="line">            <span class="comment">/* usr_print_ability is added to avoid multiple UP messages or Down Messages repeating*/</span></div><div class="line">            <span class="keywordflow">if</span> (!(PRINT_UP_MSG_DISABLE &amp; usr_print_ability))</div><div class="line">            {</div><div class="line">                APP_PRINT(<span class="stringliteral">&quot;\r\nNetwork is Up&quot;</span>);</div><div class="line">                usr_print_ability |= PRINT_UP_MSG_DISABLE;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (!(PRINT_NWK_USR_MSG_DISABLE &amp; usr_print_ability))</div><div class="line">            {</div><div class="line">                <span class="comment">/* Display the New IP credentials obtained from the DHCP server */</span></div><div class="line">                updateDhcpResponseToUsr();</div><div class="line"></div><div class="line">                <span class="comment">/* Updated IP credentials on to the RTT console */</span></div><div class="line">                print_ipconfig();</div><div class="line"></div><div class="line">                <span class="comment">/*DNS lookup for the Domain name requested. This is Synchronous Activity */</span></div><div class="line">                dnsQuerryFunc(domain_name);</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (!(PRINT_NWK_USR_MSG_DISABLE &amp; usr_print_ability))</div><div class="line">            {</div><div class="line">                APP_PRINT(<span class="stringliteral">&quot;\r\nPinging %s:\r\n\r\n&quot;</span>, (<span class="keywordtype">char</span> *) remote_ip_address);</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">while</span> (usrPingCount &lt; USR_PING_COUNT)</div><div class="line">            {</div><div class="line">                <span class="comment">/* Send a ICMP Ping request to the requested IP address</span></div><div class="line"><span class="comment">                 * USR_PING_COUNT (100) is used in this Example Project</span></div><div class="line"><span class="comment">                 * For Continuous testing the count can be increased to bigger number</span></div><div class="line"><span class="comment">                 */</span></div><div class="line">                status = vSendPing((<span class="keywordtype">char</span> *) remote_ip_address);</div><div class="line">                <span class="keywordflow">if</span> (status != pdFALSE)</div><div class="line">                {</div><div class="line">                    ping_data.sent++;</div><div class="line">                    APP_PRINT(<span class="stringliteral">&quot;!&quot;</span>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    ping_data.lost++;</div><div class="line">                    APP_PRINT(<span class="stringliteral">&quot;.&quot;</span>);</div><div class="line">                }</div><div class="line"></div><div class="line">                usrPingCount++;</div><div class="line"></div><div class="line">                <span class="comment">/* Add some delay between Pings */</span></div><div class="line">                vTaskDelay(10);</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (!(PRINT_NWK_USR_MSG_DISABLE &amp; usr_print_ability))</div><div class="line">            {</div><div class="line">                print_pingResult();</div><div class="line">                usr_print_ability |= PRINT_NWK_USR_MSG_DISABLE;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (!(PRINT_DOWN_MSG_DISABLE &amp; usr_print_ability))</div><div class="line">            {</div><div class="line">                APP_PRINT(<span class="stringliteral">&quot;\r\nNetwork is Down&quot;</span>);</div><div class="line">                usr_print_ability |= PRINT_DOWN_MSG_DISABLE;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                APP_PRINT(<span class="stringliteral">&quot;.&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        vTaskDelay(100);</div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor"> #if defined  USE_PING_SEND_DEMO</span></div><div class="line"></div><div class="line">        <span class="comment">/* [Provisional processing] Wait until the link is up */</span></div><div class="line">        <span class="keywordflow">if</span> (SUCCESS == isNetworkUp())</div><div class="line">        {</div><div class="line">            <span class="keywordflow">while</span> (1)</div><div class="line">            {</div><div class="line">                status = vSendPing((<span class="keywordtype">char</span> *) remote_ip_address);</div><div class="line">                <span class="keywordflow">if</span> (status != pdFALSE)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (SUCCESS != isNetworkUp())</div><div class="line">                    {</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line"></div><div class="line">                    vTaskDelay(2000);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        vTaskDelay(100);</div><div class="line"><span class="preprocessor"> #elif defined USE_TCP_CLIENT_DEMO</span></div><div class="line">        <span class="keywordflow">if</span> (SUCCESS == isNetworkUp())</div><div class="line">        {</div><div class="line">            <span class="comment">/* Create, bind and connect a socket */</span></div><div class="line">            xClientSocket = vCreateTCPClientSocket();</div><div class="line"></div><div class="line">            <span class="keywordflow">while</span> (1)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (pdTRUE == xConnectToTCPServer(xClientSocket))</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                vTaskDelay(1000);</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="comment">/* Receive data from TCP Server. */</span></div><div class="line">            lBytesReceived = FreeRTOS_recv(xClientSocket, &amp;cRxedData, BUFFER_SIZE, 0);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (lBytesReceived &gt; 0)</div><div class="line">            {</div><div class="line">                memcpy(&amp;cTxData, &amp;cRxedData, (<span class="keywordtype">size_t</span>) lBytesReceived);</div><div class="line"></div><div class="line">                <span class="comment">/* Send data to TCP Server. (Loopback received data) */</span></div><div class="line">                FreeRTOS_send(xClientSocket, &amp;cTxData, (<span class="keywordtype">size_t</span>) lBytesReceived, 0);</div><div class="line"></div><div class="line">                vTaskDelay(1000);</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="comment">/* Close socket */</span></div><div class="line">            vCloseTCPClientSocket(xClientSocket);</div><div class="line">        }</div><div class="line"></div><div class="line">        vTaskDelay(1000);</div><div class="line"><span class="preprocessor"> #else</span></div><div class="line">        vTaskDelay(100);</div><div class="line"><span class="preprocessor"> #endif</span></div><div class="line">        vTaskDelay(100);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#if defined  USE_PING_SEND_DEMO</span></div><div class="line"><span class="preprocessor">#elif defined USE_TCP_CLIENT_DEMO</span></div><div class="line">Socket_t vCreateTCPClientSocket (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    Socket_t                 xClientSocket;</div><div class="line">    <span class="keyword">struct </span>freertos_sockaddr xBindAddress;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> TickType_t  xTimeOut = pdMS_TO_TICKS(10000);</div><div class="line"></div><div class="line"><span class="comment">// static const TickType_t xTimeOut = pdMS_TO_TICKS( 2000 );</span></div><div class="line"></div><div class="line">    <span class="comment">/* Attempt to open the socket. */</span></div><div class="line">    xClientSocket = FreeRTOS_socket(FREERTOS_AF_INET,</div><div class="line">                                    FREERTOS_SOCK_STREAM, <span class="comment">/* SOCK_STREAM for TCP. */</span></div><div class="line">                                    FREERTOS_IPPROTO_TCP);</div><div class="line"></div><div class="line">    <span class="comment">/* Check the socket was created. */</span></div><div class="line">    configASSERT(xClientSocket != FREERTOS_INVALID_SOCKET);</div><div class="line"></div><div class="line">    <span class="comment">/* If FREERTOS_SO_RCVBUF or FREERTOS_SO_SNDBUF are to be used with</span></div><div class="line"><span class="comment">     * FreeRTOS_setsockopt() to change the buffer sizes from their default then do</span></div><div class="line"><span class="comment">     * it here!.  (see the FreeRTOS_setsockopt() documentation. */</span></div><div class="line"></div><div class="line">    <span class="comment">/* If ipconfigUSE_TCP_WIN is set to 1 and FREERTOS_SO_WIN_PROPERTIES is to</span></div><div class="line"><span class="comment">     * be used with FreeRTOS_setsockopt() to change the sliding window size from</span></div><div class="line"><span class="comment">     * its default then do it here! (see the FreeRTOS_setsockopt()</span></div><div class="line"><span class="comment">     * documentation. */</span><span class="comment">/* Set send and receive time outs. */</span></div><div class="line">    FreeRTOS_setsockopt(xClientSocket, 0, FREERTOS_SO_RCVTIMEO, &amp;xTimeOut, <span class="keyword">sizeof</span>(xTimeOut));</div><div class="line"></div><div class="line">    FreeRTOS_setsockopt(xClientSocket, 0, FREERTOS_SO_SNDTIMEO, &amp;xTimeOut, <span class="keyword">sizeof</span>(xTimeOut));</div><div class="line"></div><div class="line">    <span class="comment">/* Bind the socket, but pass in NULL to let FreeRTOS-Plus-TCP choose the port number.</span></div><div class="line"><span class="comment">     * See the next source code snipped for an example of how to bind to a specific</span></div><div class="line"><span class="comment">     * port number. */</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (xClientSocket != FREERTOS_INVALID_SOCKET)</div><div class="line">    {</div><div class="line">        xBindAddress.sin_port = FreeRTOS_htons(9999);</div><div class="line">        <span class="keywordflow">if</span> (FreeRTOS_bind(xClientSocket, &amp;xBindAddress, <span class="keyword">sizeof</span>(xBindAddress)) == 0)</div><div class="line">        {</div><div class="line">            <span class="comment">/* The bind was successful. */</span></div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <span class="keywordflow">while</span> (1)</div><div class="line">            {</div><div class="line">                ;                      <span class="comment">/* error */</span></div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">while</span> (1)</div><div class="line">        {</div><div class="line">            ;                          <span class="comment">/* error */</span></div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> xClientSocket;</div><div class="line">}</div><div class="line"></div><div class="line">BaseType_t xConnectToTCPServer (Socket_t xSocket)</div><div class="line">{</div><div class="line">    BaseType_t               ret;</div><div class="line">    <span class="keyword">struct </span>freertos_sockaddr xRemoteAddress;</div><div class="line"></div><div class="line">    <span class="comment">/* Connect to TCP Server */</span></div><div class="line">    xRemoteAddress.sin_addr = FreeRTOS_inet_addr_quick(192, 168, 10, 1); <span class="comment">/* 192.168.10.1 : Remote IP Address */</span></div><div class="line">    xRemoteAddress.sin_port = FreeRTOS_htons(4000);</div><div class="line"></div><div class="line">    ret = FreeRTOS_connect(xSocket, &amp;xRemoteAddress, <span class="keyword">sizeof</span>(xRemoteAddress));</div><div class="line">    <span class="keywordflow">if</span> (ret == 0)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Success */</span></div><div class="line">        ret = pdTRUE;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="comment">// while(1); /* error */</span></div><div class="line">        ret = pdFALSE;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> ret;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> vCloseTCPClientSocket (Socket_t xSocket)</div><div class="line">{</div><div class="line">    <span class="comment">/* Initiate graceful shutdown. */</span></div><div class="line">    FreeRTOS_shutdown(xSocket, FREERTOS_SHUT_RDWR);</div><div class="line"></div><div class="line">    <span class="comment">/* Wait for the socket to disconnect gracefully (indicated by FreeRTOS_recv()</span></div><div class="line"><span class="comment">     * returning a -pdFREERTOS_ERRNO_EINVAL error) before closing the socket. */</span></div><div class="line">    <span class="keywordflow">while</span> (FreeRTOS_recv(xSocket, &amp;cRxedData, BUFFER_SIZE, 0) &gt;= 0)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Wait for shutdown to complete.  If a receive block time is used then</span></div><div class="line"><span class="comment">         * this delay will not be necessary as FreeRTOS_recv() will place the RTOS task</span></div><div class="line"><span class="comment">         * into the Blocked state anyway. */</span></div><div class="line">        vTaskDelay(250);</div><div class="line"></div><div class="line">        <span class="comment">/* Note - real applications should implement a timeout here, not just</span></div><div class="line"><span class="comment">         * loop forever. */</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* The socket has shut down and is safe to close. */</span></div><div class="line">    FreeRTOS_closesocket(xSocket);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if (USE_DHCP_CLIENT_DEMO != 0)</span></div><div class="line">eDHCPCallbackAnswer_t xApplicationDHCPHook (eDHCPCallbackPhase_t eDHCPPhase, uint32_t ulIPAddress)</div><div class="line">{</div><div class="line">    eDHCPCallbackAnswer_t eReturn = eDHCPContinue;</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * This hook is called in a couple of places during the DHCP process, as identified by the eDHCPPhase parameter.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keywordflow">switch</span> (eDHCPPhase)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">case</span> eDHCPPhasePreDiscover:</div><div class="line"></div><div class="line">            <span class="comment">/*</span></div><div class="line"><span class="comment">             *  A DHCP discovery is about to be sent out.  eDHCPContinue is returned to allow the discovery to go out.</span></div><div class="line"><span class="comment">             *  If eDHCPUseDefaults had been returned instead then the DHCP process would be stopped and the statically</span></div><div class="line"><span class="comment">             *  configured IP address would be used.</span></div><div class="line"><span class="comment">             *  If eDHCPStopNoChanges had been returned instead then the DHCP process would be stopped and whatever the</span></div><div class="line"><span class="comment">             *  current network configuration was would continue to be used.</span></div><div class="line"><span class="comment">             */</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> eDHCPPhasePreRequest:</div><div class="line"></div><div class="line">            <span class="comment">/* An offer has been received from the DHCP server, and the offered IP address is passed in the ulIPAddress</span></div><div class="line"><span class="comment">             * parameter.</span></div><div class="line"><span class="comment">             */</span></div><div class="line"></div><div class="line">            <span class="comment">/*</span></div><div class="line"><span class="comment">             * The sub-domains don?t match, so continue with the DHCP process so the offered IP address is used.</span></div><div class="line"><span class="comment">             */</span></div><div class="line"></div><div class="line">            <span class="comment">/* Update the Structure, the DHCP state Machine is not updating this */</span></div><div class="line">            xNetworkAddressing.ulDefaultIPAddress = ulIPAddress;</div><div class="line">            dhcp_in_use = 1;</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line"></div><div class="line">            <span class="comment">/*</span></div><div class="line"><span class="comment">             * Cannot be reached, but set eReturn to prevent compiler warnings where compilers are disposed to generating one.</span></div><div class="line"><span class="comment">             */</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> eReturn;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> print_pingResult (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    APP_PRINT(<span class="stringliteral">&quot;\r\n \r\nPing Statistics for %s :\r\n&quot;</span>, (<span class="keywordtype">char</span> *) remote_ip_address);</div><div class="line">    APP_PRINT(<span class="stringliteral">&quot;\r\nPackets: Sent  = %02d, Received = %02d, Lost = %02d \r\n&quot;</span>,</div><div class="line">              ping_data.sent,</div><div class="line">              ping_data.received,</div><div class="line">              ping_data.lost);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> print_ipconfig (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"><span class="preprocessor">#if (USE_DHCP_CLIENT_DEMO != 0)</span></div><div class="line">    <span class="keywordflow">if</span> (dhcp_in_use)</div><div class="line">    {</div><div class="line">        ucNetMask[3] = (uint8_t) ((xNd.ulNetMask &amp; 0xFF000000) &gt;&gt; 24);</div><div class="line">        ucNetMask[2] = (uint8_t) ((xNd.ulNetMask &amp; 0x00FF0000) &gt;&gt; 16);</div><div class="line">        ucNetMask[1] = (uint8_t) ((xNd.ulNetMask &amp; 0x0000FF00) &gt;&gt; 8);</div><div class="line">        ucNetMask[0] = (uint8_t) (xNd.ulNetMask &amp; 0x000000FF);</div><div class="line"></div><div class="line">        ucGatewayAddress[3] = (uint8_t) ((xNd.ulGatewayAddress &amp; 0xFF000000) &gt;&gt; 24);;</div><div class="line">        ucGatewayAddress[2] = (uint8_t) ((xNd.ulGatewayAddress &amp; 0x00FF0000) &gt;&gt; 16);</div><div class="line">        ucGatewayAddress[1] = (uint8_t) ((xNd.ulGatewayAddress &amp; 0x0000FF00) &gt;&gt; 8);</div><div class="line">        ucGatewayAddress[0] = (uint8_t) (xNd.ulGatewayAddress &amp; 0x000000FF);</div><div class="line"></div><div class="line">        ucDNSServerAddress[3] = (uint8_t) ((xNd.ulDNSServerAddress &amp; 0xFF000000) &gt;&gt; 24);</div><div class="line">        ucDNSServerAddress[2] = (uint8_t) ((xNd.ulDNSServerAddress &amp; 0x00FF0000) &gt;&gt; 16);</div><div class="line">        ucDNSServerAddress[1] = (uint8_t) ((xNd.ulDNSServerAddress &amp; 0x0000FF00) &gt;&gt; 8);</div><div class="line">        ucDNSServerAddress[0] = (uint8_t) (xNd.ulDNSServerAddress &amp; 0x000000FF);</div><div class="line"></div><div class="line">        ucIPAddress[3] = (uint8_t) ((xNd.ulDefaultIPAddress &amp; 0xFF000000) &gt;&gt; 24);</div><div class="line">        ucIPAddress[2] = (uint8_t) ((xNd.ulDefaultIPAddress &amp; 0x00FF0000) &gt;&gt; 16);</div><div class="line">        ucIPAddress[1] = (uint8_t) ((xNd.ulDefaultIPAddress &amp; 0x0000FF00) &gt;&gt; 8);</div><div class="line">        ucIPAddress[0] = (uint8_t) (xNd.ulDefaultIPAddress &amp; 0x000000FF);</div><div class="line">    }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    APP_PRINT(<span class="stringliteral">&quot;\r\nEthernet adapter for Renesas &quot;</span>KIT_NAME <span class="stringliteral">&quot;:\r\n&quot;</span>)</div><div class="line"></div><div class="line">    APP_PRINT(<span class="stringliteral">&quot;\tDescription . . . . . . . . . . . : Renesas &quot;</span>KIT_NAME <span class="stringliteral">&quot; Ethernet\r\n&quot;</span>);</div><div class="line">    APP_PRINT(<span class="stringliteral">&quot;\tPhysical Address. . . . . . . . . : %02x-%02x-%02x-%02x-%02x-%02x\r\n&quot;</span>,</div><div class="line">              ucMACAddress[0],</div><div class="line">              ucMACAddress[1],</div><div class="line">              ucMACAddress[2],</div><div class="line">              ucMACAddress[3],</div><div class="line">              ucMACAddress[4],</div><div class="line">              ucMACAddress[5]);</div><div class="line">    APP_PRINT(<span class="stringliteral">&quot;\tDHCP Enabled. . . . . . . . . . . : %s\r\n&quot;</span>, dhcp_in_use ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>)</div><div class="line">    APP_PRINT(<span class="stringliteral">&quot;\tIPv4 Address. . . . . . . . . . . : %d.%d.%d.%d\r\n&quot;</span>,</div><div class="line">              ucIPAddress[0],</div><div class="line">              ucIPAddress[1],</div><div class="line">              ucIPAddress[2],</div><div class="line">              ucIPAddress[3]);</div><div class="line">    APP_PRINT(<span class="stringliteral">&quot;\tSubnet Mask . . . . . . . . . . . : %d.%d.%d.%d\r\n&quot;</span>,</div><div class="line">              ucNetMask[0],</div><div class="line">              ucNetMask[1],</div><div class="line">              ucNetMask[2],</div><div class="line">              ucNetMask[3]);</div><div class="line">    APP_PRINT(<span class="stringliteral">&quot;\tDefault Gateway . . . . . . . . . : %d.%d.%d.%d\r\n&quot;</span>,</div><div class="line">              ucGatewayAddress[0],</div><div class="line">              ucGatewayAddress[1],</div><div class="line">              ucGatewayAddress[2],</div><div class="line">              ucGatewayAddress[3]);</div><div class="line">    APP_PRINT(<span class="stringliteral">&quot;\tDNS Servers . . . . . . . . . . . : %d.%d.%d.%d\r\n&quot;</span>,</div><div class="line">              ucDNSServerAddress[0],</div><div class="line">              ucDNSServerAddress[1],</div><div class="line">              ucDNSServerAddress[2],</div><div class="line">              ucDNSServerAddress[3]);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> dnsQuerryFunc (<span class="keywordtype">char</span> * domain)</div><div class="line">{</div><div class="line">    uint32_t ulIPAddress = RESET_VALUE;</div><div class="line">    int8_t   cBuffer[16] = {RESET_VALUE};</div><div class="line"></div><div class="line">    <span class="comment">/* Lookup the IP address of the FreeRTOS.org website. */</span></div><div class="line">    ulIPAddress = FreeRTOS_gethostbyname((<span class="keywordtype">char</span> *) domain);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (ulIPAddress != 0)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Convert the IP address to a string. */</span></div><div class="line">        FreeRTOS_inet_ntoa(ulIPAddress, (<span class="keywordtype">char</span> *) cBuffer);</div><div class="line"></div><div class="line">        <span class="comment">/* Print out the IP address obtained from the DNS lookup. */</span></div><div class="line">        APP_PRINT(<span class="stringliteral">&quot;\r\nDNS Lookup for \&quot;www.freertos.org\&quot; is      : %s  \r\n&quot;</span>, cBuffer);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        APP_PRINT(<span class="stringliteral">&quot;\r\nDNS Lookup failed for \&quot;www.freertos.org\&quot; \r\n&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#if (USE_DHCP_CLIENT_DEMO != 0)</span></div><div class="line"><span class="keywordtype">void</span> updateDhcpResponseToUsr (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (dhcp_in_use)</div><div class="line">    {</div><div class="line">        memcpy(&amp;xNd, &amp;xNetworkAddressing, <span class="keyword">sizeof</span>(xNd));</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if (ipconfigDHCP_REGISTER_HOSTNAME == 1)</span></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> * pcApplicationHostnameHook (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> KIT_NAME;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div></div><!-- fragment --> <h2>USB HCDC-ECM FreeRTOS Plus TCP Porting Layer Example</h2>
<p>The following is HCDC-ECM example code sample for FreeRTOS Plus TCP</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="comment">/***********************************************************************************************************************</span></div><div class="line"><span class="comment"> * Macro definitions</span></div><div class="line"><span class="comment"> ***********************************************************************************************************************/</span></div><div class="line"></div><div class="line"><span class="comment">/* If ipconfigETHERNET_DRIVER_FILTERS_FRAME_TYPES is set to 1, then the Ethernet</span></div><div class="line"><span class="comment"> * driver will filter incoming packets and only pass the stack those packets it</span></div><div class="line"><span class="comment"> * considers need processing. */</span></div><div class="line"><span class="preprocessor">#if (ipconfigETHERNET_DRIVER_FILTERS_FRAME_TYPES == 0)</span></div><div class="line"><span class="preprocessor"> #define ipCONSIDER_FRAME_FOR_PROCESSING(pucEthernetBuffer)    eProcessBuffer</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor"> #define ipCONSIDER_FRAME_FOR_PROCESSING(pucEthernetBuffer)    eConsiderFrameForProcessing((pucEthernetBuffer))</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MAXIMUM_ETHERNET_FRAME_SIZE          (1514U)</span></div><div class="line"><span class="preprocessor">#define UNSIGNED_SHORT_RANDOM_NUMBER_MASK    (0xFFFFUL)</span></div><div class="line"><span class="preprocessor">#define ETHER_LINK_STATUS_CHECK_INTERVAL     (100)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define USB_MAX_PACKET_SIZE_FS               (64)</span></div><div class="line"><span class="preprocessor">#define USB_MAX_PACKET_SIZE_HS               (512)</span></div><div class="line"><span class="preprocessor">#define USB_CALLBACK_QUEUE_SIZE              (10)</span></div><div class="line"><span class="preprocessor">#define CDC_READ_DATA_LEN                    MAXIMUM_ETHERNET_FRAME_SIZE * 2</span></div><div class="line"><span class="preprocessor">#define NO_WAIT_TIME                         (0)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define VALUE_ZERO                           (0)</span></div><div class="line"><span class="preprocessor">#define VALUE_9                              (9)</span></div><div class="line"><span class="preprocessor">#define VALUE_0001H                          (0x0001)</span></div><div class="line"><span class="preprocessor">#define VALUE_0002H                          (0x0002)</span></div><div class="line"><span class="preprocessor">#define VALUE_0003H                          (0x0003)</span></div><div class="line"><span class="preprocessor">#define VALUE_001FH                          (0x001F)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define CDC_SUB_CLASS_ACM                    (0x02)</span></div><div class="line"><span class="preprocessor">#define CDC_SUB_CLASS_ECM                    (0x06)</span></div><div class="line"><span class="preprocessor">#define CDC_INTERRUPT_READ_DATA_LEN          (16)</span></div><div class="line"><span class="preprocessor">#define SET_ETHERNET_PACKET_FILTER           (0x4300)</span></div><div class="line"><span class="preprocessor">#define VALUE_ZERO                           (0)</span></div><div class="line"><span class="preprocessor">#define VALUE_9                              (9)</span></div><div class="line"><span class="preprocessor">#define VALUE_0001H                          (0x0001)</span></div><div class="line"><span class="preprocessor">#define VALUE_0002H                          (0x0002)</span></div><div class="line"><span class="preprocessor">#define VALUE_0003H                          (0x0003)</span></div><div class="line"><span class="preprocessor">#define VALUE_001FH                          (0x001F)</span></div><div class="line"><span class="preprocessor">#define USB_ECM_TEST_DEVICE_VID              (0x0b95) </span><span class="comment">/* USB-LAN conversion adapter&#39;s Vendor ID */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#define USB_ECM_TEST_DEVICE_PID              (0x1790) </span><span class="comment">/* USB-LAN conversion adapter&#39;s Product ID */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line"><span class="comment">/***********************************************************************************************************************</span></div><div class="line"><span class="comment"> * Exported global variables (to be accessed by other files)</span></div><div class="line"><span class="comment"> **********************************************************************************************************************/</span></div><div class="line"><span class="keyword">volatile</span> <span class="keywordtype">bool</span> g_err_flag = <span class="keyword">false</span>;                     <span class="comment">/* flag bit */</span></div><div class="line">QueueHandle_t g_usb_read_complete_queue;</div><div class="line">QueueHandle_t g_usb_write_complete_queue;</div><div class="line">usb_utr_t     g_utr;</div><div class="line">uint32_t      g_ecm_connected = 0;</div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keywordtype">bool</span> g_err_flag;</div><div class="line"><span class="keyword">extern</span> QueueHandle_t g_usb_read_complete_queue;</div><div class="line"><span class="keyword">extern</span> QueueHandle_t g_usb_write_complete_queue;</div><div class="line"><span class="keyword">extern</span> uint32_t      g_ecm_connected;</div><div class="line"><span class="keyword">extern</span> usb_utr_t     g_utr;</div><div class="line"></div><div class="line"><span class="comment">/***********************************************************************************************************************</span></div><div class="line"><span class="comment"> * Private global variables</span></div><div class="line"><span class="comment"> **********************************************************************************************************************/</span></div><div class="line"><span class="keyword">static</span> TaskHandle_t       xRxHanderTaskHandle = NULL;</div><div class="line"><span class="keyword">static</span> QueueHandle_t      g_usb_callback_queue;</div><div class="line"><span class="keyword">static</span> usb_event_info_t * g_p_event_info = NULL;</div><div class="line"><span class="keyword">static</span> uint8_t            g_snd_buf[CDC_READ_DATA_LEN] BSP_ALIGN_VARIABLE(4) = {VALUE_ZERO}; <span class="comment">/* Send buffer (Bulk OUT) */</span></div><div class="line"><span class="keyword">static</span> uint8_t            g_rcv_buf[CDC_READ_DATA_LEN] BSP_ALIGN_VARIABLE(4) = {VALUE_ZERO}; <span class="comment">/* Receive buffer (Bulk IN) */</span></div><div class="line"><span class="keyword">static</span> uint32_t           g_usb_max_packet_size;</div><div class="line"></div><div class="line"><span class="keyword">static</span> uint8_t g_interrupt_in_rcv_buf[64] BSP_ALIGN_VARIABLE(4) = {VALUE_ZERO};              <span class="comment">/* Receive buffer (Interrupt IN) */</span></div><div class="line"><span class="keyword">static</span> uint8_t g_usb_dummy = VALUE_ZERO;                                                     <span class="comment">/* dummy variable to send */</span></div><div class="line"><span class="keyword">static</span> uint8_t g_disc_buf[512] BSP_ALIGN_VARIABLE(4) = {VALUE_ZERO};                         <span class="comment">/* Receive buffer for GetDescriptor Request */</span></div><div class="line"><span class="keyword">static</span> uint8_t g_subclass = VALUE_ZERO;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint8_t g_notification_networkconnection_connect[8] =</div><div class="line">{</div><div class="line">    0xA1,                              <span class="comment">/* bmRequestType */</span></div><div class="line">    0x00,                              <span class="comment">/* bRequest */</span></div><div class="line">    0x01,                              <span class="comment">/* wValue (lo) */</span></div><div class="line">    0x00,                              <span class="comment">/* wValue (hi) */</span></div><div class="line">    0x01,                              <span class="comment">/* wIndex (lo) */</span></div><div class="line">    0x00,                              <span class="comment">/* wIndex (hi) */</span></div><div class="line">    0x00,                              <span class="comment">/* wLength (lo) */</span></div><div class="line">    0x00                               <span class="comment">/* wLength (hi) */</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint8_t g_notification_networkconnection_disconnect[8] =</div><div class="line">{</div><div class="line">    0xA1,                              <span class="comment">/* bmRequestType */</span></div><div class="line">    0x00,                              <span class="comment">/* bRequest */</span></div><div class="line">    0x00,                              <span class="comment">/* wValue (lo) */</span></div><div class="line">    0x00,                              <span class="comment">/* wValue (hi) */</span></div><div class="line">    0x01,                              <span class="comment">/* wIndex (lo) */</span></div><div class="line">    0x00,                              <span class="comment">/* wIndex (hi) */</span></div><div class="line">    0x00,                              <span class="comment">/* wLength (lo) */</span></div><div class="line">    0x00                               <span class="comment">/* wLength (hi) */</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">/***********************************************************************************************************************</span></div><div class="line"><span class="comment"> * Exported global function</span></div><div class="line"><span class="comment"> ***********************************************************************************************************************/</span></div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> vSpecificDeviceRegistration(<span class="keywordtype">void</span>);</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> vEventProcess(usb_event_info_t * p_event_info);</div><div class="line"></div><div class="line"><span class="comment">/***********************************************************************************************************************</span></div><div class="line"><span class="comment"> * Prototype declaration of global functions</span></div><div class="line"><span class="comment"> **********************************************************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> handle_error(<a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> err, <span class="keywordtype">char</span> * err_str);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> vSpecificDeviceRegistration(<span class="keywordtype">void</span>);</div><div class="line"><span class="keywordtype">void</span> vEventProcess(usb_event_info_t * p_event_info);</div><div class="line"></div><div class="line"><span class="comment">/***********************************************************************************************************************</span></div><div class="line"><span class="comment"> * Prototype declaration of private functions</span></div><div class="line"><span class="comment"> **********************************************************************************************************************/</span></div><div class="line"><span class="keyword">static</span> BaseType_t prvNetworkInterfaceInput(<span class="keywordtype">void</span>);</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>       prvRXHandlerTask(<span class="keywordtype">void</span> * pvParameters);</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>       prvUsbEventProcessTask(<span class="keywordtype">void</span> * pvParameters);</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> set_configuration0_for_asix_ax88179(<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl, uint8_t device_address);</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> set_configuration3_for_asix_ax88179(<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl, uint8_t device_address);</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> get_configration_descriptor_for_asix_ax88179(<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl,</div><div class="line">                                                         uint8_t               device_address,</div><div class="line">                                                         uint16_t              length);</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> set_interface_for_asix_ax88179(<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl, uint8_t device_address);</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> set_ethernet_packet_filter(<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl, uint8_t device_address);</div><div class="line"></div><div class="line"><span class="comment">/***********************************************************************************************************************</span></div><div class="line"><span class="comment"> * Interface functions</span></div><div class="line"><span class="comment"> **********************************************************************************************************************/</span></div><div class="line">BaseType_t xNetworkInterfaceInitialise (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>  err;</div><div class="line">    BaseType_t xReturn = pdFAIL;</div><div class="line"></div><div class="line">    g_utr.ip  = g_basic0_cfg.<a class="code" href="group___u_s_b___a_p_i.html#a3817be75666f59778943364cc727469c">module_number</a>;</div><div class="line">    g_utr.ipp = usb_hstd_get_usb_ip_adr((uint16_t) g_basic0_cfg.<a class="code" href="group___u_s_b___a_p_i.html#a3817be75666f59778943364cc727469c">module_number</a>);</div><div class="line"></div><div class="line"><span class="preprocessor">#if (USB_CFG_DMA == USB_CFG_ENABLE)</span></div><div class="line">    g_utr.p_transfer_rx = g_basic0_cfg.<a class="code" href="group___u_s_b___a_p_i.html#ae2cd91b73a5b0970986567b045956db6">p_transfer_rx</a>;</div><div class="line">    g_utr.p_transfer_tx = g_basic0_cfg.<a class="code" href="group___u_s_b___a_p_i.html#adaef59d2c43e7ffefa6926894c8ca7e8">p_transfer_tx</a>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___a_p_i.html#gga624cde5d2f6383faa35fd05108285a23a20bb7ec351e3d0ea8d4568e7258a8319">USB_SPEED_FS</a> == g_basic0_cfg.<a class="code" href="group___u_s_b___a_p_i.html#aa919f6650429527890059d928fc01ef5">usb_speed</a>)</div><div class="line">    {</div><div class="line">        g_usb_max_packet_size = USB_MAX_PACKET_SIZE_FS;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        g_usb_max_packet_size = USB_MAX_PACKET_SIZE_HS;</div><div class="line">    }</div><div class="line"></div><div class="line">    g_usb_callback_queue       = xQueueCreate(USB_CALLBACK_QUEUE_SIZE, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *));</div><div class="line">    g_usb_read_complete_queue  = xQueueCreate(1, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>));</div><div class="line">    g_usb_write_complete_queue = xQueueCreate(1, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>));</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ((NULL != g_usb_callback_queue) &amp;&amp;</div><div class="line">        (NULL != g_usb_read_complete_queue) &amp;&amp;</div><div class="line">        (NULL != g_usb_write_complete_queue))</div><div class="line">    {</div><div class="line">        xReturn = xTaskCreate(prvUsbEventProcessTask,</div><div class="line">                              <span class="stringliteral">&quot;UsbEventProcessTask&quot;</span>,</div><div class="line">                              configMINIMAL_STACK_SIZE,</div><div class="line">                              NULL,</div><div class="line">                              configMAX_PRIORITIES - 3,</div><div class="line">                              NULL);</div><div class="line">    }</div><div class="line"></div><div class="line">    vSpecificDeviceRegistration();</div><div class="line"></div><div class="line">    err = <a class="code" href="group___u_s_b.html#gab9810a1d8e322cb89a9a7f9ca84a368f">R_USB_Open</a>(&amp;g_basic0_ctrl, &amp;g_basic0_cfg);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (FSP_SUCCESS != err)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> pdFAIL;</div><div class="line">    }</div><div class="line"></div><div class="line">    xReturn = xTaskCreate(prvRXHandlerTask,</div><div class="line">                          <span class="stringliteral">&quot;RXHandlerTask&quot;</span>,</div><div class="line">                          configMINIMAL_STACK_SIZE,</div><div class="line">                          NULL,</div><div class="line">                          configMAX_PRIORITIES - 3,</div><div class="line">                          &amp;xRxHanderTaskHandle);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> xReturn;</div><div class="line">}</div><div class="line"></div><div class="line">BaseType_t xGetPhyLinkStatus (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    BaseType_t xReturn = pdPASS;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (1 == g_ecm_connected)</div><div class="line">    {</div><div class="line">        xReturn = pdPASS;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        xReturn = pdFAIL;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> xReturn;</div><div class="line">}</div><div class="line"></div><div class="line">BaseType_t xNetworkInterfaceOutput (NetworkBufferDescriptor_t * <span class="keyword">const</span> pxNetworkBuffer, BaseType_t xReleaseAfterSend)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>          err;</div><div class="line">    BaseType_t         xReturn = pdFAIL;</div><div class="line">    usb_event_info_t * p_event_info;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (1 == g_ecm_connected)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> ((<a class="code" href="group___u_s_b___a_p_i.html#ga45a8a1f7efbd47a66f90a0c5fa0ece0c">USB_IP1</a> == g_utr.ip) &amp;&amp; (0 != ((uint32_t) pxNetworkBuffer-&gt;pucEthernetBuffer) % <span class="keyword">sizeof</span>(uint32_t)))</div><div class="line">        {</div><div class="line">            memcpy(g_snd_buf, pxNetworkBuffer-&gt;pucEthernetBuffer, pxNetworkBuffer-&gt;xDataLength);</div><div class="line"></div><div class="line">            err = <a class="code" href="group___u_s_b.html#ga001f40866be6438435e65e78871a54d5">R_USB_Write</a>(&amp;g_basic0_ctrl, g_snd_buf, pxNetworkBuffer-&gt;xDataLength, g_p_event_info-&gt;device_address);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            err = <a class="code" href="group___u_s_b.html#ga001f40866be6438435e65e78871a54d5">R_USB_Write</a>(&amp;g_basic0_ctrl,</div><div class="line">                              pxNetworkBuffer-&gt;pucEthernetBuffer,</div><div class="line">                              pxNetworkBuffer-&gt;xDataLength,</div><div class="line">                              g_p_event_info-&gt;device_address);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (FSP_SUCCESS == err)</div><div class="line">        {</div><div class="line">            xQueueReceive(g_usb_write_complete_queue, &amp;p_event_info, (TickType_t) portMAX_DELAY);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (FSP_ERR_USB_FAILED != p_event_info-&gt;status)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (0 == pxNetworkBuffer-&gt;xDataLength % g_usb_max_packet_size)</div><div class="line">                {</div><div class="line">                    <span class="comment">/* Send 0-Length Packet */</span></div><div class="line">                    err = <a class="code" href="group___u_s_b.html#ga001f40866be6438435e65e78871a54d5">R_USB_Write</a>(&amp;g_basic0_ctrl, NULL, VALUE_ZERO, g_p_event_info-&gt;device_address);</div><div class="line"></div><div class="line">                    xQueueReceive(g_usb_write_complete_queue, &amp;p_event_info, (TickType_t) portMAX_DELAY);</div><div class="line">                }</div><div class="line"></div><div class="line">                xReturn = pdPASS;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (pdFAIL != xReturn)</div><div class="line">            {</div><div class="line">                <span class="comment">/* Call the standard trace macro to log the send event. */</span></div><div class="line">                iptraceNETWORK_INTERFACE_TRANSMIT();</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* The Ethernet buffer is therefore no longer needed, and must be freed for re-use. */</span></div><div class="line">    <span class="keywordflow">if</span> (xReleaseAfterSend == pdTRUE)</div><div class="line">    {</div><div class="line">        vReleaseNetworkBufferAndDescriptor(pxNetworkBuffer);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> xReturn;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> vNetworkInterfaceAllocateRAMToBuffers (</div><div class="line">    NetworkBufferDescriptor_t pxNetworkBuffers[ipconfigNUM_NETWORK_BUFFER_DESCRIPTORS])</div><div class="line">{</div><div class="line">    <span class="comment">/* Remove compiler warning about unused parameter. */</span></div><div class="line">    (void) pxNetworkBuffers;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/***********************************************************************************************************************</span></div><div class="line"><span class="comment"> * private functions</span></div><div class="line"><span class="comment"> **********************************************************************************************************************/</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> BaseType_t prvNetworkInterfaceInput (<span class="keywordtype">void</span>) {</div><div class="line">    BaseType_t         xResult = pdFAIL;</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>          err;</div><div class="line">    usb_event_info_t * p_event_info;</div><div class="line"></div><div class="line">    <span class="comment">/* Used to indicate that xSendEventStructToIPTask() is being called because</span></div><div class="line"><span class="comment">     * of an Ethernet receive event. */</span></div><div class="line">    IPStackEvent_t              xRxEvent;</div><div class="line">    NetworkBufferDescriptor_t * pxBufferDescriptor;</div><div class="line"></div><div class="line">    pxBufferDescriptor = pxGetNetworkBufferWithDescriptor((<span class="keywordtype">size_t</span>) MAXIMUM_ETHERNET_FRAME_SIZE, 0);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (NULL != pxBufferDescriptor)</div><div class="line">    {</div><div class="line">        err = <a class="code" href="group___u_s_b.html#ga42ad1cbad598d06023d83e8a91fd49d4">R_USB_Read</a>(&amp;g_basic0_ctrl, g_rcv_buf, CDC_READ_DATA_LEN, g_p_event_info-&gt;device_address);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (err != FSP_SUCCESS)</div><div class="line">        {</div><div class="line">            vReleaseNetworkBufferAndDescriptor(pxBufferDescriptor);</div><div class="line"></div><div class="line">            <span class="keywordflow">return</span> xResult;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* Wait for read complete */</span></div><div class="line">        xQueueReceive(g_usb_read_complete_queue, &amp;p_event_info, (TickType_t) portMAX_DELAY);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (FSP_ERR_USB_FAILED != p_event_info-&gt;status)</div><div class="line">        {</div><div class="line">            <span class="comment">/* Setting of Recieved data and data length */</span></div><div class="line">            memcpy(pxBufferDescriptor-&gt;pucEthernetBuffer, g_rcv_buf, p_event_info-&gt;data_size);</div><div class="line">            pxBufferDescriptor-&gt;xDataLength = (size_t) p_event_info-&gt;data_size;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            err = <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#ggadfb1288da0fcc7ae1dc88c58601374f8af39326ab50613d8779ebc84e5da8ffbc">FSP_ERR_INVALID_STATE</a>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* When driver received any data. */</span></div><div class="line">        <span class="keywordflow">if</span> (FSP_SUCCESS == err)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (eConsiderFrameForProcessing(pxBufferDescriptor-&gt;pucEthernetBuffer) == eProcessBuffer)</div><div class="line">            {</div><div class="line">                <span class="comment">/* The event about to be sent to the TCP/IP is an Rx event. */</span></div><div class="line">                xRxEvent.eEventType = eNetworkRxEvent;</div><div class="line"></div><div class="line">                <span class="comment">/* pvData is used to point to the network buffer descriptor that</span></div><div class="line"><span class="comment">                 * now references the received data. */</span></div><div class="line">                xRxEvent.pvData = (<span class="keywordtype">void</span> *) pxBufferDescriptor;</div><div class="line"></div><div class="line">                <span class="comment">/* Send the data to the TCP/IP stack. */</span></div><div class="line">                <span class="keywordflow">if</span> (pdPASS == xSendEventStructToIPTask(&amp;xRxEvent, 0))</div><div class="line">                {</div><div class="line">                    <span class="comment">/* The message was successfully sent to the TCP/IP stack.</span></div><div class="line"><span class="comment">                     * Call the standard trace macro to log the occurrence. */</span></div><div class="line">                    iptraceNETWORK_INTERFACE_RECEIVE();</div><div class="line">                    xResult = pdPASS;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (pdPASS != xResult)</div><div class="line">        {</div><div class="line">            <span class="comment">/* The buffer could not be sent to the IP task so the buffer must be released. */</span></div><div class="line">            vReleaseNetworkBufferAndDescriptor(pxBufferDescriptor);</div><div class="line">            iptraceETHERNET_RX_EVENT_LOST();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> xResult;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> prvRXHandlerTask (<span class="keywordtype">void</span> * pvParameters) {</div><div class="line">    BaseType_t xResult = pdFALSE;</div><div class="line"></div><div class="line">    <span class="comment">/* Avoid compiler warning about unreferenced parameter. */</span></div><div class="line">    (void) pvParameters;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> ( ; ; )</div><div class="line">    {</div><div class="line">        vTaskDelay(ETHER_LINK_STATUS_CHECK_INTERVAL);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (1 == g_ecm_connected)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">while</span> (1)</div><div class="line">            {</div><div class="line">                xResult = prvNetworkInterfaceInput();</div><div class="line">                <span class="keywordflow">if</span> (pdFAIL == xResult)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (1 != g_ecm_connected)</div><div class="line">                    {</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> prvUsbEventProcessTask (<span class="keywordtype">void</span> * pvParameters) {</div><div class="line">    BaseType_t xResult = pdFALSE;</div><div class="line"></div><div class="line">    <span class="comment">/* Avoid compiler warning about unreferenced parameter. */</span></div><div class="line">    (void) pvParameters;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> ( ; ; )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Handle error if queue send fails*/</span></div><div class="line">        <span class="keywordflow">if</span> (<span class="keyword">true</span> == g_err_flag)</div><div class="line">        {</div><div class="line">            handle_error(g_err_flag, <span class="stringliteral">&quot;Error in sending usb event through queue&quot;</span>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* Receive message from queue and analyzing the received message*/</span></div><div class="line">        xResult = xQueueReceive(g_usb_callback_queue, &amp;g_p_event_info, (portMAX_DELAY));</div><div class="line"></div><div class="line">        <span class="comment">/* Handle error */</span></div><div class="line">        <span class="keywordflow">if</span> (pdTRUE != xResult)</div><div class="line">        {</div><div class="line">            handle_error(g_err_flag, <span class="stringliteral">&quot;Error in receiving USB event message through queue&quot;</span>);</div><div class="line">        }</div><div class="line"></div><div class="line">        vEventProcess(g_p_event_info);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">__attribute__((weak)) BaseType_t xApplicationGetRandomNumber (uint32_t * pulNumber)</div><div class="line">{</div><div class="line">    <span class="comment">/* example of a 32-bit random number generator.</span></div><div class="line"><span class="comment">     * rand() in returns a 16-bit number. so create 32 bit Random number using 16 bit rand().</span></div><div class="line"><span class="comment">     * In this case just a psuedo random number is used so THIS IS NOT RECOMMENDED FOR PRODUCTION SYSTEMS.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    uint32_t ulRandomValue = 0;</div><div class="line"></div><div class="line">    ulRandomValue = ((((uint32_t) rand()) &amp; UNSIGNED_SHORT_RANDOM_NUMBER_MASK)) |      <span class="comment">// NOLINT (rand() has limited randomness. But c99 does not support random)</span></div><div class="line">                    ((((uint32_t) rand()) &amp; UNSIGNED_SHORT_RANDOM_NUMBER_MASK) &lt;&lt; 16); <span class="comment">// NOLINT (rand() has limited randomness. But c99 does not support random)</span></div><div class="line"></div><div class="line">    *(pulNumber) = ulRandomValue;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> pdTRUE;</div><div class="line">}</div><div class="line"></div><div class="line">BSP_WEAK_REFERENCE uint32_t ulApplicationGetNextSequenceNumber (uint32_t ulSourceAddress,</div><div class="line">                                                                uint16_t usSourcePort,</div><div class="line">                                                                uint32_t ulDestinationAddress,</div><div class="line">                                                                uint16_t usDestinationPort)</div><div class="line">{</div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * Callback that provides the inputs necessary to generate a randomized TCP</span></div><div class="line"><span class="comment">     * Initial Sequence Number per RFC 6528.  In this case just a psuedo random</span></div><div class="line"><span class="comment">     * number is used so THIS IS NOT RECOMMENDED FOR PRODUCTION SYSTEMS.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(ulSourceAddress);</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(ulDestinationAddress);</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(usSourcePort);</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(usDestinationPort);</div><div class="line"></div><div class="line">    uint32_t ulResult = 0;</div><div class="line">    <span class="keywordflow">while</span> (0 == ulResult)</div><div class="line">    {</div><div class="line">        xApplicationGetRandomNumber(&amp;ulResult);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> ulResult;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> handle_error (<a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> err, <span class="keywordtype">char</span> * err_str)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(err);</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(err_str);</div><div class="line"></div><div class="line">    <span class="comment">/* close opened USB module */</span></div><div class="line">    <a class="code" href="group___u_s_b.html#ga42c6c75ae96e3860b726d1b0dcbf110d">R_USB_Close</a>(&amp;g_basic0_ctrl);</div><div class="line">}                                      <span class="comment">/* End of function handle_error() */</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> usb_rtos_callback (usb_event_info_t * p_event_info, usb_hdl_t cur_task, <a class="code" href="group___u_s_b___a_p_i.html#ga647c9ea8cc8c82a26dcec32f7749c73d">usb_onoff_t</a> usb_state)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(cur_task);</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(usb_state);</div><div class="line"></div><div class="line">    <span class="comment">/* Send event received to queue */</span></div><div class="line">    <span class="keywordflow">if</span> (pdTRUE != (xQueueSend(g_usb_callback_queue, (<span class="keyword">const</span> <span class="keywordtype">void</span> *) &amp;p_event_info, (TickType_t) (NO_WAIT_TIME))))</div><div class="line">    {</div><div class="line">        g_err_flag = <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">}                                      <span class="comment">/* End of function usb_rtos_callback */</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> vSpecificDeviceRegistration (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> err;</div><div class="line"></div><div class="line">    err = <a class="code" href="group___u_s_b___h_c_d_c.html#ga111d39b0fc53e4eb07f894ca7a0cd505">R_USB_HCDC_SpecificDeviceRegister</a>(&amp;g_basic0_ctrl, USB_ECM_TEST_DEVICE_VID, USB_ECM_TEST_DEVICE_PID);</div><div class="line">    <span class="keywordflow">if</span> (FSP_SUCCESS != err)</div><div class="line">    {</div><div class="line">        handle_error(g_err_flag, <span class="stringliteral">&quot;R_USB_HCDC_SpecificDeviceRegister API FAILED&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> vEventProcess (usb_event_info_t * p_event_info)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>              err;</div><div class="line">    <a class="code" href="group___u_s_b___h_c_d_c___a_p_i.html#structusb__hcdc__device__info__t">usb_hcdc_device_info_t</a> device_info;</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (p_event_info-&gt;event)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ab5c3bd23fe62533150eef3a4e8c8d13c">USB_STATUS_CONFIGURED</a>:</div><div class="line">        {</div><div class="line">            err = <a class="code" href="group___u_s_b___h_c_d_c.html#ga6b2015ee504e6091a3e380b57e246581">R_USB_HCDC_DeviceInfoGet</a>(&amp;g_basic0_ctrl, &amp;device_info, p_event_info-&gt;device_address);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (FSP_SUCCESS == err)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (CDC_SUB_CLASS_ECM == device_info.<a class="code" href="group___u_s_b___h_c_d_c___a_p_i.html#af3850f3c943ab11958d77f6843ca3270">subclass</a>)</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___u_s_b___h_c_d_c.html#ga8088d3a63f032a4fdaddec7f81f5da60">R_USB_HCDC_ControlDataRead</a>(&amp;g_basic0_ctrl,</div><div class="line">                                               &amp;g_interrupt_in_rcv_buf[VALUE_ZERO],</div><div class="line">                                               CDC_INTERRUPT_READ_DATA_LEN,</div><div class="line">                                               p_event_info-&gt;device_address);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CDC_SUB_CLASS_ACM == g_subclass)</div><div class="line">                {</div><div class="line">                    <span class="comment">/* none */</span></div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> ((USB_ECM_TEST_DEVICE_VID == device_info.<a class="code" href="group___u_s_b___h_c_d_c___a_p_i.html#a7c5fcd352bdf555d157746a35b8a88f2">vendor_id</a>) &amp;&amp;</div><div class="line">                        (USB_ECM_TEST_DEVICE_PID == device_info.<a class="code" href="group___u_s_b___h_c_d_c___a_p_i.html#a014f55646ca6be6b9a75cf2975fd314e">product_id</a>))</div><div class="line">                    {</div><div class="line">                        set_configuration0_for_asix_ax88179(&amp;g_basic0_ctrl, p_event_info-&gt;device_address);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a63dd4552584256ef9d1a0d5da2159e9c">USB_STATUS_READ_COMPLETE</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2aa31d93178a24f042fb19db6da3b5a2d8">USB_CLASS_HCDC</a> == p_event_info-&gt;type)</div><div class="line">            {</div><div class="line">                xQueueSend(g_usb_read_complete_queue, &amp;p_event_info, (TickType_t) portMAX_DELAY);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (0 ==</div><div class="line">                    memcmp((<span class="keywordtype">void</span> *) g_notification_networkconnection_connect, g_interrupt_in_rcv_buf,</div><div class="line">                           <span class="keyword">sizeof</span>(g_notification_networkconnection_connect)))</div><div class="line">                {</div><div class="line">                    <span class="comment">/* Received NETWORKCONNECTION &quot;Connected&quot;. */</span></div><div class="line">                    g_ecm_connected = 1; <span class="comment">/* link up */</span></div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 ==</div><div class="line">                         memcmp((<span class="keywordtype">void</span> *) g_notification_networkconnection_disconnect, g_interrupt_in_rcv_buf,</div><div class="line">                                <span class="keyword">sizeof</span>(g_notification_networkconnection_disconnect)))</div><div class="line">                {</div><div class="line">                    <span class="comment">/* Received NETWORKCONNECTION &quot;Disconnect&quot;. */</span></div><div class="line">                    g_ecm_connected = 0; <span class="comment">/* link down */</span></div><div class="line">                }</div><div class="line"></div><div class="line">                <a class="code" href="group___u_s_b___h_c_d_c.html#ga8088d3a63f032a4fdaddec7f81f5da60">R_USB_HCDC_ControlDataRead</a>(&amp;g_basic0_ctrl,</div><div class="line">                                           &amp;g_interrupt_in_rcv_buf[VALUE_ZERO],</div><div class="line">                                           CDC_INTERRUPT_READ_DATA_LEN,</div><div class="line">                                           p_event_info-&gt;device_address);</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ad44448290b4f36868a09b48e4588b29d">USB_STATUS_WRITE_COMPLETE</a>:</div><div class="line">        {</div><div class="line">            xQueueSend(g_usb_write_complete_queue, &amp;p_event_info, (TickType_t) portMAX_DELAY);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a24e9ad4653245663e5e89bda173141fd">USB_STATUS_REQUEST_COMPLETE</a>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> ((<a class="code" href="group___u_s_b___a_p_i.html#gad22d7586d7c748cf53830e2b610a2ac7">USB_SET_CONFIGURATION</a> == (p_event_info-&gt;setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>)) &amp;&amp;</div><div class="line">                (VALUE_ZERO == p_event_info-&gt;setup.request_value))</div><div class="line">            {</div><div class="line">                <span class="comment">/* Set Configuration (3) */</span></div><div class="line">                set_configuration3_for_asix_ax88179(&amp;g_basic0_ctrl, p_event_info-&gt;device_address);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="group___u_s_b___a_p_i.html#gad22d7586d7c748cf53830e2b610a2ac7">USB_SET_CONFIGURATION</a> == (p_event_info-&gt;setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>)) &amp;&amp;</div><div class="line">                     (VALUE_0003H == p_event_info-&gt;setup.request_value))</div><div class="line">            {</div><div class="line">                <span class="comment">/* Get Configuration Descrptor (9 byte) */</span></div><div class="line">                get_configration_descriptor_for_asix_ax88179(&amp;g_basic0_ctrl,</div><div class="line">                                                             p_event_info-&gt;device_address,</div><div class="line">                                                             (uint16_t) VALUE_9);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="group___u_s_b___a_p_i.html#gab643fa62dbe13073d08006c516b87f9a">USB_GET_DESCRIPTOR</a> == (p_event_info-&gt;setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>)) &amp;&amp;</div><div class="line">                     (p_event_info-&gt;data_size == VALUE_9))</div><div class="line">            {</div><div class="line">                <span class="comment">/* Get Configuration Descrptor (all byte) */</span></div><div class="line">                get_configration_descriptor_for_asix_ax88179(&amp;g_basic0_ctrl,</div><div class="line">                                                             p_event_info-&gt;device_address,</div><div class="line">                                                             (uint16_t) (((uint16_t) g_disc_buf[3] &lt;&lt; 8) +</div><div class="line">                                                                         (uint16_t) g_disc_buf[2]));</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="group___u_s_b___a_p_i.html#gab643fa62dbe13073d08006c516b87f9a">USB_GET_DESCRIPTOR</a> == (p_event_info-&gt;setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>)) &amp;&amp;</div><div class="line">                     (p_event_info-&gt;data_size &gt; VALUE_9))</div><div class="line">            {</div><div class="line">                set_ethernet_packet_filter(&amp;g_basic0_ctrl, p_event_info-&gt;device_address);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SET_ETHERNET_PACKET_FILTER == (p_event_info-&gt;setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">            {</div><div class="line">                set_interface_for_asix_ax88179(&amp;g_basic0_ctrl, p_event_info-&gt;device_address);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___a_p_i.html#gac5d915bfafdf40cea7141efde1ed1c24">USB_SET_INTERFACE</a> == (p_event_info-&gt;setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">            {</div><div class="line">                <span class="comment">/* Pipe setting  */</span></div><div class="line">                memcpy(g_usb_hstd_config_descriptor[g_utr.ip], g_disc_buf,</div><div class="line">                       (uint16_t) (((uint16_t) g_disc_buf[3] &lt;&lt; 8) + (uint16_t) g_disc_buf[2]));</div><div class="line">                usb_hcdc_pipe_info(&amp;g_utr,</div><div class="line">                                   (uint8_t *) g_usb_hstd_config_descriptor[g_utr.ip],</div><div class="line">                                   g_usb_hcdc_speed[g_utr.ip],</div><div class="line">                                   (uint16_t) (((uint16_t) g_disc_buf[3] &lt;&lt; 8) + (uint16_t) g_disc_buf[2]));</div><div class="line">                usb_hcdc_set_pipe_registration(&amp;g_utr, p_event_info-&gt;device_address);</div><div class="line"></div><div class="line">                <a class="code" href="group___u_s_b___h_c_d_c.html#ga8088d3a63f032a4fdaddec7f81f5da60">R_USB_HCDC_ControlDataRead</a>(&amp;g_basic0_ctrl,</div><div class="line">                                           &amp;g_interrupt_in_rcv_buf[VALUE_ZERO],</div><div class="line">                                           CDC_INTERRUPT_READ_DATA_LEN,</div><div class="line">                                           p_event_info-&gt;device_address);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                <span class="comment">/* Not support request */</span></div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ae9bcf94bdb90960ca692b1dfecb98e78">USB_STATUS_DETACH</a>:</div><div class="line">        {</div><div class="line">            g_ecm_connected = 0;       <span class="comment">/* link down */</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">        {</div><div class="line">            <span class="comment">/* No operation to do*/</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> set_configuration0_for_asix_ax88179 (<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl, uint8_t device_address)</div><div class="line">{</div><div class="line">    usb_setup_t setup;</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>   err = FSP_SUCCESS;</div><div class="line">    setup.request_type   = <a class="code" href="group___u_s_b___a_p_i.html#gad22d7586d7c748cf53830e2b610a2ac7">USB_SET_CONFIGURATION</a> | <a class="code" href="group___u_s_b___a_p_i.html#ga7cc218af84ae5dd13fea098aab58fa60">USB_HOST_TO_DEV</a> | <a class="code" href="group___u_s_b___a_p_i.html#ga6acc7b02a7ebefeab5804d1621062ab5">USB_STANDARD</a> | <a class="code" href="group___u_s_b___a_p_i.html#gab7858cae755a8a410d6495765def4daa">USB_DEVICE</a>;</div><div class="line">    setup.request_value  = VALUE_ZERO;</div><div class="line">    setup.request_index  = VALUE_ZERO;</div><div class="line">    setup.request_length = VALUE_ZERO;</div><div class="line"></div><div class="line">    <span class="comment">/* Request Control transfer */</span></div><div class="line">    err = <a class="code" href="group___u_s_b.html#gaecba62e40820ec837fa0b285140ed13b">R_USB_HostControlTransfer</a>(p_ctrl, &amp;setup, (uint8_t *) &amp;g_usb_dummy, device_address);</div><div class="line">    <span class="keywordflow">if</span> (FSP_SUCCESS != err)</div><div class="line">    {</div><div class="line">        handle_error(g_err_flag, <span class="stringliteral">&quot;R_USB_HostControlTransfer API FAILED&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> set_configuration3_for_asix_ax88179 (<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl, uint8_t device_address)</div><div class="line">{</div><div class="line">    usb_setup_t setup;</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>   err = FSP_SUCCESS;</div><div class="line">    setup.request_type   = <a class="code" href="group___u_s_b___a_p_i.html#gad22d7586d7c748cf53830e2b610a2ac7">USB_SET_CONFIGURATION</a> | <a class="code" href="group___u_s_b___a_p_i.html#ga7cc218af84ae5dd13fea098aab58fa60">USB_HOST_TO_DEV</a> | <a class="code" href="group___u_s_b___a_p_i.html#ga6acc7b02a7ebefeab5804d1621062ab5">USB_STANDARD</a> | <a class="code" href="group___u_s_b___a_p_i.html#gab7858cae755a8a410d6495765def4daa">USB_DEVICE</a>;</div><div class="line">    setup.request_value  = VALUE_0003H;</div><div class="line">    setup.request_index  = VALUE_ZERO;</div><div class="line">    setup.request_length = VALUE_ZERO;</div><div class="line"></div><div class="line">    <span class="comment">/* Request Control transfer */</span></div><div class="line">    err = <a class="code" href="group___u_s_b.html#gaecba62e40820ec837fa0b285140ed13b">R_USB_HostControlTransfer</a>(p_ctrl, &amp;setup, (uint8_t *) &amp;g_usb_dummy, device_address);</div><div class="line">    <span class="keywordflow">if</span> (FSP_SUCCESS != err)</div><div class="line">    {</div><div class="line">        handle_error(g_err_flag, <span class="stringliteral">&quot;R_USB_HostControlTransfer API FAILED&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> get_configration_descriptor_for_asix_ax88179 (<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl,</div><div class="line">                                                          uint8_t               device_address,</div><div class="line">                                                          uint16_t              length)</div><div class="line">{</div><div class="line">    usb_setup_t setup;</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>   err = FSP_SUCCESS;</div><div class="line">    setup.request_type   = <a class="code" href="group___u_s_b___a_p_i.html#gab643fa62dbe13073d08006c516b87f9a">USB_GET_DESCRIPTOR</a> | <a class="code" href="group___u_s_b___a_p_i.html#ga54a99a2c162e1f69a99198e2051e0f86">USB_DEV_TO_HOST</a> | <a class="code" href="group___u_s_b___a_p_i.html#ga6acc7b02a7ebefeab5804d1621062ab5">USB_STANDARD</a> | <a class="code" href="group___u_s_b___a_p_i.html#gab7858cae755a8a410d6495765def4daa">USB_DEVICE</a>;</div><div class="line">    setup.request_value  = (uint16_t) USB_CONF_DESCRIPTOR | VALUE_0002H; <span class="comment">/* 0x0002 : index of config disc */</span></div><div class="line">    setup.request_index  = VALUE_ZERO;</div><div class="line">    setup.request_length = length;</div><div class="line"></div><div class="line">    <span class="comment">/* Request Control transfer */</span></div><div class="line">    err = <a class="code" href="group___u_s_b.html#gaecba62e40820ec837fa0b285140ed13b">R_USB_HostControlTransfer</a>(p_ctrl, &amp;setup, (uint8_t *) &amp;g_disc_buf, device_address);</div><div class="line">    <span class="keywordflow">if</span> (FSP_SUCCESS != err)</div><div class="line">    {</div><div class="line">        handle_error(g_err_flag, <span class="stringliteral">&quot;R_USB_HostControlTransfer API FAILED&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> set_interface_for_asix_ax88179 (<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl, uint8_t device_address)</div><div class="line">{</div><div class="line">    usb_setup_t setup;</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>   err = FSP_SUCCESS;</div><div class="line">    setup.request_type   = <a class="code" href="group___u_s_b___a_p_i.html#gac5d915bfafdf40cea7141efde1ed1c24">USB_SET_INTERFACE</a> | <a class="code" href="group___u_s_b___a_p_i.html#ga7cc218af84ae5dd13fea098aab58fa60">USB_HOST_TO_DEV</a> | <a class="code" href="group___u_s_b___a_p_i.html#ga6acc7b02a7ebefeab5804d1621062ab5">USB_STANDARD</a> | <a class="code" href="group___u_s_b___a_p_i.html#ga869bb2519c44f3825465da02616782c3">USB_INTERFACE</a>;</div><div class="line">    setup.request_value  = VALUE_0001H;</div><div class="line">    setup.request_index  = VALUE_0001H;</div><div class="line">    setup.request_length = VALUE_ZERO;</div><div class="line"></div><div class="line">    <span class="comment">/* Request Control transfer */</span></div><div class="line">    err = <a class="code" href="group___u_s_b.html#gaecba62e40820ec837fa0b285140ed13b">R_USB_HostControlTransfer</a>(p_ctrl, &amp;setup, (uint8_t *) &amp;g_usb_dummy, device_address);</div><div class="line">    <span class="keywordflow">if</span> (FSP_SUCCESS != err)</div><div class="line">    {</div><div class="line">        handle_error(g_err_flag, <span class="stringliteral">&quot;R_USB_HostControlTransfer API FAILED&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> set_ethernet_packet_filter (<a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a> * p_ctrl, uint8_t device_address)</div><div class="line">{</div><div class="line">    usb_setup_t setup;</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>   err = FSP_SUCCESS;</div><div class="line">    setup.request_type   = (SET_ETHERNET_PACKET_FILTER | <a class="code" href="group___u_s_b___a_p_i.html#ga7cc218af84ae5dd13fea098aab58fa60">USB_HOST_TO_DEV</a> | <a class="code" href="group___u_s_b___a_p_i.html#ga1e0073f633fa828440e2f3c576cfbc62">USB_CLASS</a> | <a class="code" href="group___u_s_b___a_p_i.html#ga869bb2519c44f3825465da02616782c3">USB_INTERFACE</a>);</div><div class="line">    setup.request_value  = VALUE_001FH; <span class="comment">/* No packet filter */</span></div><div class="line">    setup.request_index  = VALUE_0001H; <span class="comment">/* wIndex:Interface */</span></div><div class="line">    setup.request_length = VALUE_ZERO;  <span class="comment">/* wLength:Zero */</span></div><div class="line"></div><div class="line">    err = <a class="code" href="group___u_s_b.html#gaecba62e40820ec837fa0b285140ed13b">R_USB_HostControlTransfer</a>(p_ctrl, &amp;setup, &amp;g_usb_dummy, device_address);</div><div class="line">    <span class="keywordflow">if</span> (FSP_SUCCESS != err)</div><div class="line">    {</div><div class="line">        handle_error(g_err_flag, <span class="stringliteral">&quot;R_USB_HostControlTransfer API FAILED&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div></div><!-- fragment --><h2 class="groupheader">Function Documentation</h2>
<a id="ga8088d3a63f032a4fdaddec7f81f5da60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8088d3a63f032a4fdaddec7f81f5da60">&#9670;&nbsp;</a></span>R_USB_HCDC_ControlDataRead()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> R_USB_HCDC_ControlDataRead </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group___u_s_b___a_p_i.html#ga00a5a797b57dec247564f11056ac7230">usb_ctrl_t</a> *const&#160;</td>
          <td class="paramname"><em>p_api_ctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>p_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>device_address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read Control Data.(CDC Interrupt IN data) </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">FSP_SUCCESS</td><td>Successfully completed (Data read request completed). </td></tr>
    <tr><td class="paramname">FSP_ERR_USB_FAILED</td><td>The function could not be completed successfully. </td></tr>
    <tr><td class="paramname">FSP_ERR_USB_BUSY</td><td>Data receive request already in process for USB device with same device address. </td></tr>
    <tr><td class="paramname">FSP_ERR_ASSERTION</td><td>Parameter is NULL error. </td></tr>
    <tr><td class="paramname">FSP_ERR_USB_PARAMETER</td><td>Parameter error. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>1. Do not call this API in the following function. </dd>
<dd>
(1). Interrupt function. </dd>
<dd>
(2). Callback function ( for RTOS ). </dd></dl>

</div>
</div>
<a id="ga111d39b0fc53e4eb07f894ca7a0cd505"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga111d39b0fc53e4eb07f894ca7a0cd505">&#9670;&nbsp;</a></span>R_USB_HCDC_SpecificDeviceRegister()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> R_USB_HCDC_SpecificDeviceRegister </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group___u_s_b___a_p_i.html#ga00a5a797b57dec247564f11056ac7230">usb_ctrl_t</a> *const&#160;</td>
          <td class="paramname"><em>p_api_ctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>vendor_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>product_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register the specified vendor class device in the device table. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">FSP_SUCCESS</td><td>Successfully completed. </td></tr>
    <tr><td class="paramname">FSP_ERR_USB_FAILED</td><td>The function could not be completed successfully. </td></tr>
    <tr><td class="paramname">FSP_ERR_ASSERTION</td><td>Parameter Null pointer error. </td></tr>
    <tr><td class="paramname">FSP_ERR_USB_PARAMETER</td><td>Parameter error. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>(1). Interrupt function. </dd>
<dd>
(2). Callback function ( for RTOS ). </dd></dl>

</div>
</div>
<a id="ga6b2015ee504e6091a3e380b57e246581"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6b2015ee504e6091a3e380b57e246581">&#9670;&nbsp;</a></span>R_USB_HCDC_DeviceInfoGet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> R_USB_HCDC_DeviceInfoGet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group___u_s_b___a_p_i.html#ga00a5a797b57dec247564f11056ac7230">usb_ctrl_t</a> *const&#160;</td>
          <td class="paramname"><em>p_api_ctrl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___u_s_b___h_c_d_c___a_p_i.html#structusb__hcdc__device__info__t">usb_hcdc_device_info_t</a> *&#160;</td>
          <td class="paramname"><em>p_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>device_address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the VID, PID and subclass code of the connected device. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">FSP_SUCCESS</td><td>Successfully completed. </td></tr>
    <tr><td class="paramname">FSP_ERR_USB_FAILED</td><td>The function could not be completed successfully. </td></tr>
    <tr><td class="paramname">FSP_ERR_ASSERTION</td><td>Parameter Null pointer error. </td></tr>
    <tr><td class="paramname">FSP_ERR_USB_PARAMETER</td><td>Parameter error. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>(1). Interrupt function. </dd>
<dd>
(2). Callback function ( for RTOS ). </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
        <li class="footer">FSP Release v5.1.0 User's Manual Copyright  (2023) Renesas Electronics Corporation. All Rights Reserved.</li>
  </ul>
</div>
</body>
</html>
