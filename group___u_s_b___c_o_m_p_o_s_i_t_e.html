<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>RA Flexible Software Package Documentation: USB Composite (r_usb_composite)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <script type="text/javascript" src="search/lunr.js"></script>
    <link href="search/lunrsearch.css" rel="stylesheet" type="text/css">
    <script src="search/lunr_index.js"></script>
    <script src="search/lunrclient.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="fsp_customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
    $(document).ready(function() {
        $("tr.tree_lvl_1").nextUntil("tr.tree_lvl_1,tr.tree_none").hide();
		$("tr.tree_lvl_1").data("expanded","0");
		$("tr.tree_lvl_2").data("expanded","0");
		$("tr.tree_lvl_3").data("expanded","0");
		$("tr.tree_lvl_4").data("expanded","0");
		$("tr.tree_lvl_5").data("expanded","0");
        $("tr.tree_lvl_1").click(function() {
		    var lvl_1_is_open = $(this).data("expanded");
		    if (lvl_1_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2, tr.tree_lvl_1_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2,tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2,tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_2").click(function() {
		    var lvl_2_is_open = $(this).data("expanded");
		    if (lvl_2_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3, tr.tree_lvl_2_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
				$(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_3").click(function() {
		    var lvl_3_is_open = $(this).data("expanded");
		    if (lvl_3_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_3_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_4").click(function() {
		    var lvl_4_is_open = $(this).data("expanded");
		    if (lvl_4_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5, tr.tree_lvl_4_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_5").click(function() {
		    var lvl_5_is_open = $(this).data("expanded");
		    if (lvl_5_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_5,tr.tree_lvl_4,tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_5,tr.tree_lvl_4_item,tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
     });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_scaled.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">RA Flexible Software Package Documentation
   &#160;<span id="projectnumber">Release v6.2.0</span>
   </div>
  </td>
   <td>        <br /><div id="MSearchBox" class="MSearchBoxInactive">

    <form id="lunrSearchForm" name="lunrSearchForm">
      <span class="left" >
          <img id="MSearchSelect" src="search/mag_sel.png"
               alt=""/>
         <input class="search-input" id="MSearchField" name="q" placeholder="Search" type="text">
      </span>
      <span class="right">
          &nbsp;
      </span>
        <!--<input type="submit" value="Search">-->
    </form>
</div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___u_s_b___c_o_m_p_o_s_i_t_e.html','');});
</script>

<script src="search/mark.min.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    var options = {         // allows highlighting across element boundaries.
      "acrossElements": true
    };
    var bodyText = $("div.contents").text(); // try contents instead of body.
    // If using body: Problem may be that text inside <script> tags is included in .text() - but not in cheerio?
    // If using div.contents - works
    var fullURL = $(location).attr('href');
    var splitURL = fullURL.split("?");  // Get param string: content after "?" in URL
    if (splitURL.length > 1) {          // If any content after "?"
      var paramStr = splitURL[1];
      var params = paramStr.split("&"); // Split params on "&"
      for (i = 0; i < params.length; i++) {
        var paramPair = params[i].split("=");
        if (paramPair[0] == "pos") {     // If any param starts "pos", get the content after "="
          posStr = paramPair[1];
          var splitPos = posStr.split(",");
          var termArray = [];
        // termArray will have the search terms
            for (i=0; i < splitPos.length; i += 2) {
            start = splitPos[i];
            len = splitPos[i+1]; // Needs error detection! Vulnerable if non-even # of pos entries
            term = bodyText.substr(start,len);
            if (termArray.includes(term) == false) {     // List all unique terms
                termArray.push(bodyText.substr(start,len));
            }
          }
    //      console.log(termArray);
          var context = document.querySelector("div.contents");
          var instance = new Mark(context);
          for(i=0;i<termArray.length; i+=1) {
            instance.mark(termArray[i],options);  // Use Mark.js to mark all terms in termArray
            }
          var firstMark = document.querySelector("mark");
          firstMark.scrollIntoView(true);
          //      console.log($("mark").first().text()); // Trying to scroll to first Mark element.
        }
            }
    }
  });
</script>

<link href="fsp_customdoxygen.css" rel="stylesheet" type="text/css" />

<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


<!-- Lunr search results -->
<div id="lunrResultBox" style="
        position: fixed;
        border: 1px solid black;
        background-color: WhiteSmoke;
        padding: 10px;
        width: 500px;
        height: 500px;
        top: 30;
        right: 0;
        overflow: auto;
        display: none">
    <button onclick="closeLunrResults()" style="float: right;">X</button>
    <div class="resultCount" id="resultCount"></div>
    <div id="searchResults"></div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">USB Composite (r_usb_composite)<div class="ingroups"><a class="el" href="group___r_e_n_e_s_a_s___m_o_d_u_l_e_s.html">Modules</a> &raquo; <a class="el" href="group___r_e_n_e_s_a_s___c_o_n_n_e_c_t_i_v_i_t_y___m_o_d_u_l_e_s.html">Connectivity</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p><a class="anchor" id="functionss"></a></p><h2 class="groupheader">Functions</h2>
<p>Refer to <a class="el" href="group___u_s_b.html">USB (r_usb_basic)</a> for the common API (r_usb_basic) to be called from the application.</p>
<h1><a class="anchor" id="r-usb_compoiste-overview"></a>
Overview</h1>
<p>USB composite device works as a USB Peripheral by combining two peripheral device classes and r_usb_basic module. <br />
This USB driver supports the following composite devices:</p><ol type="1">
<li>PCDC + PMSC</li>
<li>PCDC + PHID</li>
<li>PHID + PMSC</li>
<li>PCDC + PCDC</li>
<li>PHID + PHID</li>
<li>PCDC + PVND</li>
</ol>
<h1><a class="anchor" id="r-usb_composite-configuration"></a>
How to Configuration</h1>
<p>The following shows FSP configuration procedure for USB composite device.</p>
<ul>
<li>Select [New Stack]-&gt;[USB]-&gt;[USB Composite]</li>
</ul>
<div class="image">
<img src="r_usb_composite1.png" alt="r_usb_composite1.png"/>
<div class="caption">
Select USB Composite</div></div>
<ul>
<li>The following is displayed when selecting [USB Composite].</li>
</ul>
<div class="image">
<img src="r_usb_composite2.png" alt="r_usb_composite2.png"/>
<div class="caption">
USB Composite Stack</div></div>
<ul>
<li>Select the supported 2 device classes as follows.</li>
</ul>
<div class="image">
<img src="r_usb_composite3.png" alt="r_usb_composite3.png"/>
<div class="caption">
Select Device Classes</div></div>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>Be sure to select "USB PCDC driver on r_usb_pcdc" and "USB PCDC 2channel driver on r_usb_pcdc" when configurating for "PCDC + PCDC".</li>
<li>Be sure to select "USB PHID driver on r_usb_phid" and "USB PHID 2channel driver on r_usb_phid" when configurating for "PHID + PHID".</li>
</ol>
</dd></dl>
<p><br />
</p><ul>
<li>Select the supported 2 device classes as follows. The following is displayed when selecting 2 device classes.</li>
</ul>
<div class="image">
<img src="r_usb_composite4.png" alt="r_usb_composite4.png"/>
<div class="caption">
Delete USB Basic Instance</div></div>
 <dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>Delete the "g_basic1" instance manually since this instance is not used in composite device. (Refer to the blue frame in the above figure.)</li>
<li>The error is output when selecting the following device classes.<ol type="a">
<li>PMSC + PMSC</li>
</ol>
</li>
</ol>
</dd></dl>
<div class="image">
<img src="r_usb_composite5.png" alt="r_usb_composite5.png"/>
<div class="caption">
Device Class Selection Error</div></div>
<h2><a class="anchor" id="r-usb_composite-limitations"></a>
Limitations</h2>
<ul>
<li>The following composite device is not suppored when using RA2A1(MCU).<ul>
<li>PMSC + PCDC</li>
<li>PCDC + PCDC</li>
</ul>
</li>
<li><p class="startli">If you use PMSC, make sure to use usb_basic module with PMSC.</p>
<p class="startli">There is a risk that the information on the PMSC storage media cannot be registered normally in the "USB Callback Context".</p>
</li>
</ul>
<h2><a class="anchor" id="r-usb_composite-notes"></a>
Notes</h2>
<p>Please determine by refer to the member "type" in "usb_event_info" structure when getting PCDC channel number which the write event is completed in PCDC + PCDC, PHID + PHID, etc.</p>
<h1><a class="anchor" id="r-usb_compoiste-descriptor"></a>
Descriptor</h1>
<p>Templates for composite device descriptors can be found in ra/fsp/src/r_usb_composite folder. Also, please be sure to use your vendor ID.</p>
<ol type="1">
<li>r_usb_pcdc_pmsc_descriptor.c.template (for PCDC + PMSC)</li>
<li>r_usb_pcdc_phid_descriptor.c.template (for PCDC + PHID)</li>
<li>r_usb_phid_pmsc_descriptor.c.template (for PHID + PMSC)</li>
<li>r_usb_pcdc_pcdc_descriptor.c.template (for PCDC + PCDC)</li>
<li>r_usb_phid_phid_descriptor.c.template (for PHID + PHID)</li>
<li>r_usb_pcdc_pvnd_descriptor.c.template (for PCDC + PVND) and r_usb_pcdc_pvnd_descriptor.h.template (for PCDC + PVND)</li>
</ol>
<h1><a class="anchor" id="r-usb_composite-examples"></a>
Examples</h1>
<h2>USB COMPOSITE Example</h2>
<ul>
<li>PCDC + PHID</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> main_task (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"><span class="preprocessor">  #if (BSP_CFG_RTOS == 2)</span></div><div class="line">    usb_event_info_t * p_mess;</div><div class="line"><span class="preprocessor">  #endif</span></div><div class="line">    usb_event_info_t usb_event;</div><div class="line">    <a class="code" href="group___u_s_b___a_p_i.html#ga56bea25fbffdbda134044c49d40d5e40">usb_status_t</a>     event;</div><div class="line">    uint8_t        * p_idle_value;</div><div class="line">    uint8_t          send_data[16] BSP_ALIGN_VARIABLE(4);</div><div class="line">    uint8_t          req_comp_flag = 0;</div><div class="line">    uint8_t          count         = 0;</div><div class="line"></div><div class="line">    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a71c50854a60a443915487767eac07b01">open</a>(&amp;g_basic0_ctrl, &amp;g_basic0_cfg);</div><div class="line"></div><div class="line">    set_key_data(g_buf_phid);</div><div class="line"></div><div class="line">    <span class="comment">/* Loop back between PC(TerminalSoft) and USB MCU */</span></div><div class="line">    <span class="keywordflow">while</span> (1)</div><div class="line">    {</div><div class="line"><span class="preprocessor">  #if (BSP_CFG_RTOS == 2)</span></div><div class="line">        USB_APL_RCV_MSG(USB_APL_MBX, (usb_msg_t **) &amp;p_mess);</div><div class="line">        usb_event = *p_mess;</div><div class="line">        <span class="keyword">event</span>     = usb_event.event;</div><div class="line"><span class="preprocessor">  #else                                </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line">        <a class="code" href="group___u_s_b.html#gaf882576a8f79312c27fa700d3fb94951">R_USB_EventGet</a>(&amp;usb_event, &amp;event);</div><div class="line"><span class="preprocessor">  #endif </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line">        <span class="keywordflow">switch</span> (event)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ab5c3bd23fe62533150eef3a4e8c8d13c">USB_STATUS_CONFIGURED</a>:</div><div class="line">            {</div><div class="line">                g_status = NO_WRITING;</div><div class="line">                g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a0c728ad83559809e18f18793dfd489ef">read</a>(&amp;g_basic0_ctrl, g_buf, DATA_LEN, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ad44448290b4f36868a09b48e4588b29d">USB_STATUS_WRITE_COMPLETE</a>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (FSP_SUCCESS == usb_event.status)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (usb_event.type == <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>)</div><div class="line">                    {</div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a0c728ad83559809e18f18793dfd489ef">read</a>(&amp;g_basic0_ctrl, g_buf, DATA_LEN, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (usb_event.type == <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2abf75ec21c7f480bc52e8f9b68701ef17">USB_CLASS_PHID</a>)</div><div class="line">                    {</div><div class="line">                        <span class="keywordflow">if</span> (DATA_WRITING == g_status)</div><div class="line">                        {</div><div class="line">                            g_status = ZERO_WRITING;</div><div class="line">                            g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a72dd66056efbc6284c61f557016a75cd">write</a>(&amp;g_basic0_ctrl, (uint8_t *) g_zero_data, DATA_LEN_PHID, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2abf75ec21c7f480bc52e8f9b68701ef17">USB_CLASS_PHID</a>); <span class="comment">/* Sending the zero data (8 bytes) */</span></div><div class="line">                        }</div><div class="line">                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (g_status == ZERO_WRITING)</div><div class="line">                        {</div><div class="line">                            g_status = NO_WRITING;</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a63dd4552584256ef9d1a0d5da2159e9c">USB_STATUS_READ_COMPLETE</a>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> ((FSP_SUCCESS == usb_event.status) || (FSP_ERR_USB_SIZE_SHORT == usb_event.status))</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (usb_event.type == <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>)</div><div class="line">                    {</div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a72dd66056efbc6284c61f557016a75cd">write</a>(&amp;g_basic0_ctrl, g_buf, usb_event.data_size, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>);</div><div class="line">                        <span class="keywordflow">if</span> (req_comp_flag == 1)</div><div class="line">                        {</div><div class="line">                            <span class="keywordflow">if</span> (g_status == NO_WRITING)</div><div class="line">                            {</div><div class="line">                                count++;</div><div class="line">                                g_status = DATA_WRITING;</div><div class="line">                                g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a72dd66056efbc6284c61f557016a75cd">write</a>(&amp;g_basic0_ctrl, g_buf_phid, DATA_LEN_PHID, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2abf75ec21c7f480bc52e8f9b68701ef17">USB_CLASS_PHID</a>);</div><div class="line">                            }</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a8b49ebc4d15054963bdbe8d843a2cf5a">USB_STATUS_REQUEST</a>:   <span class="comment">/* Receive Class Request */</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___p_c_d_c___a_p_i.html#ga9e76ac14dae5e5e44b5df6e8cbee6bd0">USB_PCDC_SET_LINE_CODING</a> == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___u_s_b.html#ga1293995ba77495705db3a3adf703b7f1">R_USB_PeriControlDataGet</a>(&amp;g_basic0_ctrl, (uint8_t *) &amp;g_line_coding, LINE_CODING_LENGTH);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___p_c_d_c___a_p_i.html#ga3e7ae95dcfc42bd8912fe18339893d82">USB_PCDC_GET_LINE_CODING</a> == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___u_s_b.html#ga3fb9080601ee1041e35073e0538a21b0">R_USB_PeriControlDataSet</a>(&amp;g_basic0_ctrl, (uint8_t *) &amp;g_line_coding, LINE_CODING_LENGTH);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_SET_REPORT == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a0c728ad83559809e18f18793dfd489ef">read</a>(&amp;g_basic0_ctrl, (uint8_t *) &amp;g_numlock, 2, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2abf75ec21c7f480bc52e8f9b68701ef17">USB_CLASS_PHID</a>); <span class="comment">/* Get the NumLock data (NumLock data is not used) */</span></div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___a_p_i.html#gab643fa62dbe13073d08006c516b87f9a">USB_GET_DESCRIPTOR</a> == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (USB_GET_REPORT_DESCRIPTOR == usb_event.setup.request_value)</div><div class="line">                    {</div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#adf500dc4e48aab1cce6ecd5d8ed37d87">periControlDataSet</a>(&amp;g_basic0_ctrl,</div><div class="line">                                                        (uint8_t *) g_apl_report,</div><div class="line">                                                        USB_RECEIVE_REPORT_DESCRIPTOR);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_GET_HID_DESCRIPTOR == usb_event.setup.request_value)</div><div class="line">                    {</div><div class="line">                        <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; USB_RECEIVE_HID_DESCRIPTOR; i++)</div><div class="line">                        {</div><div class="line">                            send_data[i] = g_apl_configuration[84 + i];</div><div class="line">                        }</div><div class="line"></div><div class="line">                        <span class="comment">/* Configuration Descriptor address set. */</span></div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#adf500dc4e48aab1cce6ecd5d8ed37d87">periControlDataSet</a>(&amp;g_basic0_ctrl, send_data, USB_RECEIVE_HID_DESCRIPTOR);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span></div><div class="line">                    {</div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a2bf6b2b55ae43aadcf7ed5970f27eb3c">periControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a5033c1aadc5c373ca8f8add7a27850d2">USB_SETUP_STATUS_STALL</a>);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_SET_IDLE == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <span class="comment">/* Get SetIdle value */</span></div><div class="line">                    p_idle_value = (uint8_t *) &amp;usb_event.setup.request_value;</div><div class="line">                    g_idle       = p_idle_value[1];</div><div class="line"></div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a2bf6b2b55ae43aadcf7ed5970f27eb3c">periControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a20a1e7b4a77141981d824649cab7554b">USB_SETUP_STATUS_ACK</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_GET_IDLE == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#adf500dc4e48aab1cce6ecd5d8ed37d87">periControlDataSet</a>(&amp;g_basic0_ctrl, &amp;g_idle, 1);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_SET_PROTOCOL == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a2bf6b2b55ae43aadcf7ed5970f27eb3c">periControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a20a1e7b4a77141981d824649cab7554b">USB_SETUP_STATUS_ACK</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_GET_PROTOCOL == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a2bf6b2b55ae43aadcf7ed5970f27eb3c">periControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a5033c1aadc5c373ca8f8add7a27850d2">USB_SETUP_STATUS_STALL</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a2bf6b2b55ae43aadcf7ed5970f27eb3c">periControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a5033c1aadc5c373ca8f8add7a27850d2">USB_SETUP_STATUS_STALL</a>);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a24e9ad4653245663e5e89bda173141fd">USB_STATUS_REQUEST_COMPLETE</a>: <span class="comment">/* Complete Class Request */</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (USB_SET_IDLE == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    p_idle_value = (uint8_t *) &amp;usb_event.setup.request_value;</div><div class="line"></div><div class="line">                    g_idle = p_idle_value[1];</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_SET_PROTOCOL == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <span class="comment">/* None */</span></div><div class="line">                    <span class="comment">/* g_protocol = event_info.setup.value; */</span></div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    req_comp_flag = 1;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40adb879552af43dda95b70261eaa810777">USB_STATUS_SUSPEND</a>:</div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ae9bcf94bdb90960ca692b1dfecb98e78">USB_STATUS_DETACH</a>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}                                      <span class="comment">/* End of function usb_main() */</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> set_key_data (uint8_t * p_buf)</div><div class="line">{</div><div class="line">    <span class="keyword">static</span> uint8_t key_data;</div><div class="line"></div><div class="line">    key_data = KBD_CODE_A;</div><div class="line"></div><div class="line">    *(p_buf + 2) = key_data;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">  #if (BSP_CFG_RTOS == 2)</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_apl_rec_msg</span></div><div class="line"><span class="comment"> * Description     : Receive a message to the specified id (mailbox).</span></div><div class="line"><span class="comment"> * Argument        : uint8_t id        : ID number (mailbox).</span></div><div class="line"><span class="comment"> *               : usb_msg_t** mess  : Message pointer</span></div><div class="line"><span class="comment"> *               : usb_tm_t tm       : Timeout Value</span></div><div class="line"><span class="comment"> * Return          : uint16_t          : USB_OK / USB_ERROR</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line">usb_er_t usb_apl_rec_msg (uint8_t <span class="keywordtype">id</span>, usb_msg_t ** mess, usb_tm_t tm)</div><div class="line">{</div><div class="line">    BaseType_t    err;</div><div class="line">    QueueHandle_t handle;</div><div class="line">    usb_er_t      result;</div><div class="line"></div><div class="line">    (void) tm;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (NULL == mess)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> USB_APL_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    handle = (*(g_apl_mbx_table[id]));</div><div class="line">    *mess  = NULL;</div><div class="line"></div><div class="line">    err = xQueueReceive(handle, (<span class="keywordtype">void</span> *) mess, (portMAX_DELAY));</div><div class="line">    <span class="keywordflow">if</span> ((pdTRUE == err) &amp;&amp; (NULL != (*mess)))</div><div class="line">    {</div><div class="line">        result = USB_APL_OK;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        result = USB_APL_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> result;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function usb_apl_rec_msg</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_apl_snd_msg</span></div><div class="line"><span class="comment"> * Description     : Send a message to the specified id (mailbox).</span></div><div class="line"><span class="comment"> * Argument        : uint8_t id        : ID number (mailbox).</span></div><div class="line"><span class="comment"> *               : usb_msg_t* mess   : Message pointer</span></div><div class="line"><span class="comment"> * Return          : usb_er_t          : USB_OK / USB_ERROR</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line">usb_er_t usb_apl_snd_msg (uint8_t <span class="keywordtype">id</span>, usb_msg_t * mess)</div><div class="line">{</div><div class="line">    BaseType_t    err;</div><div class="line">    QueueHandle_t handle;</div><div class="line">    usb_er_t      result;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (NULL == mess)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> USB_APL_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    handle = (*(g_apl_mbx_table[id]));</div><div class="line"></div><div class="line">    err = xQueueSend(handle, (<span class="keyword">const</span> <span class="keywordtype">void</span> *) &amp;mess, (TickType_t) (0));</div><div class="line">    <span class="keywordflow">if</span> (pdTRUE == err)</div><div class="line">    {</div><div class="line">        result = USB_APL_OK;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        result = USB_APL_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> result;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function usb_apl_snd_msg</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="preprocessor">  #endif                               </span><span class="comment">/* #if (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line"></div></div><!-- fragment --><ul>
<li>PCDC + PVND</li>
</ul>
<div class="fragment"><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Includes   &lt;System Includes&gt; , &quot;Project Includes&quot;</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="preprocessor">#include &quot;r_usb_basic.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;r_usb_pcdc_api.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;r_usb_pcdc_cfg.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;r_usb_pcdc_pvnd_descriptor.h&quot;</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Macro definitions</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="preprocessor">#define DATA_LEN                         2048</span></div><div class="line"><span class="preprocessor">#define RESET_VALUE                      0</span></div><div class="line"><span class="preprocessor">#define INT_EVT_TSK_STACK_SIZE           1024            </span><span class="comment">/* Stack size of Event notification thread for vendor class&#39;s Interrupt IN/OUT test */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#define INT_EVT_TSK_PRI                  2               </span><span class="comment">/* Priority of Event notification thread for vendor class&#39;s Interrupt IN/OUT test */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line"><span class="preprocessor">#define BUF_SIZE                         (2048)          </span><span class="comment">/* Buffer size */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#define REQ_SIZE                         (20)            </span><span class="comment">/* Request buffer size */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#define USB_VALUE_FF                     (0xFFU)         </span><span class="comment">/* FF macro */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#define USB_APL_MXPS                     (64U)</span></div><div class="line"><span class="preprocessor">#define START_PIPE                       (USB_PIPE1)     </span><span class="comment">/* Start pipe number */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#define END_PIPE                         (USB_PIPE9 + 1) </span><span class="comment">/* Total pipe */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line"><span class="comment">/* for Vendor Class Request */</span></div><div class="line"><span class="preprocessor">#define USB_SET_VENDOR_NO_DATA           (0x0000U)</span></div><div class="line"><span class="preprocessor">#define USB_SET_VENDOR                   (0x0100U)</span></div><div class="line"><span class="preprocessor">#define USB_GET_VENDOR                   (0x0200U)</span></div><div class="line"><span class="preprocessor">#define SET_VENDOR_NO_DATA               (USB_SET_VENDOR_NO_DATA | USB_HOST_TO_DEV | USB_VENDOR | USB_INTERFACE)</span></div><div class="line"><span class="preprocessor">#define SET_VENDOR                       (USB_SET_VENDOR | USB_HOST_TO_DEV | USB_VENDOR | USB_INTERFACE)</span></div><div class="line"><span class="preprocessor">#define GET_VENDOR                       (USB_GET_VENDOR | USB_DEV_TO_HOST | USB_VENDOR | USB_INTERFACE)</span></div><div class="line"><span class="preprocessor">#define DELAY                            (10U) </span><span class="comment">/* Delay for print */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line"><span class="preprocessor">#define USB_STATUS_VENDOR_INTIN_TEST     ((usb_status_t) 0x01)</span></div><div class="line"><span class="preprocessor">#define USB_STATUS_VENDOR_INTOUT_TEST    ((usb_status_t) 0x02)</span></div><div class="line"><span class="preprocessor">#define USB_STATUS_COM_IN_TEST           ((usb_status_t) 0x03)</span></div><div class="line"><span class="preprocessor">#define USB_STATUS_RE_INIT_TEST          ((usb_status_t) 0x04)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define HS_MAX_PACKET_SIZE               (512)</span></div><div class="line"><span class="preprocessor">#define FS_MAX_PACKET_SIZE               (64)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define VALUE_A1H                        (0xA1)</span></div><div class="line"><span class="preprocessor">#define LINE_CODING_LENGTH               (0x07U)</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Private global variables and functions</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keyword">static</span> uint8_t g_cdc_buf[BUF_SIZE]     = {RESET_VALUE};   <span class="comment">/* Data buffer for PCDC Normal Request */</span></div><div class="line"><span class="keyword">static</span> uint8_t g_vnd_buf[BUF_SIZE]     = {RESET_VALUE};   <span class="comment">/* Data buffer for PVND Normal Request */</span></div><div class="line"><span class="keyword">static</span> uint8_t g_request_buf[REQ_SIZE] = {RESET_VALUE};   <span class="comment">/* Data buffer for PVND Class Request  */</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> uint8_t  g_apl_vendor_bulk_in       = RESET_VALUE; <span class="comment">/* Bulk In  Pipe */</span></div><div class="line"><span class="keyword">static</span> uint8_t  g_apl_vendor_bulk_out      = RESET_VALUE; <span class="comment">/* Bulk Out Pipe */</span></div><div class="line"><span class="keyword">static</span> uint8_t  g_apl_vendor_interrupt_in  = RESET_VALUE; <span class="comment">/* Interrupt In Pipe */</span></div><div class="line"><span class="keyword">static</span> uint8_t  g_apl_vendor_interrupt_out = RESET_VALUE; <span class="comment">/* Interrupt Out Pipe */</span></div><div class="line"><span class="keyword">static</span> uint8_t  g_apl_cdc_interrupt_in     = RESET_VALUE; <span class="comment">/* CDC Interrupt In Pipe */</span></div><div class="line"><span class="keyword">static</span> uint16_t g_max_packet_size          = USB_APL_MXPS;</div><div class="line"></div><div class="line"><span class="comment">/* Variable to capture USB event. */</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> usb_event_info_t * p_usb_event = NULL;</div><div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">bool</span>               g_err_flag  = <span class="keyword">false</span>;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> b_usb_attach = <span class="keyword">false</span>;</div><div class="line"><span class="keyword">static</span> <a class="code" href="group___u_s_b___p_c_d_c___a_p_i.html#structusb__pcdc__linecoding__t">usb_pcdc_linecoding_t</a> g_line_coding;</div><div class="line"></div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)</span></div><div class="line"><span class="keyword">static</span> TaskHandle_t g_app_interrupt_event_notify_tsk_hdl;</div><div class="line"><span class="preprocessor">#endif                                 </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line"><span class="keyword">static</span> uint32_t g_interrupt_in_test_flag   = 0;</div><div class="line"><span class="keyword">static</span> uint32_t g_interrupt_out_test_flag  = 0;</div><div class="line"><span class="keyword">static</span> uint32_t g_interrupt_out_times      = 0;</div><div class="line"><span class="keyword">static</span> uint32_t g_interrupt_com_event      = 0;</div><div class="line"><span class="keyword">static</span> uint8_t  g_interrupt_in_com_data[8] = {VALUE_A1H, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};</div><div class="line"><span class="keyword">static</span> uint32_t g_test_reinit_flag         = 0;</div><div class="line"></div><div class="line"><span class="comment">/* Interrupt Event for Application */</span></div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)</span></div><div class="line"><span class="keyword">static</span> usb_event_info_t   g_event_info2;</div><div class="line"><span class="keyword">static</span> usb_event_info_t * g_p_event_info2;</div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="keyword">static</span> usb_event_info_t g_usb_event;</div><div class="line"><span class="keyword">static</span> <a class="code" href="group___u_s_b___a_p_i.html#ga56bea25fbffdbda134044c49d40d5e40">usb_status_t</a>     g_event;</div><div class="line"><span class="keyword">static</span> uint32_t         g_event2;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <a class="code" href="group___u_s_b___a_p_i.html#structusb__cfg__t">usb_cfg_t</a> g_basic0_cfg;</div><div class="line"><a class="code" href="group___u_s_b.html#gad5c104adfb44c721d9c664bf7fabddfb">usb_instance_ctrl_t</a>    g_basic0_ctrl;</div><div class="line"></div><div class="line"><span class="comment">/* Function definitions */</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> process_usb_events(<span class="keywordtype">void</span>);</div><div class="line"><span class="keyword">static</span> <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> process_usb_events_for_interrupt(<span class="keywordtype">void</span>);</div><div class="line"><span class="keyword">static</span> <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> usb_configured_event_process(<span class="keywordtype">void</span>);</div><div class="line"><span class="keyword">static</span> <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> usb_status_request(<span class="keywordtype">void</span>);</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>      handle_error(<a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> err);</div><div class="line"><span class="keyword">static</span> <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> buffer_check(uint32_t length);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> usb_composite_thread_entry(<span class="keywordtype">void</span> * pvParameters);</div><div class="line"><span class="keywordtype">void</span> usb_app_interrupt_event_task(<span class="keywordtype">void</span> * pvParameters);</div><div class="line"></div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)</span></div><div class="line"><span class="keywordtype">void</span> usb_composite_callback(usb_event_info_t * p_event_info, usb_hdl_t handler, <a class="code" href="group___u_s_b___a_p_i.html#ga647c9ea8cc8c82a26dcec32f7749c73d">usb_onoff_t</a> on_off);</div><div class="line"></div><div class="line"><span class="preprocessor">#endif                                 </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_app_interrupt_event_task</span></div><div class="line"><span class="comment"> * Description     : Event notification thread for Interrupt IN/OUT test.</span></div><div class="line"><span class="comment"> * Argument        : void * pvParameters : Ipointer to  pvParameters</span></div><div class="line"><span class="comment"> * Return          : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> usb_app_interrupt_event_task (<span class="keywordtype">void</span> * pvParameters)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(pvParameters);</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (1)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (1 == g_interrupt_in_test_flag)</div><div class="line">        {</div><div class="line">            g_interrupt_in_test_flag = 0;</div><div class="line"></div><div class="line">            g_event_info2.event = USB_STATUS_VENDOR_INTIN_TEST;</div><div class="line">            g_p_event_info2     = &amp;g_event_info2;</div><div class="line"></div><div class="line">            <span class="comment">/* Send Interrupt-IN event to queue */</span></div><div class="line">            <span class="keywordflow">if</span> (pdTRUE != (xQueueSend(g_event_queue, (<span class="keyword">const</span> <span class="keywordtype">void</span> *) &amp;g_p_event_info2, (TickType_t) (RESET_VALUE))))</div><div class="line">            {</div><div class="line">                g_err_flag = <span class="keyword">true</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (1 == g_interrupt_out_test_flag)</div><div class="line">        {</div><div class="line">            g_interrupt_out_test_flag = 0;</div><div class="line"></div><div class="line">            g_event_info2.event = USB_STATUS_VENDOR_INTOUT_TEST;</div><div class="line">            g_p_event_info2     = &amp;g_event_info2;</div><div class="line"></div><div class="line">            <span class="comment">/* Send Interrupt-OUT event to queue */</span></div><div class="line">            <span class="keywordflow">if</span> (pdTRUE != (xQueueSend(g_event_queue, (<span class="keyword">const</span> <span class="keywordtype">void</span> *) &amp;g_p_event_info2, (TickType_t) (RESET_VALUE))))</div><div class="line">            {</div><div class="line">                g_err_flag = <span class="keyword">true</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (0 != g_interrupt_com_event)</div><div class="line">        {</div><div class="line">            g_interrupt_com_event = 0;</div><div class="line"></div><div class="line">            g_event_info2.event = USB_STATUS_COM_IN_TEST;</div><div class="line">            g_p_event_info2     = &amp;g_event_info2;</div><div class="line"></div><div class="line">            <span class="comment">/* Send Interrupt-IN event to queue */</span></div><div class="line">            <span class="keywordflow">if</span> (pdTRUE != (xQueueSend(g_event_queue, (<span class="keyword">const</span> <span class="keywordtype">void</span> *) &amp;g_p_event_info2, (TickType_t) (RESET_VALUE))))</div><div class="line">            {</div><div class="line">                g_err_flag = <span class="keyword">true</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (0 != g_test_reinit_flag)</div><div class="line">        {</div><div class="line">            g_test_reinit_flag = 0;</div><div class="line"></div><div class="line">            g_event_info2.event = USB_STATUS_RE_INIT_TEST;</div><div class="line">            g_p_event_info2     = &amp;g_event_info2;</div><div class="line"></div><div class="line">            <span class="comment">/* Send RE_INIT_TEST event to queue */</span></div><div class="line">            <span class="keywordflow">if</span> (pdTRUE != (xQueueSend(g_event_queue, (<span class="keyword">const</span> <span class="keywordtype">void</span> *) &amp;g_p_event_info2, (TickType_t) (RESET_VALUE))))</div><div class="line">            {</div><div class="line">                g_err_flag = <span class="keyword">true</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        vTaskDelay(100);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function usb_app_interrupt_event_task</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="preprocessor">#endif                                 </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_composite_thread_entry</span></div><div class="line"><span class="comment"> * Description     : Peripheral CDC &amp; Vendor application main process</span></div><div class="line"><span class="comment"> * Arguments       : none</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> usb_composite_thread_entry (<span class="keywordtype">void</span> * pvParameters)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(pvParameters);</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> err = FSP_SUCCESS;</div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)</span></div><div class="line">    BaseType_t err_queue = pdFALSE;</div><div class="line">    BaseType_t err_task  = pdFALSE;</div><div class="line"><span class="preprocessor">#endif                                 </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line">    <span class="comment">/* Open USB instance */</span></div><div class="line">    <a class="code" href="group___u_s_b.html#gab9810a1d8e322cb89a9a7f9ca84a368f">R_USB_Open</a>(&amp;g_basic0_ctrl, &amp;g_basic0_cfg);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___a_p_i.html#gga624cde5d2f6383faa35fd05108285a23a20bb7ec351e3d0ea8d4568e7258a8319">USB_SPEED_FS</a> == g_basic0_cfg.<a class="code" href="group___u_s_b___a_p_i.html#aa919f6650429527890059d928fc01ef5">usb_speed</a>)</div><div class="line">    {</div><div class="line">        g_max_packet_size = FS_MAX_PACKET_SIZE;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        g_max_packet_size = HS_MAX_PACKET_SIZE;</div><div class="line">    }</div><div class="line"></div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)</span></div><div class="line">    err_task = xTaskCreate((TaskFunction_t) usb_app_interrupt_event_task, </div><div class="line">                           <span class="stringliteral">&quot;INT_EVT_TSK&quot;</span>,                                 </div><div class="line">                           INT_EVT_TSK_STACK_SIZE,                        </div><div class="line">                           NULL,                                          </div><div class="line">                           INT_EVT_TSK_PRI,                               </div><div class="line">                           &amp;g_app_interrupt_event_notify_tsk_hdl);        </div><div class="line">    <span class="keywordflow">if</span> (pdPASS != err_task)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Handle error if queue send fails*/</span></div><div class="line">        <span class="keywordflow">if</span> (<span class="keyword">true</span> == g_err_flag)</div><div class="line">        {</div><div class="line">            handle_error(<a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#ggadfb1288da0fcc7ae1dc88c58601374f8abf03281ffe5a1adc5b3081f7adfe3f4e">FSP_ERR_ABORTED</a>);</div><div class="line">        }</div><div class="line"></div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)</span></div><div class="line"></div><div class="line">        <span class="comment">/* Receive message from queue */</span></div><div class="line">        err_queue = xQueueReceive(g_event_queue, &amp;p_usb_event, (portMAX_DELAY));</div><div class="line"></div><div class="line">        <span class="comment">/* Handle error */</span></div><div class="line">        <span class="keywordflow">if</span> (pdTRUE != err_queue)</div><div class="line">        {</div><div class="line">            handle_error(<a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#ggadfb1288da0fcc7ae1dc88c58601374f8abf03281ffe5a1adc5b3081f7adfe3f4e">FSP_ERR_ABORTED</a>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (pdTRUE == err_queue)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (p_usb_event == &amp;g_event_info2)</div><div class="line">            {</div><div class="line">                <span class="comment">/* process Application Interrupt events */</span></div><div class="line">                err = process_usb_events_for_interrupt();</div><div class="line">                handle_error(err);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                <span class="comment">/* process USB events */</span></div><div class="line">                err = process_usb_events();</div><div class="line">                handle_error(err);</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line"><span class="preprocessor">#else                                  </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line">        <a class="code" href="group___u_s_b.html#gaf882576a8f79312c27fa700d3fb94951">R_USB_EventGet</a>(&amp;g_usb_event, &amp;g_event);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ae72a3238bb093c114ec31ceff66f9a70">USB_STATUS_NONE</a> == g_event)</div><div class="line">        {</div><div class="line">            <span class="comment">/* Interrupt IN Test Event for Vendor Class */</span></div><div class="line">            <span class="keywordflow">if</span> (1 == g_interrupt_in_test_flag)</div><div class="line">            {</div><div class="line">                g_interrupt_in_test_flag = 0;</div><div class="line">                g_event2                 = USB_STATUS_VENDOR_INTIN_TEST;</div><div class="line">                err = process_usb_events_for_interrupt();</div><div class="line">            }</div><div class="line">            <span class="comment">/* Interrupt OUT Test Event for Vendor Class */</span></div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (1 == g_interrupt_out_test_flag)</div><div class="line">            {</div><div class="line">                g_interrupt_out_test_flag = 0;</div><div class="line">                g_event2 = USB_STATUS_VENDOR_INTOUT_TEST;</div><div class="line">                err      = process_usb_events_for_interrupt();</div><div class="line">            }</div><div class="line">            <span class="comment">/* Interrupt IN Test Event for COM Class */</span></div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 != g_interrupt_com_event)</div><div class="line">            {</div><div class="line">                g_interrupt_com_event = 0;</div><div class="line">                g_event2              = USB_STATUS_COM_IN_TEST;</div><div class="line">                err = process_usb_events_for_interrupt();</div><div class="line">            }</div><div class="line">            <span class="comment">/* ReInit Test Event */</span></div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 != g_test_reinit_flag)</div><div class="line">            {</div><div class="line">                g_test_reinit_flag = 0;</div><div class="line">                g_event2           = USB_STATUS_RE_INIT_TEST;</div><div class="line">                err                = process_usb_events_for_interrupt();</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                err = process_usb_events();</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            p_usb_event = &amp;g_usb_event;</div><div class="line">            err         = process_usb_events();</div><div class="line">        }</div><div class="line">        handle_error(err);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function usb_composite_thread_entry</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : process_usb_events</span></div><div class="line"><span class="comment"> * Description     : Function processes usb events.</span></div><div class="line"><span class="comment"> * Arguments       : none</span></div><div class="line"><span class="comment"> * Return value    : Any Other Error code apart from FSP_SUCCESS on Unsuccessful operation.</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> process_usb_events (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> err = FSP_SUCCESS;</div><div class="line"></div><div class="line">    <span class="comment">/* USB event received */</span></div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)</span></div><div class="line">    <span class="keywordflow">switch</span> (p_usb_event-&gt;event)</div><div class="line"><span class="preprocessor">#else                                  </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line">    <span class="keywordflow">switch</span> (g_event)</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ab5c3bd23fe62533150eef3a4e8c8d13c">USB_STATUS_CONFIGURED</a>:    <span class="comment">/* Configured State */</span></div><div class="line">        {</div><div class="line">            <span class="comment">/* Process USB configured event */</span></div><div class="line">            usb_configured_event_process();</div><div class="line"></div><div class="line">            <span class="comment">/* [PCDC] Read data from terminal software */</span></div><div class="line">            <a class="code" href="group___u_s_b.html#ga42ad1cbad598d06023d83e8a91fd49d4">R_USB_Read</a>(&amp;g_basic0_ctrl, g_cdc_buf, g_max_packet_size, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>);</div><div class="line"></div><div class="line">            <span class="comment">/* [PVND] Read data from ra_usb_hvnd.exe */</span></div><div class="line">            memset(g_vnd_buf, RESET_VALUE, BUF_SIZE);</div><div class="line">            err = <a class="code" href="group___u_s_b.html#ga5bee47c1fb4dfb12eba430226122bd57">R_USB_PipeRead</a>(&amp;g_basic0_ctrl, &amp;g_vnd_buf[RESET_VALUE], BUF_SIZE, g_apl_vendor_bulk_out);</div><div class="line"></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ad44448290b4f36868a09b48e4588b29d">USB_STATUS_WRITE_COMPLETE</a>: <span class="comment">/* Write Complete State */</span></div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (FSP_SUCCESS == p_usb_event-&gt;status)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (b_usb_attach)</div><div class="line">                {</div><div class="line">                    <span class="comment">/* [PCDC] Read data from terminal software */</span></div><div class="line">                    <span class="keywordflow">if</span> ((<a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a> == p_usb_event-&gt;type) &amp;&amp; (FSP_ERR_USB_FAILED != p_usb_event-&gt;status))</div><div class="line">                    {</div><div class="line">                        err = <a class="code" href="group___u_s_b.html#ga42ad1cbad598d06023d83e8a91fd49d4">R_USB_Read</a>(&amp;g_basic0_ctrl, g_cdc_buf, g_max_packet_size, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>);</div><div class="line">                    }</div><div class="line"></div><div class="line">                    <span class="comment">/* [PVND] Read data from ra_usb_hvnd.exe */</span></div><div class="line">                    <span class="keywordflow">if</span> ((g_apl_vendor_bulk_in == p_usb_event-&gt;pipe) &amp;&amp; (FSP_ERR_USB_FAILED != p_usb_event-&gt;status))</div><div class="line">                    {</div><div class="line">                        memset(g_vnd_buf, RESET_VALUE, BUF_SIZE);</div><div class="line"></div><div class="line">                        <span class="comment">/* Read data back */</span></div><div class="line">                        err = <a class="code" href="group___u_s_b.html#ga5bee47c1fb4dfb12eba430226122bd57">R_USB_PipeRead</a>(&amp;g_basic0_ctrl, &amp;g_vnd_buf[RESET_VALUE], BUF_SIZE, g_apl_vendor_bulk_out);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    <span class="comment">// Do Nothing as USB is removed and not connected yet.</span></div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a63dd4552584256ef9d1a0d5da2159e9c">USB_STATUS_READ_COMPLETE</a>: <span class="comment">/* Read Complete State */</span></div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> ((FSP_SUCCESS == p_usb_event-&gt;status) || (FSP_ERR_USB_SIZE_SHORT == p_usb_event-&gt;status))</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (b_usb_attach)</div><div class="line">                {</div><div class="line">                    <span class="comment">/* PCDC */</span></div><div class="line">                    <span class="keywordflow">if</span> ((<a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a> == p_usb_event-&gt;type) &amp;&amp; (FSP_ERR_USB_FAILED != p_usb_event-&gt;status))</div><div class="line">                    {</div><div class="line">                        <span class="comment">/* Write back the read data from terminal software to it. */</span></div><div class="line">                        err = <a class="code" href="group___u_s_b.html#ga001f40866be6438435e65e78871a54d5">R_USB_Write</a>(&amp;g_basic0_ctrl, g_cdc_buf, p_usb_event-&gt;data_size, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>);</div><div class="line">                    }</div><div class="line"></div><div class="line">                    <span class="comment">/* PVND */</span></div><div class="line">                    <span class="keywordflow">if</span> ((g_apl_vendor_bulk_out == p_usb_event-&gt;pipe) &amp;&amp; (FSP_ERR_USB_FAILED != p_usb_event-&gt;status))</div><div class="line">                    {</div><div class="line">                        <span class="comment">/* Data comparison read from host */</span></div><div class="line">                        err = buffer_check(p_usb_event-&gt;data_size);</div><div class="line">                        <span class="keywordflow">if</span> (FSP_SUCCESS == err)</div><div class="line">                        {</div><div class="line">                            <span class="comment">/* Write data back to host */</span></div><div class="line">                            <a class="code" href="group___u_s_b.html#ga4f800b5c189c92d58d23972142214d22">R_USB_PipeWrite</a>(&amp;g_basic0_ctrl,</div><div class="line">                                            &amp;g_vnd_buf[RESET_VALUE],</div><div class="line">                                            p_usb_event-&gt;data_size,</div><div class="line">                                            g_apl_vendor_bulk_in);</div><div class="line">                        }</div><div class="line">                        <span class="keywordflow">else</span></div><div class="line">                        {</div><div class="line">                            <span class="keywordflow">return</span> FSP_ERR_USB_FAILED;</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    <span class="comment">// Do Nothing as USB is removed and not connected yet.</span></div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a8b49ebc4d15054963bdbe8d843a2cf5a">USB_STATUS_REQUEST</a>:       <span class="comment">/* Receive Class Request */</span></div><div class="line">        {</div><div class="line">            <span class="comment">/* Perform usb status request operation.*/</span></div><div class="line">            err = usb_status_request();</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a24e9ad4653245663e5e89bda173141fd">USB_STATUS_REQUEST_COMPLETE</a>: <span class="comment">/* Request Complete State */</span></div><div class="line">        {</div><div class="line">            <span class="comment">// Do Nothing.</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ae9bcf94bdb90960ca692b1dfecb98e78">USB_STATUS_DETACH</a>:</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40adb879552af43dda95b70261eaa810777">USB_STATUS_SUSPEND</a>:</div><div class="line">        {</div><div class="line">            <span class="comment">/* Reset the usb attached flag as indicating usb is removed.*/</span></div><div class="line">            b_usb_attach = <span class="keyword">false</span>;</div><div class="line">            memset(g_cdc_buf, RESET_VALUE, <span class="keyword">sizeof</span>(g_cdc_buf));</div><div class="line">            memset(g_vnd_buf, RESET_VALUE, <span class="keyword">sizeof</span>(g_vnd_buf));</div><div class="line"></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a371560d9894f862cdbc8bb288655a64e">USB_STATUS_RESUME</a>:</div><div class="line">        {</div><div class="line">            <span class="comment">/* set the usb attached flag*/</span></div><div class="line">            b_usb_attach = <span class="keyword">true</span>;</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> err;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function process_usb_events</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : process_usb_events_for_interrupt</span></div><div class="line"><span class="comment"> * Description     : Function processes Application events (Interrupt IN/OUT Request ).</span></div><div class="line"><span class="comment"> * Arguments       : none</span></div><div class="line"><span class="comment"> * Return value    : Any Other Error code apart from FSP_SUCCESS on Unsuccessful operation.</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> process_usb_events_for_interrupt (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> err  = FSP_SUCCESS;</div><div class="line">    uint8_t   pipe = RESET_VALUE;</div><div class="line"></div><div class="line">    <span class="comment">/* USB event received */</span></div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)</span></div><div class="line">    <span class="keywordflow">switch</span> (p_usb_event-&gt;event)</div><div class="line"><span class="preprocessor">#else                                  </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line">    <span class="keywordflow">switch</span> (g_event2)</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">case</span> USB_STATUS_VENDOR_INTIN_TEST:</div><div class="line">        {</div><div class="line">            pipe = g_apl_vendor_interrupt_in;</div><div class="line">            err  = <a class="code" href="group___u_s_b.html#ga4f800b5c189c92d58d23972142214d22">R_USB_PipeWrite</a>(&amp;g_basic0_ctrl, (uint8_t *) <span class="stringliteral">&quot;interrupt-in-test&quot;</span>, strlen(<span class="stringliteral">&quot;interrupt-in-test&quot;</span>), pipe);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> USB_STATUS_VENDOR_INTOUT_TEST:</div><div class="line">        {</div><div class="line">            pipe = g_apl_vendor_interrupt_out;</div><div class="line">            err  = <a class="code" href="group___u_s_b.html#ga5bee47c1fb4dfb12eba430226122bd57">R_USB_PipeRead</a>(&amp;g_basic0_ctrl, &amp;g_vnd_buf[RESET_VALUE], (BUF_SIZE), pipe);</div><div class="line">            <span class="keywordflow">if</span> (FSP_SUCCESS == err)</div><div class="line">            {</div><div class="line">                g_interrupt_out_times++;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> USB_STATUS_COM_IN_TEST:</div><div class="line">        {</div><div class="line">            pipe = g_apl_cdc_interrupt_in;</div><div class="line">            err  = <a class="code" href="group___u_s_b.html#ga4f800b5c189c92d58d23972142214d22">R_USB_PipeWrite</a>(&amp;g_basic0_ctrl, g_interrupt_in_com_data, <span class="keyword">sizeof</span>(g_interrupt_in_com_data), pipe);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> USB_STATUS_RE_INIT_TEST:</div><div class="line">        {</div><div class="line">            g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#af4155b3280c5f0701917e305abebf802">close</a>(&amp;g_basic0_ctrl);</div><div class="line">            g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a71c50854a60a443915487767eac07b01">open</a>(&amp;g_basic0_ctrl, &amp;g_basic0_cfg);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">        {</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> err;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function process_usb_events_for_interrupt</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_configured_event_process</span></div><div class="line"><span class="comment"> * Description     : Function processes USB configured event (for vendor class).</span></div><div class="line"><span class="comment"> * Arguments       : none</span></div><div class="line"><span class="comment"> * Return value    : Any Other Error code apart from FSP_SUCCESS on Unsuccessful operation.</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> usb_configured_event_process (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>  err       = FSP_SUCCESS;</div><div class="line">    uint16_t   used_pipe = RESET_VALUE;</div><div class="line">    usb_pipe_t pipe_info = {RESET_VALUE};</div><div class="line">    uint8_t    pipe      = RESET_VALUE;</div><div class="line"></div><div class="line">    <span class="comment">/* Get USB Pipe Information */</span></div><div class="line">    err = <a class="code" href="group___u_s_b.html#ga112c7de01280de80c529ec61789c9cc0">R_USB_UsedPipesGet</a>(&amp;g_basic0_ctrl, &amp;used_pipe, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2af29ff035832b2ed9568dd3e674052265">USB_CLASS_PVND</a>);</div><div class="line">    <span class="keywordflow">if</span> (FSP_SUCCESS == err)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">for</span> (pipe = START_PIPE; pipe &lt; END_PIPE; pipe++)</div><div class="line">        {</div><div class="line">            <span class="comment">/* check for the used pipe */</span></div><div class="line">            <span class="keywordflow">if</span> ((used_pipe &amp; (START_PIPE &lt;&lt; pipe)) != RESET_VALUE)</div><div class="line">            {</div><div class="line">                <span class="comment">/* Get the pipe Info */</span></div><div class="line">                err = <a class="code" href="group___u_s_b.html#ga08f0810f299c825fae9a9f8ada2f9dbf">R_USB_PipeInfoGet</a>(&amp;g_basic0_ctrl, &amp;pipe_info, pipe);</div><div class="line"></div><div class="line">                <span class="comment">/* Mask out the direction bit to obtain the endpoint numb value for switch evaluation */</span></div><div class="line">                <span class="keywordflow">switch</span> (pipe_info.endpoint &amp; ~<a class="code" href="group___u_s_b___a_p_i.html#gaae8411e95f26738326bc25a0161dde99">USB_EP_DIR_IN</a>)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">case</span> USB_VENDOR_BULK_OUT_EP:</div><div class="line">                    {</div><div class="line">                        g_apl_vendor_bulk_out = pipe;</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line"></div><div class="line">                    <span class="keywordflow">case</span> USB_VENDOR_BULK_IN_EP:</div><div class="line">                    {</div><div class="line">                        g_apl_vendor_bulk_in = pipe;</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line"></div><div class="line">                    <span class="keywordflow">case</span> USB_VENDOR_INT_OUT_EP:</div><div class="line">                    {</div><div class="line">                        g_apl_vendor_interrupt_out = pipe;</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line"></div><div class="line">                    <span class="keywordflow">case</span> USB_VENDOR_INT_IN_EP:</div><div class="line">                    {</div><div class="line">                        g_apl_vendor_interrupt_in = pipe;</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line"></div><div class="line">                    <span class="keywordflow">case</span> USB_CDC_INT_IN_EP:</div><div class="line">                    {</div><div class="line">                        g_apl_cdc_interrupt_in = pipe;</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line"></div><div class="line">                    <span class="keywordflow">default</span>:</div><div class="line">                    {</div><div class="line">                        <span class="comment">/* Do nothing */</span></div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                <span class="comment">/* Do nothing */</span></div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> err;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function usb_configured_event_process</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_status_request</span></div><div class="line"><span class="comment"> * Description     : Function processes usb status request.</span></div><div class="line"><span class="comment"> * Arguments       : none</span></div><div class="line"><span class="comment"> * Return value    : Any Other Error code apart from FSP_SUCCESS on Unsuccessful operation.</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> usb_status_request (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> err            = FSP_SUCCESS;</div><div class="line">    uint16_t  request_length = RESET_VALUE;</div><div class="line"></div><div class="line">    <span class="comment">/* Check for the specific CDC class request IDs */</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___p_c_d_c___a_p_i.html#ga9e76ac14dae5e5e44b5df6e8cbee6bd0">USB_PCDC_SET_LINE_CODING</a> == (p_usb_event-&gt;setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Get the class request.*/</span></div><div class="line">        err = <a class="code" href="group___u_s_b.html#ga1293995ba77495705db3a3adf703b7f1">R_USB_PeriControlDataGet</a>(&amp;g_basic0_ctrl, (uint8_t *) &amp;g_line_coding, LINE_CODING_LENGTH);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___p_c_d_c___a_p_i.html#ga3e7ae95dcfc42bd8912fe18339893d82">USB_PCDC_GET_LINE_CODING</a> == (p_usb_event-&gt;setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Set the class request.*/</span></div><div class="line">        err = <a class="code" href="group___u_s_b.html#ga3fb9080601ee1041e35073e0538a21b0">R_USB_PeriControlDataSet</a>(&amp;g_basic0_ctrl, (uint8_t *) &amp;g_line_coding, LINE_CODING_LENGTH);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___p_c_d_c___a_p_i.html#ga6f454d69f2a0ee2fcae6793f1b0cd40a">USB_PCDC_SET_CONTROL_LINE_STATE</a> == (p_usb_event-&gt;setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Set the usb status as ACK response.*/</span></div><div class="line">        err = <a class="code" href="group___u_s_b.html#gaf8976d11f8be52c3f9422563188d6ab9">R_USB_PeriControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a20a1e7b4a77141981d824649cab7554b">USB_SETUP_STATUS_ACK</a>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_SET_VENDOR_NO_DATA == (p_usb_event-&gt;setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">    {</div><div class="line">        <span class="comment">/* Set ACk to host */</span></div><div class="line">        err = <a class="code" href="group___u_s_b.html#gaf8976d11f8be52c3f9422563188d6ab9">R_USB_PeriControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a20a1e7b4a77141981d824649cab7554b">USB_SETUP_STATUS_ACK</a>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_SET_VENDOR == (p_usb_event-&gt;setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">    {</div><div class="line">        request_length = p_usb_event-&gt;setup.request_length;</div><div class="line"></div><div class="line">        <span class="comment">/* Get data length from host */</span></div><div class="line">        err = <a class="code" href="group___u_s_b.html#ga1293995ba77495705db3a3adf703b7f1">R_USB_PeriControlDataGet</a>(&amp;g_basic0_ctrl, &amp;g_request_buf[RESET_VALUE], request_length);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_GET_VENDOR == (p_usb_event-&gt;setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">    {</div><div class="line">        request_length = p_usb_event-&gt;setup.request_length;</div><div class="line"></div><div class="line">        <span class="comment">/* Set data length in peripheral */</span></div><div class="line">        err = <a class="code" href="group___u_s_b.html#ga3fb9080601ee1041e35073e0538a21b0">R_USB_PeriControlDataSet</a>(&amp;g_basic0_ctrl, &amp;g_request_buf[RESET_VALUE], request_length);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="comment">// Do Nothing.</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> err;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function usb_status_request</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_composite_callback</span></div><div class="line"><span class="comment"> * Description     : Callback function for Application program</span></div><div class="line"><span class="comment"> * Arguments       : usb_event_info_t *p_event_info : Control structure for USB API.</span></div><div class="line"><span class="comment"> *                   usb_hdl_t handler : Task Handle</span></div><div class="line"><span class="comment"> *                   usb_onoff_t usbon_off_state : USB_ON(USB_STATUS_REQUEST) / USB_OFF</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> usb_composite_callback (usb_event_info_t * p_event_info, usb_hdl_t handler, <a class="code" href="group___u_s_b___a_p_i.html#ga647c9ea8cc8c82a26dcec32f7749c73d">usb_onoff_t</a> on_off)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(handler);</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(on_off);</div><div class="line"></div><div class="line">    <span class="comment">/* Send event received to queue */</span></div><div class="line">    <span class="keywordflow">if</span> (pdTRUE != (xQueueSend(g_event_queue, (<span class="keyword">const</span> <span class="keywordtype">void</span> *) &amp;p_event_info, (TickType_t) (RESET_VALUE))))</div><div class="line">    {</div><div class="line">        g_err_flag = <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function usb_composite_callback</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="preprocessor">#endif                                 </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : handle_error</span></div><div class="line"><span class="comment"> * Description     : Closes the USB module , Print and traps error.</span></div><div class="line"><span class="comment"> * Arguments       : fsp_err_t err : error status</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> handle_error (<a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> err)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (FSP_SUCCESS != err)</div><div class="line">    {</div><div class="line">        <a class="code" href="group___u_s_b.html#ga42c6c75ae96e3860b726d1b0dcbf110d">R_USB_Close</a>(&amp;g_basic0_ctrl);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function handle_error</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : buffer_check</span></div><div class="line"><span class="comment"> * Description     : Check data received from vendor host tools</span></div><div class="line"><span class="comment"> * Arguments       : uint32_t length : data length</span></div><div class="line"><span class="comment"> *                   char * err_str : error string</span></div><div class="line"><span class="comment"> * Return value    : Any Other Error code apart from FSP_SUCCESS on Unsuccessful operation.</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a> buffer_check (uint32_t length)</div><div class="line">{</div><div class="line">    <span class="keywordflow">for</span> (uint16_t cnt = RESET_VALUE; cnt &lt; (uint16_t) length; cnt++)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> ((uint8_t) (cnt &amp; USB_VALUE_FF) != g_vnd_buf[cnt])</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#ggadfb1288da0fcc7ae1dc88c58601374f8abf03281ffe5a1adc5b3081f7adfe3f4e">FSP_ERR_ABORTED</a>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group___b_s_p___m_c_u.html#gaf3219448adfd1531cf69f68697ab184b">R_BSP_SoftwareDelay</a>(DELAY, <a class="code" href="group___b_s_p___m_c_u.html#ggafd98e2a6f080d6a52a3ef72e3d731b2ba59fcc4e8d51046d4a1bd63c87ac64913">BSP_DELAY_UNITS_MILLISECONDS</a>);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> FSP_SUCCESS;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function buffer_check</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"></div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
        <li class="footer">FSP Release v6.2.0 User's Manual Copyright © (2025) Renesas Electronics Corporation. All Rights Reserved.</li>
  </ul>
</div>
</body>
</html>
