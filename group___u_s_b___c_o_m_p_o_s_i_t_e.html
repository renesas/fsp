<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>RA Flexible Software Package Documentation: USB Composite (r_usb_composite)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <script type="text/javascript" src="search/lunr.js"></script>
    <link href="search/lunrsearch.css" rel="stylesheet" type="text/css">
    <script src="search/lunr_index.js"></script>
    <script src="search/lunrclient.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="fsp_customdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_scaled.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">RA Flexible Software Package Documentation
   &#160;<span id="projectnumber">Release v4.1.0</span>
   </div>
  </td>
   <td>        <br /><div id="MSearchBox" class="MSearchBoxInactive">
 
    <form id="lunrSearchForm" name="lunrSearchForm">
      <span class="left" >
          <img id="MSearchSelect" src="search/mag_sel.png"
               alt=""/>
         <input class="search-input" id="MSearchField" name="q" placeholder="Search" type="text"> 
      </span>
      <span class="right">
          &nbsp; 
      </span>
        <!--<input type="submit" value="Search">-->
    </form>
</div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___u_s_b___c_o_m_p_o_s_i_t_e.html','');});
</script>

<script src="search/mark.min.js"></script>
<script type="text/javascript">
  $(document).ready(function() { 
    var options = {         // allows highlighting across element boundaries.
      "acrossElements": true
    };
    var bodyText = $("div.contents").text(); // try contents instead of body. 
    // If using body: Problem may be that text inside <script> tags is included in .text() - but not in cheerio?
    // If using div.contents - works 
    var fullURL = $(location).attr('href');
    var splitURL = fullURL.split("?");  // Get param string: content after "?" in URL
    if (splitURL.length > 1) {          // If any content after "?"
      var paramStr = splitURL[1];
      var params = paramStr.split("&"); // Split params on "&"
      for (i = 0; i < params.length; i++) {
        var paramPair = params[i].split("=");
        if (paramPair[0] == "pos") {     // If any param starts "pos", get the content after "="
          posStr = paramPair[1];
          var splitPos = posStr.split(",");
          var termArray = [];
        // termArray will have the search terms
            for (i=0; i < splitPos.length; i += 2) {
            start = splitPos[i];
            len = splitPos[i+1]; // Needs error detection! Vulnerable if non-even # of pos entries
            term = bodyText.substr(start,len);
            if (termArray.includes(term) == false) {     // List all unique terms
                termArray.push(bodyText.substr(start,len)); 
            }
          } 
    //      console.log(termArray);
          var context = document.querySelector("div.contents");
          var instance = new Mark(context);
          for(i=0;i<termArray.length; i+=1) {
            instance.mark(termArray[i],options);  // Use Mark.js to mark all terms in termArray
            }    
          var firstMark = document.querySelector("mark");
          firstMark.scrollIntoView(true);
          //      console.log($("mark").first().text()); // Trying to scroll to first Mark element. 
        }
            }
    }
  });
</script>

<link href="fsp_customdoxygen.css" rel="stylesheet" type="text/css" />

<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


<!-- Lunr search results -->
<div id="lunrResultBox" style="
        position: fixed;
        border: 1px solid black;
        background-color: WhiteSmoke;  
        padding: 10px;
        width: 500px;
        height: 500px;
        top: 30;
        right: 0;
        overflow: auto;
        display: none">
    <button onclick="closeLunrResults()" style="float: right;">X</button>
    <div class="resultCount" id="resultCount"></div>
    <div id="searchResults"></div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">USB Composite (r_usb_composite)<div class="ingroups"><a class="el" href="group___r_e_n_e_s_a_s___m_o_d_u_l_e_s.html">Modules</a> &raquo; <a class="el" href="group___r_e_n_e_s_a_s___c_o_n_n_e_c_t_i_v_i_t_y___m_o_d_u_l_e_s.html">Connectivity</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p><a class="anchor" id="functionss"></a></p><h2 class="groupheader">Functions</h2>
<p>Refer to <a class="el" href="group___u_s_b.html">USB (r_usb_basic)</a> for the common API (r_usb_basic) to be called from the application.</p>
<h1><a class="anchor" id="r-usb_compoiste-overview"></a>
Overview</h1>
<p>USB composite device works as a USB Peripheral by combining two peripheral device classes and r_usb_basic module. <br />
This USB driver supports the following composite devices:</p><ol type="1">
<li>PCDC + PMSC</li>
<li>PCDC + PHID</li>
<li>PHID + PMSC</li>
<li>PCDC + PCDC</li>
<li>PHID + PHID</li>
</ol>
<h1><a class="anchor" id="r-usb_composite-configuration"></a>
How to Configuration</h1>
<p>The following shows FSP configuration procedure for USB composite device.</p>
<ul>
<li>Select [New Stack]-&gt;[USB]-&gt;[USB Composite]</li>
</ul>
<div class="image">
<img src="r_usb_composite1.png" alt="r_usb_composite1.png"/>
<div class="caption">
Select USB Composite</div></div>
<ul>
<li>The following is displayed when selecting [USB Composite].</li>
</ul>
<div class="image">
<img src="r_usb_composite2.png" alt="r_usb_composite2.png"/>
<div class="caption">
USB Composite Stack</div></div>
<ul>
<li>Select the supported 2 device classes as follows.</li>
</ul>
<div class="image">
<img src="r_usb_composite3.png" alt="r_usb_composite3.png"/>
<div class="caption">
Select Device Classes</div></div>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>Be sure to select "USB PCDC driver on r_usb_pcdc" and "USB PCDC 2channel driver on r_usb_pcdc" when configurating for "PCDC + PCDC".</li>
<li>Be sure to select "USB PHID driver on r_usb_phid" and "USB PHID 2channel driver on r_usb_phid" when configurating for "PHID + PHID".</li>
</ol>
</dd></dl>
<p><br />
</p><ul>
<li>Select the supported 2 device classes as follows. The following is displayed when selecting 2 device classes.</li>
</ul>
<div class="image">
<img src="r_usb_composite4.png" alt="r_usb_composite4.png"/>
<div class="caption">
Delete USB Basic Instance</div></div>
 <dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>Delete the "g_basic1" instance manually since this instance is not used in composite device. (Refer to the blue frame in the above figure.)</li>
<li>The error is output when selecting the following device classes.<ol type="a">
<li>PMSC + PMSC</li>
</ol>
</li>
</ol>
</dd></dl>
<div class="image">
<img src="r_usb_composite5.png" alt="r_usb_composite5.png"/>
<div class="caption">
Device Class Selection Error</div></div>
<h2><a class="anchor" id="r-usb_composite-limitations"></a>
Limitations</h2>
<p>1.The following composite device is not suppored when using RA2A1(MCU).</p>
<ol type="1">
<li>PMSC + PCDC</li>
<li>PCDC + PCDC</li>
</ol>
<p>2.If you use PMSC, make sure to use usb_basic module with PMSC. There is a risk that the information on the PMSC storage media cannot be registered normally in the "USB Callback Context".</p>
<h2><a class="anchor" id="r-usb_composite-notes"></a>
Notes</h2>
<p>Please determine by the member "pipe" in "usb_event_info" structure when getting PCDC channel number which the write event is completed in PCDC + PCDC. <br />
Don't refer to the member "type" in "usb_event_info" structure.</p>
<h1><a class="anchor" id="r-usb_compoiste-descriptor"></a>
Descriptor</h1>
<p>Templates for composite device descriptors can be found in ra/fsp/src/r_usb_composite folder. Also, please be sure to use your vendor ID.</p>
<ol type="1">
<li>r_usb_pcdc_pmsc_descriptor.c.template (for PCDC + PMSC)</li>
<li>r_usb_pcdc_phid_descriptor.c.template (for PCDC + PHID)</li>
<li>r_usb_phid_pmsc_descriptor.c.template (for PHID + PMSC)</li>
<li>r_usb_pcdc_pcdc_descriptor.c.template (for PCDC + PCDC)</li>
<li>r_usb_phid_phid_descriptor.c.template (for PHID + PHID)</li>
</ol>
<h1><a class="anchor" id="r-usb_composite-examples"></a>
Examples</h1>
<h2>USB COMPOSITE Example</h2>
<ul>
<li>PCDC + PHID</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> main_task (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"><span class="preprocessor">  #if (BSP_CFG_RTOS == 2)</span></div><div class="line">    usb_event_info_t * p_mess;</div><div class="line"><span class="preprocessor">  #endif</span></div><div class="line">    usb_event_info_t usb_event;</div><div class="line">    <a class="code" href="group___u_s_b___a_p_i.html#ga56bea25fbffdbda134044c49d40d5e40">usb_status_t</a>     event;</div><div class="line">    uint8_t        * p_idle_value;</div><div class="line">    uint8_t          sw_data;</div><div class="line">    usb_info_t       info;</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>        ret_code = FSP_SUCCESS;</div><div class="line">    uint8_t          send_data[16] BSP_ALIGN_VARIABLE(4);</div><div class="line">    uint8_t          req_comp_flag = 0;</div><div class="line">    uint8_t          count         = 0;</div><div class="line"></div><div class="line">    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#ad92d0a1d797e8e806082b4fb6cf65f03">open</a>(&amp;g_basic0_ctrl, &amp;g_basic0_cfg);</div><div class="line"></div><div class="line">    set_key_data(g_buf_phid);</div><div class="line"></div><div class="line">    <span class="comment">/* Loop back between PC(TerminalSoft) and USB MCU */</span></div><div class="line">    <span class="keywordflow">while</span> (1)</div><div class="line">    {</div><div class="line"><span class="preprocessor">  #if (BSP_CFG_RTOS == 2)</span></div><div class="line">        USB_APL_RCV_MSG(USB_APL_MBX, (usb_msg_t **) &amp;p_mess);</div><div class="line">        usb_event = *p_mess;</div><div class="line">        <span class="keyword">event</span>     = usb_event.event;</div><div class="line"><span class="preprocessor">  #else                                </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line">        <a class="code" href="group___u_s_b.html#gaf882576a8f79312c27fa700d3fb94951">R_USB_EventGet</a>(&amp;usb_event, &amp;event);</div><div class="line"><span class="preprocessor">  #endif </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line">        <span class="keywordflow">switch</span> (event)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ab5c3bd23fe62533150eef3a4e8c8d13c">USB_STATUS_CONFIGURED</a>:</div><div class="line">            {</div><div class="line">                g_status = NO_WRITING;</div><div class="line">                g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a1f8293d27b1dee87d1e925800c70edb3">read</a>(&amp;g_basic0_ctrl, g_buf, DATA_LEN, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ad44448290b4f36868a09b48e4588b29d">USB_STATUS_WRITE_COMPLETE</a>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (usb_event.type == <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>)</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a1f8293d27b1dee87d1e925800c70edb3">read</a>(&amp;g_basic0_ctrl, g_buf, DATA_LEN, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (usb_event.type == <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2abf75ec21c7f480bc52e8f9b68701ef17">USB_CLASS_PHID</a>)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (DATA_WRITING == g_status)</div><div class="line">                    {</div><div class="line">                        g_status = ZERO_WRITING;</div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a6eb4c329c32333e7475202b7f5825bce">write</a>(&amp;g_basic0_ctrl, (uint8_t *) g_zero_data, DATA_LEN_PHID, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2abf75ec21c7f480bc52e8f9b68701ef17">USB_CLASS_PHID</a>); <span class="comment">/* Sending the zero data (8 bytes) */</span></div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (g_status == ZERO_WRITING)</div><div class="line">                    {</div><div class="line">                        g_status = NO_WRITING;</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a63dd4552584256ef9d1a0d5da2159e9c">USB_STATUS_READ_COMPLETE</a>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (usb_event.type == <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>)</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a6eb4c329c32333e7475202b7f5825bce">write</a>(&amp;g_basic0_ctrl, g_buf, usb_event.data_size, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2a80c133e3ac3ddabc6aa656c3daf78c5e">USB_CLASS_PCDC</a>);</div><div class="line">                    <span class="keywordflow">if</span> (req_comp_flag == 1)</div><div class="line">                    {</div><div class="line">                        <span class="keywordflow">if</span> (g_status == NO_WRITING)</div><div class="line">                        {</div><div class="line">                            count++;</div><div class="line">                            g_status = DATA_WRITING;</div><div class="line">                            g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a6eb4c329c32333e7475202b7f5825bce">write</a>(&amp;g_basic0_ctrl, g_buf_phid, DATA_LEN_PHID, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2abf75ec21c7f480bc52e8f9b68701ef17">USB_CLASS_PHID</a>);</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a8b49ebc4d15054963bdbe8d843a2cf5a">USB_STATUS_REQUEST</a>:   <span class="comment">/* Receive Class Request */</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___p_c_d_c___a_p_i.html#ga9e76ac14dae5e5e44b5df6e8cbee6bd0">USB_PCDC_SET_LINE_CODING</a> == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___u_s_b.html#ga1293995ba77495705db3a3adf703b7f1">R_USB_PeriControlDataGet</a>(&amp;g_basic0_ctrl, (uint8_t *) &amp;g_line_coding, LINE_CODING_LENGTH);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___p_c_d_c___a_p_i.html#ga3e7ae95dcfc42bd8912fe18339893d82">USB_PCDC_GET_LINE_CODING</a> == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <a class="code" href="group___u_s_b.html#ga3fb9080601ee1041e35073e0538a21b0">R_USB_PeriControlDataSet</a>(&amp;g_basic0_ctrl, (uint8_t *) &amp;g_line_coding, LINE_CODING_LENGTH);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_SET_REPORT == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a1f8293d27b1dee87d1e925800c70edb3">read</a>(&amp;g_basic0_ctrl, (uint8_t *) &amp;g_numlock, 2, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2abf75ec21c7f480bc52e8f9b68701ef17">USB_CLASS_PHID</a>); <span class="comment">/* Get the NumLock data (NumLock data is not used) */</span></div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___a_p_i.html#gab643fa62dbe13073d08006c516b87f9a">USB_GET_DESCRIPTOR</a> == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (USB_GET_REPORT_DESCRIPTOR == usb_event.setup.request_value)</div><div class="line">                    {</div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#ada9e58c96ca03bf9140ba2db36a4214c">periControlDataSet</a>(&amp;g_basic0_ctrl,</div><div class="line">                                                        (uint8_t *) g_apl_report,</div><div class="line">                                                        USB_RECEIVE_REPORT_DESCRIPTOR);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_GET_HID_DESCRIPTOR == usb_event.setup.request_value)</div><div class="line">                    {</div><div class="line">                        <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; USB_RECEIVE_HID_DESCRIPTOR; i++)</div><div class="line">                        {</div><div class="line">                            send_data[i] = g_apl_configuration[84 + i];</div><div class="line">                        }</div><div class="line"></div><div class="line">                        <span class="comment">/* Configuration Descriptor address set. */</span></div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#ada9e58c96ca03bf9140ba2db36a4214c">periControlDataSet</a>(&amp;g_basic0_ctrl, send_data, USB_RECEIVE_HID_DESCRIPTOR);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span></div><div class="line">                    {</div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a29903dba1e2952e264159322340db640">periControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a5033c1aadc5c373ca8f8add7a27850d2">USB_SETUP_STATUS_STALL</a>);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_SET_IDLE == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <span class="comment">/* Get SetIdle value */</span></div><div class="line">                    p_idle_value = (uint8_t *) &amp;usb_event.setup.request_value;</div><div class="line">                    g_idle       = p_idle_value[1];</div><div class="line"></div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a29903dba1e2952e264159322340db640">periControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a20a1e7b4a77141981d824649cab7554b">USB_SETUP_STATUS_ACK</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_GET_IDLE == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#ada9e58c96ca03bf9140ba2db36a4214c">periControlDataSet</a>(&amp;g_basic0_ctrl, &amp;g_idle, 1);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_SET_PROTOCOL == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a29903dba1e2952e264159322340db640">periControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a20a1e7b4a77141981d824649cab7554b">USB_SETUP_STATUS_ACK</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_GET_PROTOCOL == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a29903dba1e2952e264159322340db640">periControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a5033c1aadc5c373ca8f8add7a27850d2">USB_SETUP_STATUS_STALL</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a29903dba1e2952e264159322340db640">periControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a5033c1aadc5c373ca8f8add7a27850d2">USB_SETUP_STATUS_STALL</a>);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a24e9ad4653245663e5e89bda173141fd">USB_STATUS_REQUEST_COMPLETE</a>: <span class="comment">/* Complete Class Request */</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (USB_SET_IDLE == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    p_idle_value = (uint8_t *) &amp;usb_event.setup.request_value;</div><div class="line"></div><div class="line">                    g_idle = p_idle_value[1];</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_SET_PROTOCOL == (usb_event.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    <span class="comment">/* None */</span></div><div class="line">                    <span class="comment">/* g_protocol = event_info.setup.value; */</span></div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    req_comp_flag = 1;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40adb879552af43dda95b70261eaa810777">USB_STATUS_SUSPEND</a>:</div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ae9bcf94bdb90960ca692b1dfecb98e78">USB_STATUS_DETACH</a>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}                                      <span class="comment">/* End of function usb_main() */</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> set_key_data (uint8_t * p_buf)</div><div class="line">{</div><div class="line">    <span class="keyword">static</span> uint8_t key_data;</div><div class="line"></div><div class="line">    key_data = KBD_CODE_A;</div><div class="line"></div><div class="line">    *(p_buf + 2) = key_data;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">  #if (BSP_CFG_RTOS == 2)</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_apl_rec_msg</span></div><div class="line"><span class="comment"> * Description     : Receive a message to the specified id (mailbox).</span></div><div class="line"><span class="comment"> * Argument        : uint8_t id        : ID number (mailbox).</span></div><div class="line"><span class="comment"> *               : usb_msg_t** mess  : Message pointer</span></div><div class="line"><span class="comment"> *               : usb_tm_t tm       : Timeout Value</span></div><div class="line"><span class="comment"> * Return          : uint16_t          : USB_OK / USB_ERROR</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line">usb_er_t usb_apl_rec_msg (uint8_t <span class="keywordtype">id</span>, usb_msg_t ** mess, usb_tm_t tm)</div><div class="line">{</div><div class="line">    BaseType_t    err;</div><div class="line">    QueueHandle_t handle;</div><div class="line">    usb_er_t      result;</div><div class="line"></div><div class="line">    (void) tm;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (NULL == mess)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> USB_APL_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    handle = (*(g_apl_mbx_table[id]));</div><div class="line">    *mess  = NULL;</div><div class="line"></div><div class="line">    err = xQueueReceive(handle, (<span class="keywordtype">void</span> *) mess, (portMAX_DELAY));</div><div class="line">    <span class="keywordflow">if</span> ((pdTRUE == err) &amp;&amp; (NULL != (*mess)))</div><div class="line">    {</div><div class="line">        result = USB_APL_OK;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        result = USB_APL_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> result;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function usb_apl_rec_msg</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_apl_snd_msg</span></div><div class="line"><span class="comment"> * Description     : Send a message to the specified id (mailbox).</span></div><div class="line"><span class="comment"> * Argument        : uint8_t id        : ID number (mailbox).</span></div><div class="line"><span class="comment"> *               : usb_msg_t* mess   : Message pointer</span></div><div class="line"><span class="comment"> * Return          : usb_er_t          : USB_OK / USB_ERROR</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line">usb_er_t usb_apl_snd_msg (uint8_t <span class="keywordtype">id</span>, usb_msg_t * mess)</div><div class="line">{</div><div class="line">    BaseType_t    err;</div><div class="line">    QueueHandle_t handle;</div><div class="line">    usb_er_t      result;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (NULL == mess)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> USB_APL_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    handle = (*(g_apl_mbx_table[id]));</div><div class="line"></div><div class="line">    err = xQueueSend(handle, (<span class="keyword">const</span> <span class="keywordtype">void</span> *) &amp;mess, (TickType_t) (0));</div><div class="line">    <span class="keywordflow">if</span> (pdTRUE == err)</div><div class="line">    {</div><div class="line">        result = USB_APL_OK;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        result = USB_APL_ERROR;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> result;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function usb_apl_snd_msg</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="preprocessor">  #endif                               </span><span class="comment">/* #if (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line"></div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
        <li class="footer">FSP Release v4.1.0 User's Manual Copyright Â© (2022) Renesas Electronics Corporation. All Rights Reserved.</li>
  </ul>
</div>
</body>
</html>
