<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>RA Flexible Software Package Documentation: USB Peripheral Vendor class (r_usb_pvnd)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <script type="text/javascript" src="search/lunr.js"></script>
    <link href="search/lunrsearch.css" rel="stylesheet" type="text/css">
    <script src="search/lunr_index.js"></script>
    <script src="search/lunrclient.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="fsp_customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
    $(document).ready(function() {
        $("tr.tree_lvl_1").nextUntil("tr.tree_lvl_1,tr.tree_none").hide();
		$("tr.tree_lvl_1").data("expanded","0");
		$("tr.tree_lvl_2").data("expanded","0");
		$("tr.tree_lvl_3").data("expanded","0");
		$("tr.tree_lvl_4").data("expanded","0");
		$("tr.tree_lvl_5").data("expanded","0");
        $("tr.tree_lvl_1").click(function() {
		    var lvl_1_is_open = $(this).data("expanded");
		    if (lvl_1_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2, tr.tree_lvl_1_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2,tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2,tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_2").click(function() {
		    var lvl_2_is_open = $(this).data("expanded");
		    if (lvl_2_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3, tr.tree_lvl_2_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
				$(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_3").click(function() {
		    var lvl_3_is_open = $(this).data("expanded");
		    if (lvl_3_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_3_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_4").click(function() {
		    var lvl_4_is_open = $(this).data("expanded");
		    if (lvl_4_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5, tr.tree_lvl_4_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_5").click(function() {
		    var lvl_5_is_open = $(this).data("expanded");
		    if (lvl_5_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_5,tr.tree_lvl_4,tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5_item").show();
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_5,tr.tree_lvl_4_item,tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
     });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_scaled.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">RA Flexible Software Package Documentation
   &#160;<span id="projectnumber">Release v6.3.0</span>
   </div>
  </td>
   <td>        <br /><div id="MSearchBox" class="MSearchBoxInactive">

    <form id="lunrSearchForm" name="lunrSearchForm">
      <span class="left" >
          <img id="MSearchSelect" src="search/mag_sel.png"
               alt=""/>
         <input class="search-input" id="MSearchField" name="q" placeholder="Search" type="text">
      </span>
      <span class="right">
          &nbsp;
      </span>
        <!--<input type="submit" value="Search">-->
    </form>
</div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___u_s_b___p_v_n_d.html','');});
</script>

<script src="search/mark.min.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    var options = {         // allows highlighting across element boundaries.
      "acrossElements": true
    };
    var bodyText = $("div.contents").text(); // try contents instead of body.
    // If using body: Problem may be that text inside <script> tags is included in .text() - but not in cheerio?
    // If using div.contents - works
    var fullURL = $(location).attr('href');
    var splitURL = fullURL.split("?");  // Get param string: content after "?" in URL
    if (splitURL.length > 1) {          // If any content after "?"
      var paramStr = splitURL[1];
      var params = paramStr.split("&"); // Split params on "&"
      for (i = 0; i < params.length; i++) {
        var paramPair = params[i].split("=");
        if (paramPair[0] == "pos") {     // If any param starts "pos", get the content after "="
          posStr = paramPair[1];
          var splitPos = posStr.split(",");
          var termArray = [];
        // termArray will have the search terms
            for (i=0; i < splitPos.length; i += 2) {
            start = splitPos[i];
            len = splitPos[i+1]; // Needs error detection! Vulnerable if non-even # of pos entries
            term = bodyText.substr(start,len);
            if (termArray.includes(term) == false) {     // List all unique terms
                termArray.push(bodyText.substr(start,len));
            }
          }
    //      console.log(termArray);
          var context = document.querySelector("div.contents");
          var instance = new Mark(context);
          for(i=0;i<termArray.length; i+=1) {
            instance.mark(termArray[i],options);  // Use Mark.js to mark all terms in termArray
            }
          var firstMark = document.querySelector("mark");
          firstMark.scrollIntoView(true);
          //      console.log($("mark").first().text()); // Trying to scroll to first Mark element.
        }
            }
    }
  });
</script>

<link href="fsp_customdoxygen.css" rel="stylesheet" type="text/css" />

<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


<!-- Lunr search results -->
<div id="lunrResultBox" style="
        position: fixed;
        border: 1px solid black;
        background-color: WhiteSmoke;
        padding: 10px;
        width: 500px;
        height: 500px;
        top: 30;
        right: 0;
        overflow: auto;
        display: none">
    <button onclick="closeLunrResults()" style="float: right;">X</button>
    <div class="resultCount" id="resultCount"></div>
    <div id="searchResults"></div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">USB Peripheral Vendor class (r_usb_pvnd)<div class="ingroups"><a class="el" href="group___r_e_n_e_s_a_s___m_o_d_u_l_e_s.html">Modules</a> &raquo; <a class="el" href="group___r_e_n_e_s_a_s___c_o_n_n_e_c_t_i_v_i_t_y___m_o_d_u_l_e_s.html">Connectivity</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p><a class="anchor" id="functionss"></a></p><h2 class="groupheader">Functions</h2>
<p>Refer to <a class="el" href="group___u_s_b.html">USB (r_usb_basic)</a> for the common API (r_usb_basic) to be called from the application.</p>
<h1><a class="anchor" id="r-usb_pvendor-overview"></a>
Overview</h1>
<p>USB Peripheral Vendor class works by combining r_usb_basic module.</p>
<h1><a class="anchor" id="r-usb_pvendor-configuration"></a>
How to Configuration</h1>
<p>The following shows FSP configuration procedure for USB Peripheral Vendor class.</p>
<ul>
<li>Select [New Stack]-&gt;[Middleware]-&gt;[USB]-&gt;[USB Peripheral Vendor class driver on r_usb_pvnd].</li>
</ul>
<div class="image">
<img src="r_usb_pvendor1.png" alt="r_usb_pvendor1.png"/>
<div class="caption">
Select USB Peripheral Vendor Class</div></div>
<ul>
<li>The following is displayed when selecting [USB Peripheral Vendor class driver on r_usb_pvnd]. The user does not specify USB pipe number in Vendor class.</li>
</ul>
<div class="image">
<img src="r_usb_pvendor2.png" alt="r_usb_pvendor2.png"/>
<div class="caption">
USB Peripheral Vendor Class Stack</div></div>
<h1><a class="anchor" id="r-usb_pvendor-api"></a>
API</h1>
<p>Use the following APIs in Peripheral Vendor class application program.</p>
<ul>
<li>For Data Transfer <br />
Use the following APIs for data transfer for Bulk transfer or Interrupt transfer. <br />
<ol type="1">
<li><a class="el" href="group___u_s_b.html#ga5bee47c1fb4dfb12eba430226122bd57" title="Requests a data read (Bulk/Interrupt transfer) via the pipe specified in the argument. ">R_USB_PipeRead()</a></li>
<li><a class="el" href="group___u_s_b.html#ga4f800b5c189c92d58d23972142214d22" title="Requests a data write (Bulk/Interrupt transfer). ">R_USB_PipeWrite()</a></li>
<li><a class="el" href="group___u_s_b.html#ga5311e5c477a72f6ac531516e49467d16" title="Terminates a data read/write operation. ">R_USB_PipeStop()</a> <br />
</li>
</ol>
</li>
<li>For Control Transfer <br />
Use the following API for the class request processing. <br />
<ol type="1">
<li><a class="el" href="group___u_s_b.html#ga1293995ba77495705db3a3adf703b7f1" title="Receives data sent by control transfer. ">R_USB_PeriControlDataGet()</a></li>
<li><a class="el" href="group___u_s_b.html#ga3fb9080601ee1041e35073e0538a21b0" title="Performs transfer processing for control transfer. ">R_USB_PeriControlDataSet()</a></li>
<li><a class="el" href="group___u_s_b.html#gaf8976d11f8be52c3f9422563188d6ab9" title="Set the response to the setup packet. ">R_USB_PeriControlStatusSet()</a> <br />
</li>
</ol>
</li>
<li>For USB Pipe Information <br />
The USB driver allocates USB PIPE by analyzing the descriptor of USB device in Vendor class. Use the following APIs to get the allocated USB pipe information. <br />
<ol type="1">
<li><a class="el" href="group___u_s_b.html#ga112c7de01280de80c529ec61789c9cc0" title="Gets the selected pipe number (number of the pipe that has completed initialization) via bit map info...">R_USB_UsedPipesGet()</a></li>
<li><a class="el" href="group___u_s_b.html#ga08f0810f299c825fae9a9f8ada2f9dbf" title="Gets the following pipe information regarding the pipe specified in the argument (p_ctrl) member (pip...">R_USB_PipeInfoGet()</a></li>
</ol>
</li>
</ul>
<h1><a class="anchor" id="r-usb_pvendor-pipe_allocation"></a>
USB PIPE Allocation</h1>
<p>The USB driver allocates USB PIPE by analyzing the descriptor of USB device in Vendor class. <br />
The USB PIPE related to the Endpoint Descriptor are allocated in order from USB PIPE1 according to the description order of the Endpoint Descriptor. <br />
FSP driver pipe configuration behaviors for the PVND Class, when it is used with the Composite PCDC+PVND Class is mentioned below.</p><ul>
<li>In Composite PCDC+PVND class, PCDC class interface is placed next to the PVND class interface in descriptor file. PVND Class Pipe configurations are as follows. <br />
<ul>
<li>FSP driver(PVND) allocates Pipes in order from USB PIPE1 according to the order of the endpoint in descriptor(Bulk transfer).</li>
<li>FSP driver(PVND) allocates Pipes in order(decremental order) from USB PIPE9 according to the order of the endpoint in descriptor(Interrupt transfer).</li>
<li>PCDC and PVND must always use different USB PIPEs.</li>
</ul>
</li>
</ul>
<p><br />
 For example: <br />
</p><ul>
<li>In the Composite PCDC+PVND class, if there are 3 number of bulk transfers endpoints and one Interrupt transfer endpoint in descriptor file for PVND class and for this configuration FSP driver configures USB PIPE1, USB PIPE2 and USB PIPE3 for bulk data transfer and USB PIPE9 for Interrupt data transfer.</li>
<li>Since hardware support total 5 number of Bulk transfer pipe configuration. So, in this scenario, for the PCDC class we have configurable USB PCDC Stack property to select available Pipes(USB PIPE 4 and USB PIPE 5 for Bulk and USB PIPE 6 for Interrupt transfer) from USB PCDC Stack configurator.</li>
</ul>
<h1><a class="anchor" id="r_usb_pvendor-limitations"></a>
Limitaions</h1>
<ul>
<li>Please ignore the suspend or resume event occurs when attaching or detaching the USB cable.</li>
</ul>
<h1><a class="anchor" id="r-usb_pvendor-descriptor"></a>
Descriptor</h1>
<p>Template for Vendor class descriptor can be found in ra/fsp/src/r_usb_pvnd folder. Also, please be sure to use your vendor ID.</p>
<h1><a class="anchor" id="r-usb_pvendor-examples"></a>
Examples</h1>
<p>This application program processes the following after the enumeration completes with USB device.</p><ol type="1">
<li>Getting USB Pipe Infomattion</li>
<li>Vendor Class Request Processing</li>
<li>Loopback processing of bulk transfer and interrupt transfer. <div class="fragment"><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Macro definitions</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"></div><div class="line"><span class="comment">/* for Vendor Class Request */</span></div><div class="line"><span class="preprocessor">#define USB_SET_VENDOR_NO_DATA    (0x0000U)</span></div><div class="line"><span class="preprocessor">#define USB_SET_VENDOR            (0x0100U)</span></div><div class="line"><span class="preprocessor">#define USB_GET_VENDOR            (0x0200U)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)                </span><span class="comment">/* FreeRTOS */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_apl_callback</span></div><div class="line"><span class="comment"> * Description     : Callback function for Application program</span></div><div class="line"><span class="comment"> * Arguments       : usb_event_info_t *p_api_event    : Control structure for USB API.</span></div><div class="line"><span class="comment"> *               : usb_hdl_t        cur_task        : Task Handle</span></div><div class="line"><span class="comment"> *               : uint8_t          usb_state       : USB_ON(USB_STATUS_REQUEST) / USB_OFF</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> usb_apl_callback (usb_event_info_t * p_api_event, usb_hdl_t cur_task, <a class="code" href="group___u_s_b___a_p_i.html#ga647c9ea8cc8c82a26dcec32f7749c73d">usb_onoff_t</a> usb_state)</div><div class="line">{</div><div class="line">    (void) usb_state;</div><div class="line">    (void) cur_task;</div><div class="line"></div><div class="line">    xQueueSend(g_apl_mbx_hdl, (<span class="keyword">const</span> <span class="keywordtype">void</span> *) &amp;p_api_event, (TickType_t) (0))</div><div class="line">}                                      <span class="comment">/* End of function usb_apl_callback() */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : usb_pvnd_example</span></div><div class="line"><span class="comment"> * Description     : Peripheral Vendor Class application main process</span></div><div class="line"><span class="comment"> * Arguments       : none</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> usb_pvnd_example (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)                </span><span class="comment">/* FreeRTOS */</span><span class="preprocessor"></span></div><div class="line">    usb_event_info_t * p_mess;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <a class="code" href="group___u_s_b___a_p_i.html#ga56bea25fbffdbda134044c49d40d5e40">usb_status_t</a>     event;</div><div class="line">    usb_event_info_t event_info;</div><div class="line">    uint8_t          bulk_out_pipe = 0; <span class="comment">/* Bulk Out Pipe        */</span></div><div class="line">    uint8_t          bulk_in_pipe  = 0; <span class="comment">/* Bulk In  Pipe        */</span></div><div class="line">    uint8_t          int_out_pipe  = 0; <span class="comment">/* Interrupt Out Pipe   */</span></div><div class="line">    uint8_t          int_in_pipe   = 0; <span class="comment">/* Interrupt In  Pipe   */</span></div><div class="line"></div><div class="line">    uint16_t   buf_type       = 0;</div><div class="line">    uint8_t    pipe           = 0;</div><div class="line">    uint8_t    is_zlp[2]      = {0, 0};</div><div class="line">    uint32_t   request_length = 0;</div><div class="line">    uint16_t   used_pipe      = 0;</div><div class="line">    usb_pipe_t pipe_info;</div><div class="line"></div><div class="line">    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a71c50854a60a443915487767eac07b01">open</a>(&amp;g_basic0_ctrl, &amp;g_basic0_cfg);</div><div class="line"></div><div class="line">    memset(&amp;event_info, 0, <span class="keyword">sizeof</span>(usb_event_info_t));</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (1)</div><div class="line">    {</div><div class="line"><span class="preprocessor">#if (BSP_CFG_RTOS == 2)                </span><span class="comment">/* FreeRTOS */</span><span class="preprocessor"></span></div><div class="line">        xQueueReceive(g_apl_mbx_hdl, (<span class="keywordtype">void</span> *) &amp;p_mess, portMAX_DELAY);</div><div class="line"></div><div class="line">        event_info = *p_mess;</div><div class="line">        <span class="keyword">event</span>      = event_info.event;</div><div class="line"><span class="preprocessor">#else                                  </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line">        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#ab9275462e1796a4c109af0dbf7424b4c">eventGet</a>(&amp;event_info, &amp;event);</div><div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* (BSP_CFG_RTOS == 2) */</span><span class="preprocessor"></span></div><div class="line">        <span class="keywordflow">switch</span> (event)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ab5c3bd23fe62533150eef3a4e8c8d13c">USB_STATUS_CONFIGURED</a>:</div><div class="line">            {</div><div class="line">                buffer_init();</div><div class="line"></div><div class="line">                is_zlp[0] = 0;</div><div class="line">                is_zlp[1] = 0;</div><div class="line"></div><div class="line">                g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a656774b2567e8e2fa2a4a8232b4d6f83">usedPipesGet</a>(&amp;g_basic0_ctrl, &amp;used_pipe, <a class="code" href="group___u_s_b___a_p_i.html#ggab1dc4a2240edf1a50cca3945f31dc9f2af29ff035832b2ed9568dd3e674052265">USB_CLASS_PVND</a>);</div><div class="line">                <span class="keywordflow">for</span> (pipe = START_PIPE; pipe &lt; END_PIPE; pipe++)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (0 != (used_pipe &amp; (1 &lt;&lt; pipe)))</div><div class="line">                    {</div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a070371926888f0c1ddd76e6439f21e7e">pipeInfoGet</a>(&amp;g_basic0_ctrl, &amp;pipe_info, pipe);</div><div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___a_p_i.html#gaae8411e95f26738326bc25a0161dde99">USB_EP_DIR_IN</a> != (pipe_info.endpoint &amp; <a class="code" href="group___u_s_b___a_p_i.html#gaae8411e95f26738326bc25a0161dde99">USB_EP_DIR_IN</a>))</div><div class="line">                        {</div><div class="line">                            <span class="comment">/* Out Transfer */</span></div><div class="line">                            <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___a_p_i.html#gga751140ad5635fcb0934d0ca466e795c0a2463a1944749f4335246954769ec8e36">USB_TRANSFER_TYPE_BULK</a> == pipe_info.transfer_type)</div><div class="line">                            {</div><div class="line">                                buf_type      = BUF_BULK;</div><div class="line">                                bulk_out_pipe = pipe;</div><div class="line">                            }</div><div class="line">                            <span class="keywordflow">else</span></div><div class="line">                            {</div><div class="line">                                buf_type     = BUF_INT;</div><div class="line">                                int_out_pipe = pipe;</div><div class="line">                            }</div><div class="line">                        }</div><div class="line">                        <span class="keywordflow">else</span></div><div class="line">                        {</div><div class="line">                            <span class="comment">/* In Transfer */</span></div><div class="line">                            <span class="keywordflow">if</span> (<a class="code" href="group___u_s_b___a_p_i.html#gga751140ad5635fcb0934d0ca466e795c0a2463a1944749f4335246954769ec8e36">USB_TRANSFER_TYPE_BULK</a> == pipe_info.transfer_type)</div><div class="line">                            {</div><div class="line">                                buf_type     = BUF_BULK;</div><div class="line">                                bulk_in_pipe = pipe;</div><div class="line">                            }</div><div class="line">                            <span class="keywordflow">else</span></div><div class="line">                            {</div><div class="line">                                buf_type    = BUF_INT;</div><div class="line">                                int_in_pipe = pipe;</div><div class="line">                            }</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a63dd4552584256ef9d1a0d5da2159e9c">USB_STATUS_READ_COMPLETE</a>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (FSP_ERR_USB_FAILED != event_info.status)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (bulk_out_pipe == event_info.pipe)</div><div class="line">                    {</div><div class="line">                        buf_type = BUF_BULK;</div><div class="line">                        pipe     = bulk_in_pipe;</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (int_out_pipe == event_info.pipe)</div><div class="line">                    {</div><div class="line">                        buf_type = BUF_INT;</div><div class="line">                        pipe     = int_in_pipe;</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span></div><div class="line">                    {</div><div class="line">                        <span class="keywordflow">while</span> (1)</div><div class="line">                        {</div><div class="line">                            ;</div><div class="line">                        }</div><div class="line">                    }</div><div class="line"></div><div class="line">                    buffer_check(buf_type, event_info.data_size);</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a594f678c08089ed13149bd00612e745f">pipeWrite</a>(&amp;g_basic0_ctrl, &amp;g_buf[buf_type][0], event_info.data_size, pipe);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ad44448290b4f36868a09b48e4588b29d">USB_STATUS_WRITE_COMPLETE</a>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (FSP_SUCCESS == event_info.status)</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">if</span> (bulk_in_pipe == event_info.pipe)</div><div class="line">                    {</div><div class="line">                        buf_type = BUF_BULK;</div><div class="line">                        <span class="keywordflow">if</span> (1 == is_zlp[buf_type])</div><div class="line">                        {</div><div class="line">                            pipe = bulk_out_pipe;</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (int_in_pipe == event_info.pipe)</div><div class="line">                    {</div><div class="line">                        buf_type = BUF_INT;</div><div class="line">                        <span class="keywordflow">if</span> (1 == is_zlp[buf_type])</div><div class="line">                        {</div><div class="line">                            pipe = int_out_pipe;</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span></div><div class="line">                    {</div><div class="line">                        <span class="comment">/* Nothing */</span></div><div class="line">                    }</div><div class="line"></div><div class="line">                    <span class="keywordflow">if</span> (1 == is_zlp[buf_type])</div><div class="line">                    {</div><div class="line">                        is_zlp[buf_type] = 0;</div><div class="line"></div><div class="line">                        buffer_clear(buf_type);</div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#ad458a66397fa213c1a6f5fba9018dcd4">pipeRead</a>(&amp;g_basic0_ctrl, &amp;g_buf[buf_type][0], BUF_SIZE, pipe);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">else</span></div><div class="line">                    {</div><div class="line">                        is_zlp[buf_type] = 1;</div><div class="line"></div><div class="line">                        g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a594f678c08089ed13149bd00612e745f">pipeWrite</a>(&amp;g_basic0_ctrl, 0, 0, event_info.pipe); <span class="comment">/* Send ZLP */</span></div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a8b49ebc4d15054963bdbe8d843a2cf5a">USB_STATUS_REQUEST</a>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (USB_SET_VENDOR_NO_DATA == (event_info.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#a2bf6b2b55ae43aadcf7ed5970f27eb3c">periControlStatusSet</a>(&amp;g_basic0_ctrl, <a class="code" href="group___u_s_b___a_p_i.html#gga386cabe04206e06b3be8dbafc0bc3d86a20a1e7b4a77141981d824649cab7554b">USB_SETUP_STATUS_ACK</a>);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_SET_VENDOR == (event_info.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    request_length = event_info.setup.request_length;</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#afa3c12df088caabc41abfe9538df563a">periControlDataGet</a>(&amp;g_basic0_ctrl, &amp;g_request_buf[0], request_length);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (USB_GET_VENDOR == (event_info.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#adf500dc4e48aab1cce6ecd5d8ed37d87">periControlDataSet</a>(&amp;g_basic0_ctrl, &amp;g_request_buf[0], request_length);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    <span class="comment">/* Nothing */</span></div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40a24e9ad4653245663e5e89bda173141fd">USB_STATUS_REQUEST_COMPLETE</a>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (USB_GET_VENDOR == (event_info.setup.request_type &amp; <a class="code" href="group___u_s_b___a_p_i.html#ga3a6743f3e336fc05e70e59b05206f634">USB_BREQUEST</a>))</div><div class="line">                {</div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#ad458a66397fa213c1a6f5fba9018dcd4">pipeRead</a>(&amp;g_basic0_ctrl, &amp;g_buf[BUF_BULK][0], BUF_SIZE, bulk_out_pipe);</div><div class="line"></div><div class="line">                    g_usb_on_usb.<a class="code" href="group___u_s_b___a_p_i.html#ad458a66397fa213c1a6f5fba9018dcd4">pipeRead</a>(&amp;g_basic0_ctrl, &amp;g_buf[BUF_INT][0], BUF_SIZE, int_out_pipe);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <a class="code" href="group___u_s_b___a_p_i.html#gga56bea25fbffdbda134044c49d40d5e40ae9bcf94bdb90960ca692b1dfecb98e78">USB_STATUS_DETACH</a>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">            {</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}                                      <span class="comment">/* End of function usb_pvnd_example() */</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : buffer_init</span></div><div class="line"><span class="comment"> * Description     : buffer initialization</span></div><div class="line"><span class="comment"> * Arguments       : none</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> buffer_init (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    uint16_t i;</div><div class="line">    uint16_t j;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (j = 0; j &lt; 2; j++)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; BUF_SIZE; i++)</div><div class="line">        {</div><div class="line">            g_buf[j][i] = (uint8_t) i;</div><div class="line">        }</div><div class="line">    }</div><div class="line">}                                      <span class="comment">/* End of function buffer_init() */</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : buffer_check</span></div><div class="line"><span class="comment"> * Description     : buffer check</span></div><div class="line"><span class="comment"> * Arguments       : buf_type : buffer number</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> buffer_check (uint16_t buf_type, uint32_t size)</div><div class="line">{</div><div class="line">    uint16_t i;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; (uint16_t) size; i++)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> ((uint8_t) (i &amp; USB_VALUE_FF) != g_buf[buf_type][i])</div><div class="line">        {</div><div class="line">            <span class="keywordflow">while</span> (1)</div><div class="line">            {</div><div class="line">                ;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}                                      <span class="comment">/* End of function buffer_check() */</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * Function Name   : buffer_clear</span></div><div class="line"><span class="comment"> * Description     : buffer clear</span></div><div class="line"><span class="comment"> * Arguments       : buf_type : buffer number</span></div><div class="line"><span class="comment"> * Return value    : none</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> buffer_clear (uint16_t buf_type)</div><div class="line">{</div><div class="line">    uint16_t i;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; BUF_SIZE; i++)</div><div class="line">    {</div><div class="line">        g_buf[buf_type][i] = 0;</div><div class="line">    }</div><div class="line">}                                      <span class="comment">/* End of function buffer_clear() */</span></div><div class="line"></div><div class="line"><span class="comment">/******************************************************************************</span></div><div class="line"><span class="comment"> * End of function usb_mcu_init</span></div><div class="line"><span class="comment"> ******************************************************************************/</span></div><div class="line"></div></div><!-- fragment --></li>
</ol>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
        <li class="footer">FSP Release v6.3.0 User's Manual Copyright Â© (2025) Renesas Electronics Corporation. All Rights Reserved.</li>
  </ul>
</div>
</body>
</html>
