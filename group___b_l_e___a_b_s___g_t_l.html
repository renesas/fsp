<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>RA Flexible Software Package Documentation: GTL BLE Abstraction (rm_ble_abs_gtl)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <script type="text/javascript" src="search/lunr.js"></script>
    <link href="search/lunrsearch.css" rel="stylesheet" type="text/css">
    <script src="search/lunr_index.js"></script>
    <script src="search/lunrclient.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="fsp_customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
    $(document).ready(function() {
        $("tr.tree_lvl_1").nextUntil("tr.tree_lvl_1,tr.tree_none").hide();
		$("tr.tree_lvl_1").data("expanded","0");
		$("tr.tree_lvl_2").data("expanded","0");
		$("tr.tree_lvl_3").data("expanded","0");
		$("tr.tree_lvl_4").data("expanded","0");
		$("tr.tree_lvl_5").data("expanded","0");
        $("tr.tree_lvl_1").click(function() {
		    var lvl_1_is_open = $(this).data("expanded");
		    if (lvl_1_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2, tr.tree_lvl_1_item").show(); 
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2,tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed"); 
				$(this).nextUntil("tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_2,tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        }); 
		$("tr.tree_lvl_2").click(function() {
		    var lvl_2_is_open = $(this).data("expanded");
		    if (lvl_2_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3, tr.tree_lvl_2_item").show(); 
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();                
				$(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_3,tr.tree_lvl_4,tr.tree_lvl_5").data("expanded","0");
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_3").click(function() {
		    var lvl_3_is_open = $(this).data("expanded");
		    if (lvl_3_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_3_item").show(); 
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).nextUntil("tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_4, tr.tree_lvl_5").data("expanded","0");				
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        });
		$("tr.tree_lvl_4").click(function() {
		    var lvl_4_is_open = $(this).data("expanded");
		    if (lvl_4_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5, tr.tree_lvl_4_item").show(); 
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();
                $(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5").find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");	
				$(this).nextUntil("tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5").data("expanded","0");				
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        }); 
		$("tr.tree_lvl_5").click(function() {
		    var lvl_5_is_open = $(this).data("expanded");
		    if (lvl_5_is_open == "0") {
                $(this).nextUntil("tr.tree_lvl_5,tr.tree_lvl_4,tr.tree_lvl_3,tr.tree_lvl_2,tr.tree_lvl_1,tr.tree_none", "tr.tree_lvl_5_item").show(); 
                $(this).find("span").removeClass("chevron-collapsed").addClass("chevron-expanded");
				$(this).data("expanded","1");
			} else {
			    $(this).nextUntil("tr.tree_lvl_5,tr.tree_lvl_4_item,tr.tree_lvl_4,tr.tree_lvl_3_item,tr.tree_lvl_3,tr.tree_lvl_2_item,tr.tree_lvl_2,tr.tree_lvl_1_item,tr.tree_lvl_1,tr.tree_none").hide();                
				$(this).find("span").removeClass("chevron-expanded").addClass("chevron-collapsed");
				$(this).data("expanded","0");
			    }
        }); 
     }); 
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_scaled.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">RA Flexible Software Package Documentation
   &#160;<span id="projectnumber">Release v5.0.0</span>
   </div>
  </td>
   <td>        <br /><div id="MSearchBox" class="MSearchBoxInactive">
 
    <form id="lunrSearchForm" name="lunrSearchForm">
      <span class="left" >
          <img id="MSearchSelect" src="search/mag_sel.png"
               alt=""/>
         <input class="search-input" id="MSearchField" name="q" placeholder="Search" type="text"> 
      </span>
      <span class="right">
          &nbsp; 
      </span>
        <!--<input type="submit" value="Search">-->
    </form>
</div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___b_l_e___a_b_s___g_t_l.html','');});
</script>

<script src="search/mark.min.js"></script>
<script type="text/javascript">
  $(document).ready(function() { 
    var options = {         // allows highlighting across element boundaries.
      "acrossElements": true
    };
    var bodyText = $("div.contents").text(); // try contents instead of body. 
    // If using body: Problem may be that text inside <script> tags is included in .text() - but not in cheerio?
    // If using div.contents - works 
    var fullURL = $(location).attr('href');
    var splitURL = fullURL.split("?");  // Get param string: content after "?" in URL
    if (splitURL.length > 1) {          // If any content after "?"
      var paramStr = splitURL[1];
      var params = paramStr.split("&"); // Split params on "&"
      for (i = 0; i < params.length; i++) {
        var paramPair = params[i].split("=");
        if (paramPair[0] == "pos") {     // If any param starts "pos", get the content after "="
          posStr = paramPair[1];
          var splitPos = posStr.split(",");
          var termArray = [];
        // termArray will have the search terms
            for (i=0; i < splitPos.length; i += 2) {
            start = splitPos[i];
            len = splitPos[i+1]; // Needs error detection! Vulnerable if non-even # of pos entries
            term = bodyText.substr(start,len);
            if (termArray.includes(term) == false) {     // List all unique terms
                termArray.push(bodyText.substr(start,len)); 
            }
          } 
    //      console.log(termArray);
          var context = document.querySelector("div.contents");
          var instance = new Mark(context);
          for(i=0;i<termArray.length; i+=1) {
            instance.mark(termArray[i],options);  // Use Mark.js to mark all terms in termArray
            }    
          var firstMark = document.querySelector("mark");
          firstMark.scrollIntoView(true);
          //      console.log($("mark").first().text()); // Trying to scroll to first Mark element. 
        }
            }
    }
  });
</script>

<link href="fsp_customdoxygen.css" rel="stylesheet" type="text/css" />

<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


<!-- Lunr search results -->
<div id="lunrResultBox" style="
        position: fixed;
        border: 1px solid black;
        background-color: WhiteSmoke;  
        padding: 10px;
        width: 500px;
        height: 500px;
        top: 30;
        right: 0;
        overflow: auto;
        display: none">
    <button onclick="closeLunrResults()" style="float: right;">X</button>
    <div class="resultCount" id="resultCount"></div>
    <div id="searchResults"></div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">GTL BLE Abstraction (rm_ble_abs_gtl)<div class="ingroups"><a class="el" href="group___r_e_n_e_s_a_s___m_o_d_u_l_e_s.html">Modules</a> &raquo; <a class="el" href="group___r_e_n_e_s_a_s___n_e_t_w_o_r_k_i_n_g___m_o_d_u_l_e_s.html">Networking</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>Middleware for the Bluetooth peripheral on RA MCUs. This module implements the <a class="el" href="group___b_l_e___a_b_s___a_p_i.html">BLE ABS Interface</a>. </p>
<h1><a class="anchor" id="rm_ble_abs_gtl-overview"></a>
Overview</h1>
<p>This module provides BLE GAP functionality that complies with the Bluetooth Core Specification version 5.0 specified by the Bluetooth SIG. This module is configured via the <a href="https://www.renesas.com/qe-ble">QE for BLE</a>. QE for BLE provides standard and custom services defined by the user.</p>
<p>The module supports the Renesas Electronics DA14531 Bluetooth® Low Energy 5 Module. The rm_ble_abs_gtl driver interfaces with the DA14531 module over UART.</p>
<h2><a class="anchor" id="rm_ble_abs_gtl-features"></a>
Features</h2>
<p>The Bluetooth Low Energy Abstraction module with GTL supports the following features:</p><ul>
<li>Common functionality<ul>
<li>Open/Close the BLE protocol stack.</li>
</ul>
</li>
<li>The following GAP Role support<ul>
<li>Peripheral: The device that accepts a connection request from Central and establishes a connection.</li>
</ul>
</li>
<li>GAP functionality<ul>
<li>Initialize the Host stack.</li>
<li>Setting address.</li>
<li>Start/Stop Advertising.</li>
<li>Connect/Disconnect a link.<a class="anchor" id="um_ble_abs_checking_start_legacy_connection_gtl"></a></li>
</ul>
</li>
<li>GATT Common functionality<ul>
<li>Get MTU Size.</li>
</ul>
</li>
<li>GATT Server functionality<ul>
<li>Initialization of GATT Server.</li>
<li>Loading of Profile definition.</li>
<li>Notification of characteristics modification.</li>
<li>Read/Write of GATT Profile from host.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="rm_ble_abs_gtl-configuration"></a>
Configuration</h1>
<h2><a class="anchor" id="rm_ble_abs_gtl-pin-configuration"></a>
Pin Configuration</h2>
<p>Pins used by the BLE driver to control the DA14531 module:</p><ul>
<li>Reset Pin : Active low reset line for DA14531 module</li>
<li><a class="el" href="group___u_a_r_t___a_p_i.html">UART Interface</a> : RX/TX Pins</li>
</ul>
<h1><a class="anchor" id="rm_ble_abs_gtl-usage_notes"></a>
Usage Notes</h1>
<p>When using a public BD address the address pre-programmed into the DA14531 will be used and can't be overridden.</p>
<p>A random address can be set by calling the R_BLE_VS_SetBdAddr function before the R_BLE_GAP_Init function is called.</p>
<p>Ensure the BSP heap size is set to at least 2K bytes.</p>
<p>When using FreeRTOS ensure the heap 4 size is set to a minimum of 2K bytes.</p>
<p>This middleware module is compatible with GTL binary version 6.0.18 and later. You must ensure that the DA14531 Module (or PMOD) you are using contains this version (or later) firmware or that you use the boot from host feature and have the host MCU load the binary into the DA14531.</p>
<p>Instructions detailing how to upgrade the firmware in a DA14531 Module can be found here:</p>
<p><a href="https://lpccs-docs.renesas.com/US159-DA14531EVZ_Firmware_Upgrade/index.html">https://lpccs-docs.renesas.com/US159-DA14531EVZ_Firmware_Upgrade/index.html</a></p>
<p>The GTL binary file can be downloaded using the tool described in the above instructions, or by using the following link:</p>
<p><a href="https://www.renesas.com/us/en/document/swo/fsp-gtl-binary-us159-da14531evz-pmod-programming?r=1564826">https://www.renesas.com/us/en/document/swo/fsp-gtl-binary-us159-da14531evz-pmod-programming?r=1564826</a></p>
<h2><a class="anchor" id="rm_ble_abs_gtl-limitations"></a>
Limitations</h2>
<p>Developers should be aware of the following limitations when using the BLE_ABS:</p>
<p>Following a power on reset, the R_BLE_VS_GetRand function always returns the same number. Subsequent calls to this function produce random numbers.</p>
<p>Service and characteristic write callback functions, created when using the QE Tool are not supported</p>
<p>The boot from host feature currently only supports 1-wire UART operation. This means that the UART RX and TX pins on the host RA MCU must be tied together using a 1K ohm resistor in order to boot the DA14531 - this resistor can remain in place after the boot operation has been completed.</p>
<p>Currently supported rm_ble_abs_gtl interface functions:</p><ul>
<li>RM_BLE_ABS_Open</li>
<li>RM_BLE_ABS_Close</li>
<li>RM_BLE_ABS_StartLegacyAdvertising</li>
</ul>
<p>Currently supported r_ble_api interface functions:</p><ul>
<li>R_BLE_Open</li>
<li>R_BLE_Close</li>
<li>R_BLE_Execute</li>
<li>R_BLE_IsTaskFree</li>
<li>R_BLE_GetVersion</li>
<li>R_BLE_GAP_Init</li>
<li>R_BLE_GAP_Terminate</li>
<li>R_BLE_GAP_UpdConn</li>
<li>R_BLE_GAP_SetDataLen</li>
<li>R_BLE_GAP_Disconnect</li>
<li>R_BLE_GAP_GetVerInfo</li>
<li>R_BLE_GAP_ReadRssi</li>
<li>R_BLE_GAP_ReadChMap</li>
<li>R_BLE_GAP_SetAdvParam</li>
<li>R_BLE_GAP_SetAdvSresData</li>
<li>R_BLE_GAP_StartAdv</li>
<li>R_BLE_GAP_StopAdv</li>
<li>R_BLE_GAP_GetRemainAdvBufSize</li>
<li>R_BLE_GAP_GetRemDevInfo</li>
<li>R_BLE_GATTS_SetDbInst</li>
<li>R_BLE_GATT_GetMtu</li>
<li>R_BLE_GATTS_RegisterCb</li>
<li>R_BLE_GATTS_DeregisterCb</li>
<li>R_BLE_GATTS_Notification</li>
<li>R_BLE_GATTS_Indication</li>
<li>R_BLE_GATTS_GetAttr</li>
<li>R_BLE_GATTS_SetAttr</li>
<li>R_BLE_GATTC_RegisterCb</li>
<li>R_BLE_GATTC_DeregisterCb</li>
<li>R_BLE_GATTC_ReqExMtu</li>
<li>R_BLE_GATTC_DiscAllPrimServ</li>
<li>R_BLE_GATTC_DiscIncServ</li>
<li>R_BLE_GATTC_ReadChar</li>
<li>R_BLE_GATTC_WriteCharWithoutRsp</li>
<li>R_BLE_GATTC_SignedWriteChar</li>
<li>R_BLE_GATTC_WriteChar</li>
<li>R_BLE_GATTC_WriteLongChar</li>
<li>R_BLE_GATTC_ExecWrite</li>
<li>R_BLE_VS_Init</li>
<li>R_BLE_VS_GetBdAddr</li>
<li>R_BLE_VS_SetBdAddr</li>
<li>R_BLE_VS_GetRand</li>
</ul>
<p>Currently supported callback events:</p><ul>
<li>BLE_GAP_EVENT_STACK_ON</li>
<li>BLE_GAP_EVENT_STACK_OFF</li>
<li>BLE_GAP_EVENT_CONN_IND</li>
<li>BLE_GAP_EVENT_DISCONN_IND</li>
<li>BLE_GAP_EVENT_DATA_LEN_CHG</li>
<li>BLE_GAP_EVENT_CONN_PARAM_UPD_COMP</li>
<li>BLE_GAP_EVENT_ADV_ON</li>
<li>BLE_GAP_EVENT_ADV_OFF</li>
<li>BLE_GAP_EVENT_SET_DATA_LEN_COMP</li>
<li>BLE_GAP_EVENT_LOC_VER_INFO</li>
<li>BLE_GAP_EVENT_RSSI_RD_COMP</li>
<li>BLE_GAP_EVENT_CH_MAP_RD_COMP</li>
<li>BLE_GAP_EVENT_GET_REM_DEV_INFO</li>
<li>BLE_GATTS_EVENT_WRITE_RSP_COMP</li>
<li>BLE_GATTS_EVENT_HDL_VAL_CNF</li>
<li>BLE_GATTS_EVENT_DB_ACCESS_IND</li>
<li>BLE_GATTC_EVENT_EX_MTU_RSP</li>
<li>BLE_GATTC_EVENT_PRIM_SERV_16_DISC_IND</li>
<li>BLE_GATTC_EVENT_PRIM_SERV_128_DISC_IND</li>
<li>BLE_GATTC_EVENT_ALL_PRIM_SERV_DISC_COMP</li>
</ul>
<h1><a class="anchor" id="rm_ble_abs_gtl-examples"></a>
Examples</h1>
<h2>BLE_ABS_GTL Basic Example</h2>
<p>This is a basic example of minimal use of the BLE_ABS_GTL in an application.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="comment">/* The callback is called when peripheral event occurs. */</span></div><div class="line"><span class="keywordtype">void</span> gap_peripheral_cb (uint16_t type, ble_status_t result, <a class="code" href="group___g_a_p___a_p_i.html#structst__ble__evt__data__t">st_ble_evt_data_t</a> * p_data)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(result);</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gaf0afcbc9a110ac9366a811d96ee06029">FSP_PARAMETER_NOT_USED</a>(p_data);</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (type)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___g_a_p___a_p_i.html#ggae2663e6d4f0cb98892400997e4479791ab19f3edae49d957099d613edec065d66">BLE_GAP_EVENT_STACK_ON</a>:</div><div class="line">        {</div><div class="line">            g_ble_event_flag = g_ble_event_flag | BLE_ABS_EVENT_FLAG_STACK_ON;</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___g_a_p___a_p_i.html#ggae2663e6d4f0cb98892400997e4479791a96a4488de3a4e1342413636c27c1d79f">BLE_GAP_EVENT_ADV_ON</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="group___g_a_p___a_p_i.html#structst__ble__gap__adv__set__evt__t">st_ble_gap_adv_set_evt_t</a> * p_gap_adv_set_evt_param = (<a class="code" href="group___g_a_p___a_p_i.html#structst__ble__gap__adv__set__evt__t">st_ble_gap_adv_set_evt_t</a> *) p_data-&gt;<a class="code" href="group___g_a_p___a_p_i.html#a46ea3309c5469b3725914fa1380aa145">p_param</a>;</div><div class="line">            g_advertising_handle = p_gap_adv_set_evt_param-&gt;<a class="code" href="group___g_a_p___a_p_i.html#ac550c509ccddad31e19e3ad31de343c9">adv_hdl</a>;</div><div class="line">            g_ble_event_flag    |= BLE_ABS_EVENT_FLAG_ADV_ON;</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___g_a_p___a_p_i.html#ggae2663e6d4f0cb98892400997e4479791ad5aa4042475ab2fb29a8a00b4e6e192b">BLE_GAP_EVENT_ADV_OFF</a>:</div><div class="line">        {</div><div class="line">            g_ble_event_flag |= BLE_ABS_EVENT_FLAG_ADV_OFF;</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___g_a_p___a_p_i.html#ggae2663e6d4f0cb98892400997e4479791abd9c651d9860ef667f04ffee4313bf5b">BLE_GAP_EVENT_CONN_IND</a>:</div><div class="line">        {</div><div class="line">            g_ble_event_flag |= BLE_ABS_EVENT_FLAG_CONN_IND;</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">            {</div><div class="line">                <span class="comment">/* Do nothing. */</span></div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div></div><!-- fragment --> <div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#define BLE_ABS_EVENT_FLAG_STACK_ON                  (0x01 &lt;&lt; 0)</span></div><div class="line"><span class="preprocessor">#define BLE_ABS_EVENT_FLAG_CONN_IND                  (0x01 &lt;&lt; 1)</span></div><div class="line"><span class="preprocessor">#define BLE_ABS_EVENT_FLAG_ADV_ON                    (0x01 &lt;&lt; 2)</span></div><div class="line"><span class="preprocessor">#define BLE_ABS_EVENT_FLAG_ADV_OFF                   (0x01 &lt;&lt; 3)</span></div><div class="line"><span class="preprocessor">#define BLE_ABS_EVENT_FLAG_DISCONN_IND               (0x01 &lt;&lt; 4)</span></div><div class="line"><span class="preprocessor">#define BLE_ABS_EVENT_FLAG_RSLV_LIST_CONF_COMP       (0x01 &lt;&lt; 5)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define BLE_ABS_EXAMPLE_SHORTENED_LOCAL_NAME         &#39;E&#39;, &#39;x&#39;, &#39;a&#39;, &#39;m&#39;, &#39;p&#39;, &#39;l&#39;, &#39;e&#39;</span></div><div class="line"><span class="preprocessor">#define BLE_ABS_EXAMPLE_COMPLETE_LOCAL_NAME          &#39;T&#39;, &#39;E&#39;, &#39;S&#39;, &#39;T&#39;, &#39;_&#39;, &#39;E&#39;, &#39;x&#39;, &#39;a&#39;, &#39;m&#39;, &#39;p&#39;, &#39;l&#39;, &#39;e&#39;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define BLE_ABS_EXAMPLE_SLOW_ADVERTISING_INTERVAL    (0x00000640)</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ble_abs_peripheral_example (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>         err     = FSP_SUCCESS;</div><div class="line">    <span class="keyword">volatile</span> uint32_t timeout = UINT16_MAX * UINT8_MAX * 8;</div><div class="line"></div><div class="line">    uint8_t advertising_data[] =</div><div class="line">    {</div><div class="line">        <span class="comment">/* Flags */</span></div><div class="line">        0x02,                                 </div><div class="line">        0x01,                                 </div><div class="line">        (0x1a),                               </div><div class="line">        <span class="comment">/* Shortened Local Name */</span></div><div class="line">        0x08,                                 </div><div class="line">        0x08,                                 </div><div class="line">        BLE_ABS_EXAMPLE_SHORTENED_LOCAL_NAME, </div><div class="line">    };</div><div class="line"></div><div class="line">    <span class="comment">/* Scan Response Data */</span></div><div class="line">    uint8_t scan_response_data[] =</div><div class="line">    {</div><div class="line">        <span class="comment">/* Complete Local Name */</span></div><div class="line">        0x0D,                                </div><div class="line">        0x09,                                </div><div class="line">        BLE_ABS_EXAMPLE_COMPLETE_LOCAL_NAME, </div><div class="line">    };</div><div class="line"></div><div class="line">    <a class="code" href="group___b_l_e___a_b_s___a_p_i.html#structble__abs__legacy__advertising__parameter__t">ble_abs_legacy_advertising_parameter_t</a> legacy_advertising_parameter =</div><div class="line">    {</div><div class="line">        .<a class="code" href="group___b_l_e___a_b_s___a_p_i.html#a1a0cc062f4555c2acaf34576e9420a20">p_peer_address</a>             = NULL,                                                        </div><div class="line">        .slow_advertising_interval  = BLE_ABS_EXAMPLE_SLOW_ADVERTISING_INTERVAL,                   </div><div class="line">        .slow_advertising_period    = 0x0000,                                                      </div><div class="line">        .p_advertising_data         = advertising_data,                                            </div><div class="line">        .advertising_data_length    = <span class="keyword">sizeof</span>(advertising_data),                                    </div><div class="line">        .p_scan_response_data       = scan_response_data,                                          </div><div class="line">        .scan_response_data_length  = <span class="keyword">sizeof</span>(scan_response_data),                                  </div><div class="line">        .advertising_filter_policy  = <a class="code" href="group___b_l_e___a_b_s___a_p_i.html#gga77ed02034d3aa2e83b97680eb15bb01fa9edc780a771c3008a0d1ba1e15c3f827">BLE_ABS_ADVERTISING_FILTER_ALLOW_ANY</a>,                        </div><div class="line">        .advertising_channel_map    = (<a class="code" href="group___g_a_p___a_p_i.html#ga363fedd67d5094e8849374e24092506f">BLE_GAP_ADV_CH_37</a> | <a class="code" href="group___g_a_p___a_p_i.html#ga6ae20f2ddea23255c21344c417b23c5c">BLE_GAP_ADV_CH_38</a> | <a class="code" href="group___g_a_p___a_p_i.html#ga9f93462459e29deb5f1ee4ae853675ef">BLE_GAP_ADV_CH_39</a>), </div><div class="line">        .own_bluetooth_address_type = <a class="code" href="group___g_a_p___a_p_i.html#gaf6e63e384a70bf085ad012ef48c38281">BLE_GAP_ADDR_PUBLIC</a>,                                         </div><div class="line">        .own_bluetooth_address      = {0},</div><div class="line">    };</div><div class="line"></div><div class="line">    g_ble_event_flag = 0;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/* Open the module. */</span></div><div class="line">    err = <a class="code" href="group___b_l_e___a_b_s.html#gaa4b69ce603223da8394cf8338474251c">RM_BLE_ABS_Open</a>(&amp;g_ble_abs0_ctrl, &amp;g_ble_abs0_cfg);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/* Handle any errors. This function should be defined by the user. */</span></div><div class="line">    assert(FSP_SUCCESS == err);</div><div class="line"></div><div class="line">    <span class="comment">/* Configure the Transmit Level */</span></div><div class="line">    err = (<a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#gadfb1288da0fcc7ae1dc88c58601374f8">fsp_err_t</a>) <a class="code" href="group___v_s___a_p_i.html#ga4e7581a994a391a9b7ac2403478bb8d1">R_BLE_VS_SetTxPower</a>(0, BLE_ABS_TRANSMIT_POWER);</div><div class="line"></div><div class="line">    <span class="comment">/* Handle any errors. This function should be defined by the user. */</span></div><div class="line">    assert(FSP_SUCCESS == err);</div><div class="line"></div><div class="line">    <span class="comment">/* Wait BLE_GAP_EVENT_STACK_ON event is notified. */</span></div><div class="line">    <span class="keywordflow">while</span> (!(BLE_ABS_EVENT_FLAG_STACK_ON &amp; g_ble_event_flag) &amp;&amp; (--timeout &gt; 0U))</div><div class="line">    {</div><div class="line">        <a class="code" href="group___b_l_e___a_p_i.html#gae2474ef5857658b666c558bab4faa5aa">R_BLE_Execute</a>();</div><div class="line">    }</div><div class="line"></div><div class="line">    time_out_handle_error(timeout);</div><div class="line">    g_ble_event_flag = 0;</div><div class="line"></div><div class="line">    timeout = UINT16_MAX * UINT8_MAX * 8;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/* Start advertising. */</span></div><div class="line">    err = <a class="code" href="group___b_l_e___a_b_s.html#ga0ddc7b65d81cae204fa9dc000bb39a96">RM_BLE_ABS_StartLegacyAdvertising</a>(&amp;g_ble_abs0_ctrl, &amp;legacy_advertising_parameter);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/* Handle any errors. This function should be defined by the user. */</span></div><div class="line">    assert(FSP_SUCCESS == err);</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (!(BLE_ABS_EVENT_FLAG_CONN_IND &amp; g_ble_event_flag) &amp;&amp; (--timeout &gt; 0U))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (BLE_ABS_EVENT_FLAG_ADV_OFF &amp; g_ble_event_flag)</div><div class="line">        {</div><div class="line">            <span class="comment">/* Restart advertise, when stop advertising. */</span></div><div class="line">            err = <a class="code" href="group___b_l_e___a_b_s.html#ga0ddc7b65d81cae204fa9dc000bb39a96">RM_BLE_ABS_StartLegacyAdvertising</a>(&amp;g_ble_abs0_ctrl, &amp;legacy_advertising_parameter);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (FSP_SUCCESS == err)</div><div class="line">            {</div><div class="line">                g_ble_event_flag &amp;= (uint16_t) ~BLE_ABS_EVENT_FLAG_ADV_OFF;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group___r_e_n_e_s_a_s___e_r_r_o_r___c_o_d_e_s.html#ggadfb1288da0fcc7ae1dc88c58601374f8af39326ab50613d8779ebc84e5da8ffbc">FSP_ERR_INVALID_STATE</a> == err)</div><div class="line">            {</div><div class="line">                <span class="comment">/* BLE driver state is busy. */</span></div><div class="line">                ;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                <span class="comment">/* Handle any errors. This function should be defined by the user. */</span></div><div class="line">                assert(FSP_SUCCESS == err);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((timeout % BLE_ABS_RETRY_INTERVAL) == 0U)</div><div class="line">        {</div><div class="line">            <span class="comment">/* Stop advertising after a certain amount of time */</span></div><div class="line">            <a class="code" href="group___g_a_p___a_p_i.html#ga958f662c44c6d0bec012cc55197c6a99">R_BLE_GAP_StopAdv</a>(g_advertising_handle);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            ;</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="group___b_l_e___a_p_i.html#gae2474ef5857658b666c558bab4faa5aa">R_BLE_Execute</a>();</div><div class="line">    }</div><div class="line"></div><div class="line">    time_out_handle_error(timeout);</div><div class="line"></div><div class="line">    <span class="comment">/* Clean up &amp; Close BLE driver */</span></div><div class="line">    g_ble_event_flag = 0;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/* Close BLE driver */</span></div><div class="line">    err = <a class="code" href="group___b_l_e___a_b_s.html#gadebdd1a85c6106e2a7ec3ad77cabcfb1">RM_BLE_ABS_Close</a>(&amp;g_ble_abs0_ctrl);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/* Handle any errors. This function should be defined by the user. */</span></div><div class="line">    assert(FSP_SUCCESS == err);</div><div class="line">}</div><div class="line"></div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
        <li class="footer">FSP Release v5.0.0 User's Manual Copyright © (2023) Renesas Electronics Corporation. All Rights Reserved.</li>
  </ul>
</div>
</body>
</html>
